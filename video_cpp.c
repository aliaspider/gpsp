#include "common.h"

u16 gba_screen_pixels[GBA_SCREEN_PITCH* GBA_SCREEN_HEIGHT];




static void render_scanline_conditional_tile(u32 start, u32 end, u16* scanline,
      u32 enable_flags, u32 dispcnt, u32 bldcnt, const tile_layer_render_struct
      *layer_renderers);
static void render_scanline_conditional_bitmap(u32 start, u32 end,
      u16* scanline,
      u32 enable_flags, u32 dispcnt, u32 bldcnt, const bitmap_layer_render_struct
      *layer_renderers);

static const u32 map_widths[] = { 256, 512, 256, 512 };

static void render_scanline_text_base_normal(u32 layer,
      u32 start, u32 end, void* scanline)
{
   u16* palette = palette_ram_converted;
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 map_width = map_widths[map_size];
   u32 horizontal_offset =
      (io_registers[REG_BG0HOFS + (layer * 2)] + start) % 512;
   u32 vertical_offset = (io_registers[REG_VCOUNT] +
                          io_registers[REG_BG0VOFS + (layer * 2)]) % 512;
   u32 current_pixel;
   u32 current_pixels;
   u32 partial_tile_run = 0;
   u32 partial_tile_offset;
   u32 tile_run;
   u32 i;
   u16* dest_ptr =
      ((u16*)scanline) + start;
      
   u16* map_base = (u16*)(vram + ((bg_control >> 8) & 0x1F) * (1024 * 2));
   u16* map_ptr, *second_ptr;
   u8* tile_ptr;
   
   end -= start;
   
   if ((map_size & 0x02) && (vertical_offset >= 256))
   {
      map_base += ((map_width / 8) * 32) +
                  (((vertical_offset - 256) / 8) * 32);
   }
   else
      map_base += (((vertical_offset % 256) / 8) * 32);
      
   if (map_size & 0x01)
   {
      if (horizontal_offset >= 256)
      {
         horizontal_offset -= 256;
         map_ptr = map_base + (32 * 32) + (horizontal_offset / 8);
         second_ptr = map_base;
      }
      else
      {
         map_ptr = map_base + (horizontal_offset / 8);
         second_ptr = map_base + (32 * 32);
      }
   }
   else
   {
      horizontal_offset %= 256;
      map_ptr = map_base + (horizontal_offset / 8);
      second_ptr = map_base;
   }
   
   if (bg_control & 0x80)
   {
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  8;
      u32 vertical_pixel_flip =
         ((64 - 8) -
          vertical_pixel_offset) - vertical_pixel_offset;
          
      ;
      
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                              partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0] = current_pixel;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };;
               }
               else
               {
                  if (partial_tile_offset >= 4)
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr + 4));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0] = current_pixel;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };;
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     current_pixel = current_pixels & 0xFF;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 3] = current_pixel;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 2] = current_pixel;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 1] = current_pixel;
                     current_pixel = current_pixels >> 24;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 0] = current_pixel;
                     dest_ptr += 4;
                  };
               }
               else
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     current_pixel = current_pixels & 0xFF;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 0] = current_pixel;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 1] = current_pixel;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 2] = current_pixel;
                     current_pixel = current_pixels >> 24;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 3] = current_pixel;
                     dest_ptr += 4;
                  };
               };
               map_ptr++;
            }
         }
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0] = current_pixel;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0] = current_pixel;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  current_pixel = current_pixels & 0xFF;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 3] = current_pixel;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 2] = current_pixel;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 1] = current_pixel;
                  current_pixel = current_pixels >> 24;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 0] = current_pixel;
                  dest_ptr += 4;
               };
            }
            else
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0] = current_pixel;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0] = current_pixel;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  current_pixel = current_pixels & 0xFF;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 0] = current_pixel;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 1] = current_pixel;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 2] = current_pixel;
                  current_pixel = current_pixels >> 24;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 3] = current_pixel;
                  dest_ptr += 4;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               current_pixel = current_pixels & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 3] = current_pixel;
               current_pixel = (current_pixels >> 8) & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 2] = current_pixel;
               current_pixel = (current_pixels >> 16) & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 1] = current_pixel;
               current_pixel = current_pixels >> 24;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 0] = current_pixel;
               current_pixels = *((u32*)tile_ptr);
               current_pixel = current_pixels & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[4 + 3] = current_pixel;
               current_pixel = (current_pixels >> 8) & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[4 + 2] = current_pixel;
               current_pixel = (current_pixels >> 16) & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[4 + 1] = current_pixel;
               current_pixel = current_pixels >> 24;
               current_pixel = palette[current_pixel];;
               dest_ptr[4 + 0] = current_pixel;
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               current_pixel = current_pixels & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 0] = current_pixel;
               current_pixel = (current_pixels >> 8) & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 1] = current_pixel;
               current_pixel = (current_pixels >> 16) & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 2] = current_pixel;
               current_pixel = current_pixels >> 24;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 3] = current_pixel;
               current_pixels = *((u32*)(tile_ptr + 4));
               current_pixel = current_pixels & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[4 + 0] = current_pixel;
               current_pixel = (current_pixels >> 8) & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[4 + 1] = current_pixel;
               current_pixel = (current_pixels >> 16) & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[4 + 2] = current_pixel;
               current_pixel = current_pixels >> 24;
               current_pixel = palette[current_pixel];;
               dest_ptr[4 + 3] = current_pixel;
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)(tile_ptr + 4));
            current_pixel = current_pixels & 0xFF;
            current_pixel = palette[current_pixel];;
            dest_ptr[0 + 3] = current_pixel;
            current_pixel = (current_pixels >> 8) & 0xFF;
            current_pixel = palette[current_pixel];;
            dest_ptr[0 + 2] = current_pixel;
            current_pixel = (current_pixels >> 16) & 0xFF;
            current_pixel = palette[current_pixel];;
            dest_ptr[0 + 1] = current_pixel;
            current_pixel = current_pixels >> 24;
            current_pixel = palette[current_pixel];;
            dest_ptr[0 + 0] = current_pixel;
            current_pixels = *((u32*)tile_ptr);
            current_pixel = current_pixels & 0xFF;
            current_pixel = palette[current_pixel];;
            dest_ptr[4 + 3] = current_pixel;
            current_pixel = (current_pixels >> 8) & 0xFF;
            current_pixel = palette[current_pixel];;
            dest_ptr[4 + 2] = current_pixel;
            current_pixel = (current_pixels >> 16) & 0xFF;
            current_pixel = palette[current_pixel];;
            dest_ptr[4 + 1] = current_pixel;
            current_pixel = current_pixels >> 24;
            current_pixel = palette[current_pixel];;
            dest_ptr[4 + 0] = current_pixel;
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            current_pixel = current_pixels & 0xFF;
            current_pixel = palette[current_pixel];;
            dest_ptr[0 + 0] = current_pixel;
            current_pixel = (current_pixels >> 8) & 0xFF;
            current_pixel = palette[current_pixel];;
            dest_ptr[0 + 1] = current_pixel;
            current_pixel = (current_pixels >> 16) & 0xFF;
            current_pixel = palette[current_pixel];;
            dest_ptr[0 + 2] = current_pixel;
            current_pixel = current_pixels >> 24;
            current_pixel = palette[current_pixel];;
            dest_ptr[0 + 3] = current_pixel;
            current_pixels = *((u32*)(tile_ptr + 4));
            current_pixel = current_pixels & 0xFF;
            current_pixel = palette[current_pixel];;
            dest_ptr[4 + 0] = current_pixel;
            current_pixel = (current_pixels >> 8) & 0xFF;
            current_pixel = palette[current_pixel];;
            dest_ptr[4 + 1] = current_pixel;
            current_pixel = (current_pixels >> 16) & 0xFF;
            current_pixel = palette[current_pixel];;
            dest_ptr[4 + 2] = current_pixel;
            current_pixel = current_pixels >> 24;
            current_pixel = palette[current_pixel];;
            dest_ptr[4 + 3] = current_pixel;
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               current_pixel = current_pixels & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 3] = current_pixel;
               current_pixel = (current_pixels >> 8) & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 2] = current_pixel;
               current_pixel = (current_pixels >> 16) & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 1] = current_pixel;
               current_pixel = current_pixels >> 24;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 0] = current_pixel;
               dest_ptr += 4;
               tile_ptr -= 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr + 4));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 24;
               current_pixel = palette[current_pixel];;
               dest_ptr[0] = current_pixel;
               current_pixels <<= 8;
               dest_ptr += 1;
            };
         }
         else
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)tile_ptr);
               current_pixel = current_pixels & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 0] = current_pixel;
               current_pixel = (current_pixels >> 8) & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 1] = current_pixel;
               current_pixel = (current_pixels >> 16) & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 2] = current_pixel;
               current_pixel = current_pixels >> 24;
               current_pixel = palette[current_pixel];;
               dest_ptr[0 + 3] = current_pixel;
               dest_ptr += 4;
               tile_ptr += 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0xFF;
               current_pixel = palette[current_pixel];;
               dest_ptr[0] = current_pixel;
               current_pixels >>= 8;
               dest_ptr += 1;
            };
         };
      }
   }
   else
   {
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  4;
      u32 vertical_pixel_flip =
         ((32 - 4) -
          vertical_pixel_offset) - vertical_pixel_offset;
          
      u32 current_palette;
      
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel) current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0] = current_pixel;;
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel) current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0] = current_pixel;;
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel) current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0] = current_pixel;;
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel) current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0] = current_pixel;;
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               map_ptr++;
            }
         }
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels >> 28;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0] = current_pixel;;
                  current_pixels <<= 4;
                  dest_ptr += 1;
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0] = current_pixel;;
                  current_pixels >>= 4;
                  dest_ptr += 1;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[7] = current_pixel;;
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[6] = current_pixel;;
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[5] = current_pixel;;
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[4] = current_pixel;;
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[3] = current_pixel;;
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[2] = current_pixel;;
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[1] = current_pixel;;
                  current_pixel = current_pixels >> 28;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0] = current_pixel;;
               }
               else
               {
                  current_pixel = palette[0];
                  dest_ptr[0] = current_pixel;
                  dest_ptr[1] = current_pixel;
                  dest_ptr[2] = current_pixel;
                  dest_ptr[3] = current_pixel;
                  dest_ptr[4] = current_pixel;
                  dest_ptr[5] = current_pixel;
                  dest_ptr[6] = current_pixel;
                  dest_ptr[7] = current_pixel;
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0] = current_pixel;;
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[1] = current_pixel;;
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[2] = current_pixel;;
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[3] = current_pixel;;
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[4] = current_pixel;;
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[5] = current_pixel;;
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[6] = current_pixel;;
                  current_pixel = current_pixels >> 28;
                  if (current_pixel) current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[7] = current_pixel;;
               }
               else
               {
                  current_pixel = palette[0];
                  dest_ptr[0] = current_pixel;
                  dest_ptr[1] = current_pixel;
                  dest_ptr[2] = current_pixel;
                  dest_ptr[3] = current_pixel;
                  dest_ptr[4] = current_pixel;
                  dest_ptr[5] = current_pixel;
                  dest_ptr[6] = current_pixel;
                  dest_ptr[7] = current_pixel;
               };
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[7] = current_pixel;;
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[6] = current_pixel;;
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[5] = current_pixel;;
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[4] = current_pixel;;
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[3] = current_pixel;;
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[2] = current_pixel;;
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[1] = current_pixel;;
               current_pixel = current_pixels >> 28;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[0] = current_pixel;;
            }
            else
            {
               current_pixel = palette[0];
               dest_ptr[0] = current_pixel;
               dest_ptr[1] = current_pixel;
               dest_ptr[2] = current_pixel;
               dest_ptr[3] = current_pixel;
               dest_ptr[4] = current_pixel;
               dest_ptr[5] = current_pixel;
               dest_ptr[6] = current_pixel;
               dest_ptr[7] = current_pixel;
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[0] = current_pixel;;
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[1] = current_pixel;;
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[2] = current_pixel;;
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[3] = current_pixel;;
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[4] = current_pixel;;
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[5] = current_pixel;;
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[6] = current_pixel;;
               current_pixel = current_pixels >> 28;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[7] = current_pixel;;
            }
            else
            {
               current_pixel = palette[0];
               dest_ptr[0] = current_pixel;
               dest_ptr[1] = current_pixel;
               dest_ptr[2] = current_pixel;
               dest_ptr[3] = current_pixel;
               dest_ptr[4] = current_pixel;
               dest_ptr[5] = current_pixel;
               dest_ptr[6] = current_pixel;
               dest_ptr[7] = current_pixel;
            };
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 28;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[0] = current_pixel;;
               current_pixels <<= 4;
               dest_ptr += 1;
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel) current_pixel |= current_palette;
               current_pixel = palette[current_pixel];;
               dest_ptr[0] = current_pixel;;
               current_pixels >>= 4;
               dest_ptr += 1;
            };
         };
      }
   }
}

static void render_scanline_text_transparent_normal(u32 layer,
      u32 start, u32 end, void* scanline)
{
   u16* palette = palette_ram_converted;
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 map_width = map_widths[map_size];
   u32 horizontal_offset =
      (io_registers[REG_BG0HOFS + (layer * 2)] + start) % 512;
   u32 vertical_offset = (io_registers[REG_VCOUNT] +
                          io_registers[REG_BG0VOFS + (layer * 2)]) % 512;
   u32 current_pixel;
   u32 current_pixels;
   u32 partial_tile_run = 0;
   u32 partial_tile_offset;
   u32 tile_run;
   u32 i;
   u16* dest_ptr =
      ((u16*)scanline) + start;
      
   u16* map_base = (u16*)(vram + ((bg_control >> 8) & 0x1F) * (1024 * 2));
   u16* map_ptr, *second_ptr;
   u8* tile_ptr;
   
   end -= start;
   
   if ((map_size & 0x02) && (vertical_offset >= 256))
   {
      map_base += ((map_width / 8) * 32) +
                  (((vertical_offset - 256) / 8) * 32);
   }
   else
      map_base += (((vertical_offset % 256) / 8) * 32);
      
   if (map_size & 0x01)
   {
      if (horizontal_offset >= 256)
      {
         horizontal_offset -= 256;
         map_ptr = map_base + (32 * 32) + (horizontal_offset / 8);
         second_ptr = map_base;
      }
      else
      {
         map_ptr = map_base + (horizontal_offset / 8);
         second_ptr = map_base + (32 * 32);
      }
   }
   else
   {
      horizontal_offset %= 256;
      map_ptr = map_base + (horizontal_offset / 8);
      second_ptr = map_base;
   }
   
   if (bg_control & 0x80)
   {
   
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  8;
      u32 vertical_pixel_flip =
         ((64 - 8) -
          vertical_pixel_offset) - vertical_pixel_offset;
      ;
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                              partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                     };
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };;
               }
               else
               {
                  if (partial_tile_offset >= 4)
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr + 4));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                     };
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };;
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 3] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 2] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 1] = current_pixel;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 0] = current_pixel;
                        };
                     };
                     dest_ptr += 4;
                  };
               }
               else
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 0] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 1] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 2] = current_pixel;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 3] = current_pixel;
                        };
                     };
                     dest_ptr += 4;
                  };
               };
               map_ptr++;
            }
         }
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                     };
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                     };
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 3] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 2] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 1] = current_pixel;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 0] = current_pixel;
                     };
                  };
                  dest_ptr += 4;
               };
            }
            else
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                     };
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                     };
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 0] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 1] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 2] = current_pixel;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 3] = current_pixel;
                     };
                  };
                  dest_ptr += 4;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 3] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 2] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 1] = current_pixel;
                  };
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 0] = current_pixel;
                  };
               };
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[4 + 3] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[4 + 2] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[4 + 1] = current_pixel;
                  };
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[4 + 0] = current_pixel;
                  };
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 0] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 1] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 2] = current_pixel;
                  };
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 3] = current_pixel;
                  };
               };
               current_pixels = *((u32*)(tile_ptr + 4));
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[4 + 0] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[4 + 1] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[4 + 2] = current_pixel;
                  };
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[4 + 3] = current_pixel;
                  };
               };
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)(tile_ptr + 4));
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 3] = current_pixel;
               };
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 2] = current_pixel;
               };
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 1] = current_pixel;
               };
               current_pixel = current_pixels >> 24;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 0] = current_pixel;
               };
            };
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[4 + 3] = current_pixel;
               };
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[4 + 2] = current_pixel;
               };
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[4 + 1] = current_pixel;
               };
               current_pixel = current_pixels >> 24;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[4 + 0] = current_pixel;
               };
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 0] = current_pixel;
               };
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 1] = current_pixel;
               };
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 2] = current_pixel;
               };
               current_pixel = current_pixels >> 24;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0 + 3] = current_pixel;
               };
            };
            current_pixels = *((u32*)(tile_ptr + 4));
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[4 + 0] = current_pixel;
               };
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[4 + 1] = current_pixel;
               };
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[4 + 2] = current_pixel;
               };
               current_pixel = current_pixels >> 24;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[4 + 3] = current_pixel;
               };
            };
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 3] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 2] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 1] = current_pixel;
                  };
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 0] = current_pixel;
                  };
               };
               dest_ptr += 4;
               tile_ptr -= 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr + 4));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 24;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0] = current_pixel;
               };
               current_pixels <<= 8;
               dest_ptr += 1;
            };
         }
         else
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 0] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 1] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 2] = current_pixel;
                  };
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                  {
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0 + 3] = current_pixel;
                  };
               };
               dest_ptr += 4;
               tile_ptr += 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
               {
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0] = current_pixel;
               };
               current_pixels >>= 8;
               dest_ptr += 1;
            };
         };
      }
   }
   else
   {
   
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  4;
      u32 vertical_pixel_flip =
         ((32 - 4) -
          vertical_pixel_offset) - vertical_pixel_offset;
      u32 current_palette;
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                     };
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                     };
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                     };
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                     };
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               map_ptr++;
            }
         }
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0] = current_pixel;
                  };
                  current_pixels <<= 4;
                  dest_ptr += 1;
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0] = current_pixel;
                  };
                  current_pixels >>= 4;
                  dest_ptr += 1;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[7] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[6] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[5] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[4] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[3] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[2] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[1] = current_pixel;
                  };
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0] = current_pixel;
                  };
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[0] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[1] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[2] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[3] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[4] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[5] = current_pixel;
                  };
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[6] = current_pixel;
                  };
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     current_pixel = palette[current_pixel];;
                     dest_ptr[7] = current_pixel;
                  };
               };
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
         
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[7] = current_pixel;
               };
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[6] = current_pixel;
               };
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[5] = current_pixel;
               };
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[4] = current_pixel;
               };
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[3] = current_pixel;
               };
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[2] = current_pixel;
               };
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[1] = current_pixel;
               };
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0] = current_pixel;
               };
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0] = current_pixel;
               };
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[1] = current_pixel;
               };
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[2] = current_pixel;
               };
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[3] = current_pixel;
               };
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[4] = current_pixel;
               };
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[5] = current_pixel;
               };
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[6] = current_pixel;
               };
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[7] = current_pixel;
               };
            };
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0] = current_pixel;
               };
               current_pixels <<= 4;
               dest_ptr += 1;
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0] = current_pixel;
               };
               current_pixels >>= 4;
               dest_ptr += 1;
            };
         };
      }
   }
}

static void render_scanline_text_base_color16(u32 layer,
      u32 start, u32 end, void* scanline)
{
   u32 bg_combine = (((io_registers[REG_BLDCNT] >> 5) & 0x01) | ((
                        io_registers[REG_BLDCNT] >> (5 + 7)) & 0x02)) << 9;
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> layer) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (layer + 7)) & 0x02)) << 9;
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 map_width = map_widths[map_size];
   u32 horizontal_offset =
      (io_registers[REG_BG0HOFS + (layer * 2)] + start) % 512;
   u32 vertical_offset = (io_registers[REG_VCOUNT] +
                          io_registers[REG_BG0VOFS + (layer * 2)]) % 512;
   u32 current_pixel;
   u32 current_pixels;
   u32 partial_tile_run = 0;
   u32 partial_tile_offset;
   u32 tile_run;
   u32 i;
   u16* dest_ptr =
      ((u16*)scanline) + start;
      
   u16* map_base = (u16*)(vram + ((bg_control >> 8) & 0x1F) * (1024 * 2));
   u16* map_ptr, *second_ptr;
   u8* tile_ptr;
   
   end -= start;
   
   if ((map_size & 0x02) && (vertical_offset >= 256))
   {
      map_base += ((map_width / 8) * 32) +
                  (((vertical_offset - 256) / 8) * 32);
   }
   else
      map_base += (((vertical_offset % 256) / 8) * 32);
      
   if (map_size & 0x01)
   {
      if (horizontal_offset >= 256)
      {
         horizontal_offset -= 256;
         map_ptr = map_base + (32 * 32) + (horizontal_offset / 8);
         second_ptr = map_base;
      }
      else
      {
         map_ptr = map_base + (horizontal_offset / 8);
         second_ptr = map_base + (32 * 32);
      }
   }
   else
   {
      horizontal_offset %= 256;
      map_ptr = map_base + (horizontal_offset / 8);
      second_ptr = map_base;
   }
   
   if (bg_control & 0x80)
   {
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  8;
      u32 vertical_pixel_flip =
         ((64 - 8) -
          vertical_pixel_offset) - vertical_pixel_offset;
      ;
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                              partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;
                           else
                              dest_ptr[0] = bg_combine; ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };;
               }
               else
               {
                  if (partial_tile_offset >= 4)
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;
                           else
                              dest_ptr[0] = bg_combine; ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr + 4));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };;
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;
                        else
                           dest_ptr[0] = bg_combine; ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;
                        else
                           dest_ptr[0] = bg_combine; ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 3] = bg_combine; ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 2] = bg_combine; ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 1] = bg_combine; ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 0] = bg_combine; ;
                     dest_ptr += 4;
                  };
               }
               else
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;
                        else
                           dest_ptr[0] = bg_combine; ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;
                        else
                           dest_ptr[0] = bg_combine; ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 0] = bg_combine; ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 1] = bg_combine; ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 2] = bg_combine; ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 3] = bg_combine; ;
                     dest_ptr += 4;
                  };
               };
               map_ptr++;
            }
         }
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 3] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 3] = bg_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 2] = bg_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 1] = bg_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 0] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 0] = bg_combine; ;
                  dest_ptr += 4;
               };
            }
            else
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 0] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 0] = bg_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 1] = bg_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 2] = bg_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 3] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 3] = bg_combine; ;
                  dest_ptr += 4;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 3] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 2] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 1] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 0] = bg_combine; ;
               current_pixels = *((u32*)tile_ptr);
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 3] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 2] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 1] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[4 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 0] = bg_combine; ;
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 0] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 1] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 2] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 3] = bg_combine; ;
               current_pixels = *((u32*)(tile_ptr + 4));
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 0] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 1] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 2] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[4 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 3] = bg_combine; ;
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)(tile_ptr + 4));
            current_pixel = current_pixels & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 3] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 3] = bg_combine; ;
            current_pixel = (current_pixels >> 8) & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 2] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 2] = bg_combine; ;
            current_pixel = (current_pixels >> 16) & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 1] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 1] = bg_combine; ;
            current_pixel = current_pixels >> 24;
            if (current_pixel)
               dest_ptr[0 + 0] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 0] = bg_combine; ;
            current_pixels = *((u32*)tile_ptr);
            current_pixel = current_pixels & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 3] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 3] = bg_combine; ;
            current_pixel = (current_pixels >> 8) & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 2] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 2] = bg_combine; ;
            current_pixel = (current_pixels >> 16) & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 1] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 1] = bg_combine; ;
            current_pixel = current_pixels >> 24;
            if (current_pixel)
               dest_ptr[4 + 0] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 0] = bg_combine; ;
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            current_pixel = current_pixels & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 0] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 0] = bg_combine; ;
            current_pixel = (current_pixels >> 8) & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 1] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 1] = bg_combine; ;
            current_pixel = (current_pixels >> 16) & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 2] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 2] = bg_combine; ;
            current_pixel = current_pixels >> 24;
            if (current_pixel)
               dest_ptr[0 + 3] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 3] = bg_combine; ;
            current_pixels = *((u32*)(tile_ptr + 4));
            current_pixel = current_pixels & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 0] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 0] = bg_combine; ;
            current_pixel = (current_pixels >> 8) & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 1] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 1] = bg_combine; ;
            current_pixel = (current_pixels >> 16) & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 2] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 2] = bg_combine; ;
            current_pixel = current_pixels >> 24;
            if (current_pixel)
               dest_ptr[4 + 3] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 3] = bg_combine; ;
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 3] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 2] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 1] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 0] = bg_combine; ;
               dest_ptr += 4;
               tile_ptr -= 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr + 4));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0] = bg_combine; ;
               current_pixels <<= 8;
               dest_ptr += 1;
            };
         }
         else
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)tile_ptr);
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 0] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 1] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 2] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 3] = bg_combine; ;
               dest_ptr += 4;
               tile_ptr += 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0] = bg_combine; ;
               current_pixels >>= 8;
               dest_ptr += 1;
            };
         };
      }
   }
   else
   {
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  4;
      u32 vertical_pixel_flip =
         ((32 - 4) -
          vertical_pixel_offset) - vertical_pixel_offset;
      u32 current_palette;
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     }
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     }
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     }
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     }
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               map_ptr++;
            }
         }
         
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[0] = bg_combine; ;
                  current_pixels <<= 4;
                  dest_ptr += 1;
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[0] = bg_combine; ;
                  current_pixels >>= 4;
                  dest_ptr += 1;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[7] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[7] = bg_combine; ;
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[6] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[6] = bg_combine; ;
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[5] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[5] = bg_combine; ;
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[4] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[4] = bg_combine; ;
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[3] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[3] = bg_combine; ;
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[2] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[2] = bg_combine; ;
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[1] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[1] = bg_combine; ;
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[0] = bg_combine; ;
               }
               else
               {
                  dest_ptr[0] = bg_combine;
                  dest_ptr[1] = bg_combine;
                  dest_ptr[2] = bg_combine;
                  dest_ptr[3] = bg_combine;
                  dest_ptr[4] = bg_combine;
                  dest_ptr[5] = bg_combine;
                  dest_ptr[6] = bg_combine;
                  dest_ptr[7] = bg_combine;
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[0] = bg_combine; ;
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[1] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[1] = bg_combine; ;
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[2] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[2] = bg_combine; ;
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[3] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[3] = bg_combine; ;
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[4] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[4] = bg_combine; ;
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[5] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[5] = bg_combine; ;
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[6] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[6] = bg_combine; ;
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[7] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[7] = bg_combine; ;
               }
               else
               {
                  dest_ptr[0] = bg_combine;
                  dest_ptr[1] = bg_combine;
                  dest_ptr[2] = bg_combine;
                  dest_ptr[3] = bg_combine;
                  dest_ptr[4] = bg_combine;
                  dest_ptr[5] = bg_combine;
                  dest_ptr[6] = bg_combine;
                  dest_ptr[7] = bg_combine;
               };
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[7] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[7] = bg_combine; ;
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[6] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[6] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[5] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[5] = bg_combine; ;
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[4] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[4] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[3] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[3] = bg_combine; ;
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[2] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[2] = bg_combine; ;
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[1] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[1] = bg_combine; ;
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[0] = bg_combine; ;
            }
            else
            {
               dest_ptr[0] = bg_combine;
               dest_ptr[1] = bg_combine;
               dest_ptr[2] = bg_combine;
               dest_ptr[3] = bg_combine;
               dest_ptr[4] = bg_combine;
               dest_ptr[5] = bg_combine;
               dest_ptr[6] = bg_combine;
               dest_ptr[7] = bg_combine;
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[0] = bg_combine; ;
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[1] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[1] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[2] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[2] = bg_combine; ;
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[3] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[3] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[4] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[4] = bg_combine; ;
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[5] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[5] = bg_combine; ;
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[6] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[6] = bg_combine; ;
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[7] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[7] = bg_combine; ;
            }
            else
            {
               dest_ptr[0] = bg_combine;
               dest_ptr[1] = bg_combine;
               dest_ptr[2] = bg_combine;
               dest_ptr[3] = bg_combine;
               dest_ptr[4] = bg_combine;
               dest_ptr[5] = bg_combine;
               dest_ptr[6] = bg_combine;
               dest_ptr[7] = bg_combine;
            };
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[0] = bg_combine; ;
               current_pixels <<= 4;
               dest_ptr += 1;
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[0] = bg_combine; ;
               current_pixels >>= 4;
               dest_ptr += 1;
            };
         };
      }
   }
}

static void render_scanline_text_transparent_color16(u32 layer,
      u32 start, u32 end, void* scanline)
{
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> layer) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (layer + 7)) & 0x02)) << 9;
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 map_width = map_widths[map_size];
   u32 horizontal_offset =
      (io_registers[REG_BG0HOFS + (layer * 2)] + start) % 512;
   u32 vertical_offset = (io_registers[REG_VCOUNT] +
                          io_registers[REG_BG0VOFS + (layer * 2)]) % 512;
   u32 current_pixel;
   u32 current_pixels;
   u32 partial_tile_run = 0;
   u32 partial_tile_offset;
   u32 tile_run;
   u32 i;
   u16* dest_ptr =
      ((u16*)scanline) + start;
      
   u16* map_base = (u16*)(vram + ((bg_control >> 8) & 0x1F) * (1024 * 2));
   u16* map_ptr, *second_ptr;
   u8* tile_ptr;
   
   end -= start;
   
   if ((map_size & 0x02) && (vertical_offset >= 256))
   {
      map_base += ((map_width / 8) * 32) +
                  (((vertical_offset - 256) / 8) * 32);
   }
   else
      map_base += (((vertical_offset % 256) / 8) * 32);
      
   if (map_size & 0x01)
   {
      if (horizontal_offset >= 256)
      {
         horizontal_offset -= 256;
         map_ptr = map_base + (32 * 32) + (horizontal_offset / 8);
         second_ptr = map_base;
      }
      else
      {
         map_ptr = map_base + (horizontal_offset / 8);
         second_ptr = map_base + (32 * 32);
      }
   }
   else
   {
      horizontal_offset %= 256;
      map_ptr = map_base + (horizontal_offset / 8);
      second_ptr = map_base;
   }
   
   if (bg_control & 0x80)
   {
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  8;
      u32 vertical_pixel_flip =
         ((64 - 8) -
          vertical_pixel_offset) - vertical_pixel_offset;
      ;
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                              partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine; ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };;
               }
               else
               {
                  if (partial_tile_offset >= 4)
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine; ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr + 4));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };;
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine; ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine; ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
                     };
                     dest_ptr += 4;
                  };
               }
               else
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine; ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine; ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
                     };
                     dest_ptr += 4;
                  };
               };
               map_ptr++;
            }
         }
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
                  };
                  dest_ptr += 4;
               };
            }
            else
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
                  };
                  dest_ptr += 4;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
               };
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 3] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 2] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 1] = current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[4 + 0] = current_pixel | pixel_combine; ;
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
               };
               current_pixels = *((u32*)(tile_ptr + 4));
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 0] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 1] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 2] = current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[4 + 3] = current_pixel | pixel_combine; ;
               };
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)(tile_ptr + 4));
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
            };
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 3] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 2] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 1] = current_pixel | pixel_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[4 + 0] = current_pixel | pixel_combine; ;
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
            };
            current_pixels = *((u32*)(tile_ptr + 4));
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 0] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 1] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 2] = current_pixel | pixel_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[4 + 3] = current_pixel | pixel_combine; ;
            };
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
               };
               dest_ptr += 4;
               tile_ptr -= 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr + 4));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0] = current_pixel | pixel_combine; ;
               current_pixels <<= 8;
               dest_ptr += 1;
            };
         }
         else
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
               };
               dest_ptr += 4;
               tile_ptr += 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0] = current_pixel | pixel_combine; ;
               current_pixels >>= 8;
               dest_ptr += 1;
            };
         };
      }
   }
   else
   {
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  4;
      u32 vertical_pixel_flip =
         ((32 - 4) -
          vertical_pixel_offset) - vertical_pixel_offset;
      u32 current_palette;
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               map_ptr++;
            }
         }
         
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  };
                  current_pixels <<= 4;
                  dest_ptr += 1;
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  };
                  current_pixels >>= 4;
                  dest_ptr += 1;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[7] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[6] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[5] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[4] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[3] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[2] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[1] = current_pixel | pixel_combine;
                  };
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  };
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[1] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[2] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[3] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[4] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[5] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[6] = current_pixel | pixel_combine;
                  };
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[7] = current_pixel | pixel_combine;
                  };
               };
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[7] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[6] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[5] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[4] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[3] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[2] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[1] = current_pixel | pixel_combine;
               };
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               };
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[1] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[2] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[3] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[4] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[5] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[6] = current_pixel | pixel_combine;
               };
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[7] = current_pixel | pixel_combine;
               };
            };
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               };
               current_pixels <<= 4;
               dest_ptr += 1;
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               };
               current_pixels >>= 4;
               dest_ptr += 1;
            };
         };
      }
   }
}

static void render_scanline_text_base_color32(u32 layer,
      u32 start, u32 end, void* scanline)
{
   u32 bg_combine = (((io_registers[REG_BLDCNT] >> 5) & 0x01) | ((
                        io_registers[REG_BLDCNT] >> (5 + 7)) & 0x02)) << 9;
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> layer) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (layer + 7)) & 0x02)) << 9;
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 map_width = map_widths[map_size];
   u32 horizontal_offset =
      (io_registers[REG_BG0HOFS + (layer * 2)] + start) % 512;
   u32 vertical_offset = (io_registers[REG_VCOUNT] +
                          io_registers[REG_BG0VOFS + (layer * 2)]) % 512;
   u32 current_pixel;
   u32 current_pixels;
   u32 partial_tile_run = 0;
   u32 partial_tile_offset;
   u32 tile_run;
   u32 i;
   u32* dest_ptr =
      ((u32*)scanline) + start;
      
   u16* map_base = (u16*)(vram + ((bg_control >> 8) & 0x1F) * (1024 * 2));
   u16* map_ptr, *second_ptr;
   u8* tile_ptr;
   
   end -= start;
   
   if ((map_size & 0x02) && (vertical_offset >= 256))
   {
      map_base += ((map_width / 8) * 32) +
                  (((vertical_offset - 256) / 8) * 32);
   }
   else
      map_base += (((vertical_offset % 256) / 8) * 32);
      
   if (map_size & 0x01)
   {
      if (horizontal_offset >= 256)
      {
         horizontal_offset -= 256;
         map_ptr = map_base + (32 * 32) + (horizontal_offset / 8);
         second_ptr = map_base;
      }
      else
      {
         map_ptr = map_base + (horizontal_offset / 8);
         second_ptr = map_base + (32 * 32);
      }
   }
   else
   {
      horizontal_offset %= 256;
      map_ptr = map_base + (horizontal_offset / 8);
      second_ptr = map_base;
   }
   
   if (bg_control & 0x80)
   {
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  8;
      u32 vertical_pixel_flip =
         ((64 - 8) -
          vertical_pixel_offset) - vertical_pixel_offset;
      ;
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                              partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;
                           else
                              dest_ptr[0] = bg_combine; ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };;
               }
               else
               {
                  if (partial_tile_offset >= 4)
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;
                           else
                              dest_ptr[0] = bg_combine; ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr + 4));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };;
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;
                        else
                           dest_ptr[0] = bg_combine; ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;
                        else
                           dest_ptr[0] = bg_combine; ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 3] = bg_combine; ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 2] = bg_combine; ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 1] = bg_combine; ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 0] = bg_combine; ;
                     dest_ptr += 4;
                  };
               }
               else
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;
                        else
                           dest_ptr[0] = bg_combine; ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;
                        else
                           dest_ptr[0] = bg_combine; ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 0] = bg_combine; ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 1] = bg_combine; ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 2] = bg_combine; ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 3] = bg_combine; ;
                     dest_ptr += 4;
                  };
               };
               map_ptr++;
            }
         }
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 3] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 3] = bg_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 2] = bg_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 1] = bg_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 0] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 0] = bg_combine; ;
                  dest_ptr += 4;
               };
            }
            else
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 0] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 0] = bg_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 1] = bg_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 2] = bg_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 3] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 3] = bg_combine; ;
                  dest_ptr += 4;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 3] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 2] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 1] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 0] = bg_combine; ;
               current_pixels = *((u32*)tile_ptr);
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 3] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 2] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 1] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[4 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 0] = bg_combine; ;
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 0] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 1] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 2] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 3] = bg_combine; ;
               current_pixels = *((u32*)(tile_ptr + 4));
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 0] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 1] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 2] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[4 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 3] = bg_combine; ;
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)(tile_ptr + 4));
            current_pixel = current_pixels & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 3] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 3] = bg_combine; ;
            current_pixel = (current_pixels >> 8) & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 2] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 2] = bg_combine; ;
            current_pixel = (current_pixels >> 16) & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 1] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 1] = bg_combine; ;
            current_pixel = current_pixels >> 24;
            if (current_pixel)
               dest_ptr[0 + 0] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 0] = bg_combine; ;
            current_pixels = *((u32*)tile_ptr);
            current_pixel = current_pixels & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 3] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 3] = bg_combine; ;
            current_pixel = (current_pixels >> 8) & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 2] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 2] = bg_combine; ;
            current_pixel = (current_pixels >> 16) & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 1] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 1] = bg_combine; ;
            current_pixel = current_pixels >> 24;
            if (current_pixel)
               dest_ptr[4 + 0] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 0] = bg_combine; ;
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            current_pixel = current_pixels & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 0] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 0] = bg_combine; ;
            current_pixel = (current_pixels >> 8) & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 1] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 1] = bg_combine; ;
            current_pixel = (current_pixels >> 16) & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 2] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 2] = bg_combine; ;
            current_pixel = current_pixels >> 24;
            if (current_pixel)
               dest_ptr[0 + 3] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 3] = bg_combine; ;
            current_pixels = *((u32*)(tile_ptr + 4));
            current_pixel = current_pixels & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 0] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 0] = bg_combine; ;
            current_pixel = (current_pixels >> 8) & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 1] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 1] = bg_combine; ;
            current_pixel = (current_pixels >> 16) & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 2] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 2] = bg_combine; ;
            current_pixel = current_pixels >> 24;
            if (current_pixel)
               dest_ptr[4 + 3] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 3] = bg_combine; ;
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 3] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 2] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 1] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 0] = bg_combine; ;
               dest_ptr += 4;
               tile_ptr -= 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr + 4));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0] = bg_combine; ;
               current_pixels <<= 8;
               dest_ptr += 1;
            };
         }
         else
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)tile_ptr);
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 0] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 1] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 2] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 3] = bg_combine; ;
               dest_ptr += 4;
               tile_ptr += 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0] = bg_combine; ;
               current_pixels >>= 8;
               dest_ptr += 1;
            };
         };
      }
   }
   else
   {
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  4;
      u32 vertical_pixel_flip =
         ((32 - 4) -
          vertical_pixel_offset) - vertical_pixel_offset;
      u32 current_palette;
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     }
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     }
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     }
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     }
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               map_ptr++;
            }
         }
         
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[0] = bg_combine; ;
                  current_pixels <<= 4;
                  dest_ptr += 1;
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[0] = bg_combine; ;
                  current_pixels >>= 4;
                  dest_ptr += 1;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[7] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[7] = bg_combine; ;
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[6] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[6] = bg_combine; ;
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[5] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[5] = bg_combine; ;
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[4] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[4] = bg_combine; ;
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[3] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[3] = bg_combine; ;
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[2] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[2] = bg_combine; ;
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[1] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[1] = bg_combine; ;
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[0] = bg_combine; ;
               }
               else
               {
                  dest_ptr[0] = bg_combine;
                  dest_ptr[1] = bg_combine;
                  dest_ptr[2] = bg_combine;
                  dest_ptr[3] = bg_combine;
                  dest_ptr[4] = bg_combine;
                  dest_ptr[5] = bg_combine;
                  dest_ptr[6] = bg_combine;
                  dest_ptr[7] = bg_combine;
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[0] = bg_combine; ;
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[1] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[1] = bg_combine; ;
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[2] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[2] = bg_combine; ;
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[3] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[3] = bg_combine; ;
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[4] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[4] = bg_combine; ;
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[5] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[5] = bg_combine; ;
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[6] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[6] = bg_combine; ;
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[7] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[7] = bg_combine; ;
               }
               else
               {
                  dest_ptr[0] = bg_combine;
                  dest_ptr[1] = bg_combine;
                  dest_ptr[2] = bg_combine;
                  dest_ptr[3] = bg_combine;
                  dest_ptr[4] = bg_combine;
                  dest_ptr[5] = bg_combine;
                  dest_ptr[6] = bg_combine;
                  dest_ptr[7] = bg_combine;
               };
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[7] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[7] = bg_combine; ;
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[6] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[6] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[5] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[5] = bg_combine; ;
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[4] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[4] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[3] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[3] = bg_combine; ;
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[2] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[2] = bg_combine; ;
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[1] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[1] = bg_combine; ;
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[0] = bg_combine; ;
            }
            else
            {
               dest_ptr[0] = bg_combine;
               dest_ptr[1] = bg_combine;
               dest_ptr[2] = bg_combine;
               dest_ptr[3] = bg_combine;
               dest_ptr[4] = bg_combine;
               dest_ptr[5] = bg_combine;
               dest_ptr[6] = bg_combine;
               dest_ptr[7] = bg_combine;
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[0] = bg_combine; ;
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[1] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[1] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[2] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[2] = bg_combine; ;
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[3] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[3] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[4] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[4] = bg_combine; ;
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[5] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[5] = bg_combine; ;
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[6] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[6] = bg_combine; ;
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[7] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[7] = bg_combine; ;
            }
            else
            {
               dest_ptr[0] = bg_combine;
               dest_ptr[1] = bg_combine;
               dest_ptr[2] = bg_combine;
               dest_ptr[3] = bg_combine;
               dest_ptr[4] = bg_combine;
               dest_ptr[5] = bg_combine;
               dest_ptr[6] = bg_combine;
               dest_ptr[7] = bg_combine;
            };
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[0] = bg_combine; ;
               current_pixels <<= 4;
               dest_ptr += 1;
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[0] = bg_combine; ;
               current_pixels >>= 4;
               dest_ptr += 1;
            };
         };
      }
   }
}

static void render_scanline_text_transparent_color32(u32 layer,
      u32 start, u32 end, void* scanline)
{
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> layer) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (layer + 7)) & 0x02)) << 9;
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 map_width = map_widths[map_size];
   u32 horizontal_offset =
      (io_registers[REG_BG0HOFS + (layer * 2)] + start) % 512;
   u32 vertical_offset = (io_registers[REG_VCOUNT] +
                          io_registers[REG_BG0VOFS + (layer * 2)]) % 512;
   u32 current_pixel;
   u32 current_pixels;
   u32 partial_tile_run = 0;
   u32 partial_tile_offset;
   u32 tile_run;
   u32 i;
   u32* dest_ptr =
      ((u32*)scanline) + start;
      
   u16* map_base = (u16*)(vram + ((bg_control >> 8) & 0x1F) * (1024 * 2));
   u16* map_ptr, *second_ptr;
   u8* tile_ptr;
   
   end -= start;
   
   if ((map_size & 0x02) && (vertical_offset >= 256))
   {
      map_base += ((map_width / 8) * 32) +
                  (((vertical_offset - 256) / 8) * 32);
   }
   else
      map_base += (((vertical_offset % 256) / 8) * 32);
      
   if (map_size & 0x01)
   {
      if (horizontal_offset >= 256)
      {
         horizontal_offset -= 256;
         map_ptr = map_base + (32 * 32) + (horizontal_offset / 8);
         second_ptr = map_base;
      }
      else
      {
         map_ptr = map_base + (horizontal_offset / 8);
         second_ptr = map_base + (32 * 32);
      }
   }
   else
   {
      horizontal_offset %= 256;
      map_ptr = map_base + (horizontal_offset / 8);
      second_ptr = map_base;
   }
   
   if (bg_control & 0x80)
   {
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  8;
      u32 vertical_pixel_flip =
         ((64 - 8) -
          vertical_pixel_offset) - vertical_pixel_offset;
      ;
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                              partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine; ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };;
               }
               else
               {
                  if (partial_tile_offset >= 4)
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine; ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr + 4));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };;
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine; ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine; ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
                     };
                     dest_ptr += 4;
                  };
               }
               else
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine; ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine; ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
                     };
                     dest_ptr += 4;
                  };
               };
               map_ptr++;
            }
         }
         
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
                  };
                  dest_ptr += 4;
               };
            }
            else
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
                  };
                  dest_ptr += 4;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
               };
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 3] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 2] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 1] = current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[4 + 0] = current_pixel | pixel_combine; ;
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
               };
               current_pixels = *((u32*)(tile_ptr + 4));
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 0] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 1] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 2] = current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[4 + 3] = current_pixel | pixel_combine; ;
               };
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)(tile_ptr + 4));
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
            };
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 3] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 2] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 1] = current_pixel | pixel_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[4 + 0] = current_pixel | pixel_combine; ;
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
            };
            current_pixels = *((u32*)(tile_ptr + 4));
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 0] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 1] = current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 2] = current_pixel | pixel_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[4 + 3] = current_pixel | pixel_combine; ;
            };
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
               };
               dest_ptr += 4;
               tile_ptr -= 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr + 4));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0] = current_pixel | pixel_combine; ;
               current_pixels <<= 8;
               dest_ptr += 1;
            };
         }
         else
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 0] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 3] = current_pixel | pixel_combine; ;
               };
               dest_ptr += 4;
               tile_ptr += 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0] = current_pixel | pixel_combine; ;
               current_pixels >>= 8;
               dest_ptr += 1;
            };
         };
      }
   }
   else
   {
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  4;
      u32 vertical_pixel_flip =
         ((32 - 4) -
          vertical_pixel_offset) - vertical_pixel_offset;
      u32 current_palette;
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               map_ptr++;
            }
         }
         
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  };
                  current_pixels <<= 4;
                  dest_ptr += 1;
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  };
                  current_pixels >>= 4;
                  dest_ptr += 1;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[7] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[6] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[5] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[4] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[3] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[2] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[1] = current_pixel | pixel_combine;
                  };
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  };
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[1] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[2] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[3] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[4] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[5] = current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[6] = current_pixel | pixel_combine;
                  };
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[7] = current_pixel | pixel_combine;
                  };
               };
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[7] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[6] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[5] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[4] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[3] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[2] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[1] = current_pixel | pixel_combine;
               };
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               };
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[1] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[2] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[3] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[4] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[5] = current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[6] = current_pixel | pixel_combine;
               };
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[7] = current_pixel | pixel_combine;
               };
            };
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               };
               current_pixels <<= 4;
               dest_ptr += 1;
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               };
               current_pixels >>= 4;
               dest_ptr += 1;
            };
         };
      }
   }
}

static void render_scanline_text_base_alpha(u32 layer,
      u32 start, u32 end, void* scanline)
{
   u32 bg_combine = (((io_registers[REG_BLDCNT] >> 5) & 0x01) | ((
                        io_registers[REG_BLDCNT] >> (5 + 7)) & 0x02)) << 9;
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> layer) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (layer + 7)) & 0x02)) << 9 | (bg_combine << 16);
   if ((pixel_combine & 0x00000200) == 0)
   {
      render_scanline_text_base_color32(layer, start, end, scanline);
      return;
   };
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 map_width = map_widths[map_size];
   u32 horizontal_offset =
      (io_registers[REG_BG0HOFS + (layer * 2)] + start) % 512;
   u32 vertical_offset = (io_registers[REG_VCOUNT] +
                          io_registers[REG_BG0VOFS + (layer * 2)]) % 512;
   u32 current_pixel;
   u32 current_pixels;
   u32 partial_tile_run = 0;
   u32 partial_tile_offset;
   u32 tile_run;
   u32 i;
   u32* dest_ptr =
      ((u32*)scanline) + start;
      
   u16* map_base = (u16*)(vram + ((bg_control >> 8) & 0x1F) * (1024 * 2));
   u16* map_ptr, *second_ptr;
   u8* tile_ptr;
   
   end -= start;
   
   if ((map_size & 0x02) && (vertical_offset >= 256))
   {
      map_base += ((map_width / 8) * 32) +
                  (((vertical_offset - 256) / 8) * 32);
   }
   else
      map_base += (((vertical_offset % 256) / 8) * 32);
      
   if (map_size & 0x01)
   {
      if (horizontal_offset >= 256)
      {
         horizontal_offset -= 256;
         map_ptr = map_base + (32 * 32) + (horizontal_offset / 8);
         second_ptr = map_base;
      }
      else
      {
         map_ptr = map_base + (horizontal_offset / 8);
         second_ptr = map_base + (32 * 32);
      }
   }
   else
   {
      horizontal_offset %= 256;
      map_ptr = map_base + (horizontal_offset / 8);
      second_ptr = map_base;
   }
   
   if (bg_control & 0x80)
   {
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  8;
      u32 vertical_pixel_flip =
         ((64 - 8) -
          vertical_pixel_offset) - vertical_pixel_offset;
      ;
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                              partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;
                           else
                              dest_ptr[0] = bg_combine; ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };;
               }
               else
               {
                  if (partial_tile_offset >= 4)
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;
                           else
                              dest_ptr[0] = bg_combine; ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr + 4));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };;
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;
                        else
                           dest_ptr[0] = bg_combine; ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;
                        else
                           dest_ptr[0] = bg_combine; ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 3] = bg_combine; ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 2] = bg_combine; ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 1] = bg_combine; ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 0] = bg_combine; ;
                     dest_ptr += 4;
                  };
               }
               else
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;
                        else
                           dest_ptr[0] = bg_combine; ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;
                        else
                           dest_ptr[0] = bg_combine; ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 0] = bg_combine; ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 1] = bg_combine; ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 2] = bg_combine; ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0 + 3] = bg_combine; ;
                     dest_ptr += 4;
                  };
               };
               map_ptr++;
            }
         }
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 3] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 3] = bg_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 2] = bg_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 1] = bg_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 0] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 0] = bg_combine; ;
                  dest_ptr += 4;
               };
            }
            else
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = current_pixel | pixel_combine;
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 0] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 0] = bg_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 1] = bg_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 2] = bg_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 3] = current_pixel | pixel_combine;
                  else
                     dest_ptr[0 + 3] = bg_combine; ;
                  dest_ptr += 4;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 3] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 2] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 1] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 0] = bg_combine; ;
               current_pixels = *((u32*)tile_ptr);
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 3] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 2] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 1] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[4 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 0] = bg_combine; ;
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 0] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 1] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 2] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 3] = bg_combine; ;
               current_pixels = *((u32*)(tile_ptr + 4));
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 0] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 1] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 2] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[4 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[4 + 3] = bg_combine; ;
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)(tile_ptr + 4));
            current_pixel = current_pixels & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 3] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 3] = bg_combine; ;
            current_pixel = (current_pixels >> 8) & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 2] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 2] = bg_combine; ;
            current_pixel = (current_pixels >> 16) & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 1] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 1] = bg_combine; ;
            current_pixel = current_pixels >> 24;
            if (current_pixel)
               dest_ptr[0 + 0] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 0] = bg_combine; ;
            current_pixels = *((u32*)tile_ptr);
            current_pixel = current_pixels & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 3] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 3] = bg_combine; ;
            current_pixel = (current_pixels >> 8) & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 2] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 2] = bg_combine; ;
            current_pixel = (current_pixels >> 16) & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 1] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 1] = bg_combine; ;
            current_pixel = current_pixels >> 24;
            if (current_pixel)
               dest_ptr[4 + 0] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 0] = bg_combine; ;
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            current_pixel = current_pixels & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 0] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 0] = bg_combine; ;
            current_pixel = (current_pixels >> 8) & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 1] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 1] = bg_combine; ;
            current_pixel = (current_pixels >> 16) & 0xFF;
            if (current_pixel)
               dest_ptr[0 + 2] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 2] = bg_combine; ;
            current_pixel = current_pixels >> 24;
            if (current_pixel)
               dest_ptr[0 + 3] = current_pixel | pixel_combine;
            else
               dest_ptr[0 + 3] = bg_combine; ;
            current_pixels = *((u32*)(tile_ptr + 4));
            current_pixel = current_pixels & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 0] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 0] = bg_combine; ;
            current_pixel = (current_pixels >> 8) & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 1] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 1] = bg_combine; ;
            current_pixel = (current_pixels >> 16) & 0xFF;
            if (current_pixel)
               dest_ptr[4 + 2] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 2] = bg_combine; ;
            current_pixel = current_pixels >> 24;
            if (current_pixel)
               dest_ptr[4 + 3] = current_pixel | pixel_combine;
            else
               dest_ptr[4 + 3] = bg_combine; ;
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 3] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 2] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 1] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 0] = bg_combine; ;
               dest_ptr += 4;
               tile_ptr -= 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr + 4));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0] = bg_combine; ;
               current_pixels <<= 8;
               dest_ptr += 1;
            };
         }
         else
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)tile_ptr);
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 0] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 1] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 2] = bg_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 3] = current_pixel | pixel_combine;
               else
                  dest_ptr[0 + 3] = bg_combine; ;
               dest_ptr += 4;
               tile_ptr += 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0] = current_pixel | pixel_combine;
               else
                  dest_ptr[0] = bg_combine; ;
               current_pixels >>= 8;
               dest_ptr += 1;
            };
         };
      }
   }
   else
   {
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  4;
      u32 vertical_pixel_flip =
         ((32 - 4) -
          vertical_pixel_offset) - vertical_pixel_offset;
      u32 current_palette;
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     }
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     }
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     }
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     }
                     else
                        dest_ptr[0] = bg_combine; ;
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               map_ptr++;
            }
         }
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[0] = bg_combine; ;
                  current_pixels <<= 4;
                  dest_ptr += 1;
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[0] = bg_combine; ;
                  current_pixels >>= 4;
                  dest_ptr += 1;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[7] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[7] = bg_combine; ;
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[6] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[6] = bg_combine; ;
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[5] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[5] = bg_combine; ;
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[4] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[4] = bg_combine; ;
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[3] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[3] = bg_combine; ;
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[2] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[2] = bg_combine; ;
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[1] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[1] = bg_combine; ;
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[0] = bg_combine; ;
               }
               else
               {
                  dest_ptr[0] = bg_combine;
                  dest_ptr[1] = bg_combine;
                  dest_ptr[2] = bg_combine;
                  dest_ptr[3] = bg_combine;
                  dest_ptr[4] = bg_combine;
                  dest_ptr[5] = bg_combine;
                  dest_ptr[6] = bg_combine;
                  dest_ptr[7] = bg_combine;
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[0] = bg_combine; ;
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[1] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[1] = bg_combine; ;
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[2] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[2] = bg_combine; ;
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[3] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[3] = bg_combine; ;
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[4] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[4] = bg_combine; ;
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[5] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[5] = bg_combine; ;
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[6] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[6] = bg_combine; ;
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[7] = current_pixel | pixel_combine;
                  }
                  else
                     dest_ptr[7] = bg_combine; ;
               }
               else
               {
                  dest_ptr[0] = bg_combine;
                  dest_ptr[1] = bg_combine;
                  dest_ptr[2] = bg_combine;
                  dest_ptr[3] = bg_combine;
                  dest_ptr[4] = bg_combine;
                  dest_ptr[5] = bg_combine;
                  dest_ptr[6] = bg_combine;
                  dest_ptr[7] = bg_combine;
               };
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[7] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[7] = bg_combine; ;
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[6] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[6] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[5] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[5] = bg_combine; ;
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[4] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[4] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[3] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[3] = bg_combine; ;
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[2] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[2] = bg_combine; ;
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[1] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[1] = bg_combine; ;
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[0] = bg_combine; ;
            }
            else
            {
               dest_ptr[0] = bg_combine;
               dest_ptr[1] = bg_combine;
               dest_ptr[2] = bg_combine;
               dest_ptr[3] = bg_combine;
               dest_ptr[4] = bg_combine;
               dest_ptr[5] = bg_combine;
               dest_ptr[6] = bg_combine;
               dest_ptr[7] = bg_combine;
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[0] = bg_combine; ;
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[1] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[1] = bg_combine; ;
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[2] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[2] = bg_combine; ;
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[3] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[3] = bg_combine; ;
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[4] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[4] = bg_combine; ;
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[5] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[5] = bg_combine; ;
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[6] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[6] = bg_combine; ;
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[7] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[7] = bg_combine; ;
            }
            else
            {
               dest_ptr[0] = bg_combine;
               dest_ptr[1] = bg_combine;
               dest_ptr[2] = bg_combine;
               dest_ptr[3] = bg_combine;
               dest_ptr[4] = bg_combine;
               dest_ptr[5] = bg_combine;
               dest_ptr[6] = bg_combine;
               dest_ptr[7] = bg_combine;
            };
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[0] = bg_combine; ;
               current_pixels <<= 4;
               dest_ptr += 1;
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = current_pixel | pixel_combine;
               }
               else
                  dest_ptr[0] = bg_combine; ;
               current_pixels >>= 4;
               dest_ptr += 1;
            };
         };
      }
   }
}

static void render_scanline_text_transparent_alpha(u32 layer,
      u32 start, u32 end, void* scanline)
{
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> layer) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (layer + 7)) & 0x02)) << 9;
   if ((pixel_combine & 0x00000200) == 0)
   {
      render_scanline_text_transparent_color32(layer, start, end, scanline);
      return;
   };
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 map_width = map_widths[map_size];
   u32 horizontal_offset =
      (io_registers[REG_BG0HOFS + (layer * 2)] + start) % 512;
   u32 vertical_offset = (io_registers[REG_VCOUNT] +
                          io_registers[REG_BG0VOFS + (layer * 2)]) % 512;
   u32 current_pixel;
   u32 current_pixels;
   u32 partial_tile_run = 0;
   u32 partial_tile_offset;
   u32 tile_run;
   u32 i;
   u32* dest_ptr =
      ((u32*)scanline) + start;
      
   u16* map_base = (u16*)(vram + ((bg_control >> 8) & 0x1F) * (1024 * 2));
   u16* map_ptr, *second_ptr;
   u8* tile_ptr;
   
   end -= start;
   
   if ((map_size & 0x02) && (vertical_offset >= 256))
   {
      map_base += ((map_width / 8) * 32) +
                  (((vertical_offset - 256) / 8) * 32);
   }
   else
      map_base += (((vertical_offset % 256) / 8) * 32);
      
   if (map_size & 0x01)
   {
      if (horizontal_offset >= 256)
      {
         horizontal_offset -= 256;
         map_ptr = map_base + (32 * 32) + (horizontal_offset / 8);
         second_ptr = map_base;
      }
      else
      {
         map_ptr = map_base + (horizontal_offset / 8);
         second_ptr = map_base + (32 * 32);
      }
   }
   else
   {
      horizontal_offset %= 256;
      map_ptr = map_base + (horizontal_offset / 8);
      second_ptr = map_base;
   }
   
   if (bg_control & 0x80)
   {
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  8;
      u32 vertical_pixel_flip =
         ((64 - 8) -
          vertical_pixel_offset) - vertical_pixel_offset;
      ;
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                              partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine; ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };;
               }
               else
               {
                  if (partial_tile_offset >= 4)
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  else
                  {
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     if ((partial_tile_offset + partial_tile_run) > 4)
                     {
                        u32 old_run = partial_tile_run;
                        partial_tile_run = 4 - partial_tile_offset;
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine; ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                        partial_tile_run = old_run - partial_tile_run;
                        current_pixels = *((u32*)(tile_ptr + 4));
                     }
                  }
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };;
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine; ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine; ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 3] = (dest_ptr[0 + 3] << 16) | current_pixel | pixel_combine; ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = (dest_ptr[0 + 2] << 16) | current_pixel | pixel_combine; ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = (dest_ptr[0 + 1] << 16) | current_pixel | pixel_combine; ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 0] = (dest_ptr[0 + 0] << 16) | current_pixel | pixel_combine; ;
                     };
                     dest_ptr += 4;
                  };
               }
               else
               {
                  if (partial_tile_offset >= 4)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine; ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
                  else
                  {
                     partial_tile_run -= 4;
                     current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine; ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 0] = (dest_ptr[0 + 0] << 16) | current_pixel | pixel_combine; ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = (dest_ptr[0 + 1] << 16) | current_pixel | pixel_combine; ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = (dest_ptr[0 + 2] << 16) | current_pixel | pixel_combine; ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 3] = (dest_ptr[0 + 3] << 16) | current_pixel | pixel_combine; ;
                     };
                     dest_ptr += 4;
                  };
               };
               map_ptr++;
            }
         }
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine; ;
                     current_pixels <<= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 3] = (dest_ptr[0 + 3] << 16) | current_pixel | pixel_combine; ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = (dest_ptr[0 + 2] << 16) | current_pixel | pixel_combine; ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = (dest_ptr[0 + 1] << 16) | current_pixel | pixel_combine; ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 0] = (dest_ptr[0 + 0] << 16) | current_pixel | pixel_combine; ;
                  };
                  dest_ptr += 4;
               };
            }
            else
            {
               if (partial_tile_offset >= 4)
               {
                  current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  partial_tile_run -= 4;
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine; ;
                     current_pixels >>= 8;
                     dest_ptr += 1;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 0] = (dest_ptr[0 + 0] << 16) | current_pixel | pixel_combine; ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = (dest_ptr[0 + 1] << 16) | current_pixel | pixel_combine; ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = (dest_ptr[0 + 2] << 16) | current_pixel | pixel_combine; ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 3] = (dest_ptr[0 + 3] << 16) | current_pixel | pixel_combine; ;
                  };
                  dest_ptr += 4;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 3] = (dest_ptr[0 + 3] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = (dest_ptr[0 + 2] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = (dest_ptr[0 + 1] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 0] = (dest_ptr[0 + 0] << 16) | current_pixel | pixel_combine; ;
               };
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 3] = (dest_ptr[4 + 3] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 2] = (dest_ptr[4 + 2] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 1] = (dest_ptr[4 + 1] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[4 + 0] = (dest_ptr[4 + 0] << 16) | current_pixel | pixel_combine; ;
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 0] = (dest_ptr[0 + 0] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = (dest_ptr[0 + 1] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = (dest_ptr[0 + 2] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 3] = (dest_ptr[0 + 3] << 16) | current_pixel | pixel_combine; ;
               };
               current_pixels = *((u32*)(tile_ptr + 4));
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 0] = (dest_ptr[4 + 0] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 1] = (dest_ptr[4 + 1] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[4 + 2] = (dest_ptr[4 + 2] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[4 + 3] = (dest_ptr[4 + 3] << 16) | current_pixel | pixel_combine; ;
               };
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)(tile_ptr + 4));
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 3] = (dest_ptr[0 + 3] << 16) | current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = (dest_ptr[0 + 2] << 16) | current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = (dest_ptr[0 + 1] << 16) | current_pixel | pixel_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 0] = (dest_ptr[0 + 0] << 16) | current_pixel | pixel_combine; ;
            };
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 3] = (dest_ptr[4 + 3] << 16) | current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 2] = (dest_ptr[4 + 2] << 16) | current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 1] = (dest_ptr[4 + 1] << 16) | current_pixel | pixel_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[4 + 0] = (dest_ptr[4 + 0] << 16) | current_pixel | pixel_combine; ;
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 0] = (dest_ptr[0 + 0] << 16) | current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 1] = (dest_ptr[0 + 1] << 16) | current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[0 + 2] = (dest_ptr[0 + 2] << 16) | current_pixel | pixel_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0 + 3] = (dest_ptr[0 + 3] << 16) | current_pixel | pixel_combine; ;
            };
            current_pixels = *((u32*)(tile_ptr + 4));
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 0] = (dest_ptr[4 + 0] << 16) | current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 8) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 1] = (dest_ptr[4 + 1] << 16) | current_pixel | pixel_combine; ;
               current_pixel = (current_pixels >> 16) & 0xFF;
               if (current_pixel)
                  dest_ptr[4 + 2] = (dest_ptr[4 + 2] << 16) | current_pixel | pixel_combine; ;
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[4 + 3] = (dest_ptr[4 + 3] << 16) | current_pixel | pixel_combine; ;
            };
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 64);
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)(tile_ptr + 4));
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 3] = (dest_ptr[0 + 3] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = (dest_ptr[0 + 2] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = (dest_ptr[0 + 1] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 0] = (dest_ptr[0 + 0] << 16) | current_pixel | pixel_combine; ;
               };
               dest_ptr += 4;
               tile_ptr -= 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr + 4));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 24;
               if (current_pixel)
                  dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine; ;
               current_pixels <<= 8;
               dest_ptr += 1;
            };
         }
         else
         {
            if (partial_tile_run >= 4)
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 0] = (dest_ptr[0 + 0] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 8) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 1] = (dest_ptr[0 + 1] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = (current_pixels >> 16) & 0xFF;
                  if (current_pixel)
                     dest_ptr[0 + 2] = (dest_ptr[0 + 2] << 16) | current_pixel | pixel_combine; ;
                  current_pixel = current_pixels >> 24;
                  if (current_pixel)
                     dest_ptr[0 + 3] = (dest_ptr[0 + 3] << 16) | current_pixel | pixel_combine; ;
               };
               dest_ptr += 4;
               tile_ptr += 4;
               partial_tile_run -= 4;
            }
            current_pixels = *((u32*)(tile_ptr));
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0xFF;
               if (current_pixel)
                  dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine; ;
               current_pixels >>= 8;
               dest_ptr += 1;
            };
         };
      }
   }
   else
   {
   
   
   
   
   
   
      u32 vertical_pixel_offset = (vertical_offset % 8) *
                                  4;
      u32 vertical_pixel_flip =
         ((32 - 4) -
          vertical_pixel_offset) - vertical_pixel_offset;
      u32 current_palette;
      u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16)) +
                      vertical_pixel_offset;
      u32 pixel_run = 256 - (horizontal_offset % 256);
      u32 current_tile;
      
      map_base += ((vertical_offset % 256) / 8) * 32;
      partial_tile_offset = (horizontal_offset % 8);
      
      if (pixel_run >= end)
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            if (end < partial_tile_run)
            {
               partial_tile_run = end;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;
                     };
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;
                     };
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               return;
            }
            else
            {
               end -= partial_tile_run;
               current_tile = *map_ptr;
               current_palette = (current_tile >> 12) << 4;
               tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
               if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
               if (current_tile & 0x400)
               {
                  current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;
                     };
                     current_pixels <<= 4;
                     dest_ptr += 1;
                  };
               }
               else
               {
                  current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                  for (i = 0; i < partial_tile_run; i++)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;
                     };
                     current_pixels >>= 4;
                     dest_ptr += 1;
                  };
               };
               map_ptr++;
            }
         }
      }
      else
      {
         if (partial_tile_offset)
         {
            partial_tile_run = 8 - partial_tile_offset;
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixels <<= 4;
                  dest_ptr += 1;
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
               for (i = 0; i < partial_tile_run; i++)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixels >>= 4;
                  dest_ptr += 1;
               };
            };
            map_ptr++;
         }
         
         tile_run = (pixel_run - partial_tile_run) / 8;
         for (i = 0; i < tile_run; i++)
         {
            current_tile = *map_ptr;
            current_palette = (current_tile >> 12) << 4;
            tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
            if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
            if (current_tile & 0x400)
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[7] = (dest_ptr[7] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[6] = (dest_ptr[6] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[5] = (dest_ptr[5] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[4] = (dest_ptr[4] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[3] = (dest_ptr[3] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[2] = (dest_ptr[2] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[1] = (dest_ptr[1] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;
                  };
               };
            }
            else
            {
               current_pixels = *((u32*)tile_ptr);
               if (current_pixels != 0)
               {
                  current_pixel = current_pixels & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 4) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[1] = (dest_ptr[1] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 8) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[2] = (dest_ptr[2] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 12) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[3] = (dest_ptr[3] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 16) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[4] = (dest_ptr[4] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 20) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[5] = (dest_ptr[5] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixel = (current_pixels >> 24) & 0x0F;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[6] = (dest_ptr[6] << 16) | current_pixel | pixel_combine;
                  };
                  current_pixel = current_pixels >> 28;
                  if (current_pixel)
                  {
                     current_pixel |= current_palette;
                     dest_ptr[7] = (dest_ptr[7] << 16) | current_pixel | pixel_combine;
                  };
               };
            };
            dest_ptr += 8;
            map_ptr++;
         };
         map_ptr = second_ptr;
         end -= pixel_run;
      }
      tile_run = end / 8;
      for (i = 0; i < tile_run; i++)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[7] = (dest_ptr[7] << 16) | current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[6] = (dest_ptr[6] << 16) | current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[5] = (dest_ptr[5] << 16) | current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[4] = (dest_ptr[4] << 16) | current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[3] = (dest_ptr[3] << 16) | current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[2] = (dest_ptr[2] << 16) | current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[1] = (dest_ptr[1] << 16) | current_pixel | pixel_combine;
               };
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;
               };
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            if (current_pixels != 0)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 4) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[1] = (dest_ptr[1] << 16) | current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 8) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[2] = (dest_ptr[2] << 16) | current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 12) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[3] = (dest_ptr[3] << 16) | current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 16) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[4] = (dest_ptr[4] << 16) | current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 20) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[5] = (dest_ptr[5] << 16) | current_pixel | pixel_combine;
               };
               current_pixel = (current_pixels >> 24) & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[6] = (dest_ptr[6] << 16) | current_pixel | pixel_combine;
               };
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[7] = (dest_ptr[7] << 16) | current_pixel | pixel_combine;
               };
            };
         };
         dest_ptr += 8;
         map_ptr++;
      };
      
      partial_tile_run = end % 8;
      if (partial_tile_run)
      {
         current_tile = *map_ptr;
         current_palette = (current_tile >> 12) << 4;
         tile_ptr = tile_base + ((current_tile & 0x3FF) * 32);;
         if (current_tile & 0x800) tile_ptr += vertical_pixel_flip;
         if (current_tile & 0x400)
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels >> 28;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;
               };
               current_pixels <<= 4;
               dest_ptr += 1;
            };
         }
         else
         {
            current_pixels = *((u32*)tile_ptr);
            for (i = 0; i < partial_tile_run; i++)
            {
               current_pixel = current_pixels & 0x0F;
               if (current_pixel)
               {
                  current_pixel |= current_palette;
                  dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;
               };
               current_pixels >>= 4;
               dest_ptr += 1;
            };
         };
      }
   }
}

s32 affine_reference_x[2];
s32 affine_reference_y[2];

void render_scanline_affine_base_normal(u32 layer, u32 start, u32 end,
                                        void* scanline)
{
   u16* palette = palette_ram_converted;
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 current_pixel;
   s32 source_x, source_y;
   u32 pixel_x, pixel_y;
   u32 layer_offset = (layer - 2) * 8;
   s32 dx, dy;
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 width_height = 1 << (7 + map_size);
   u32 map_pitch = map_size + 4;
   u8* map_base = vram + (((bg_control >> 8) & 0x1F) * (1024 * 2));
   u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16));
   u8* tile_ptr = NULL;
   u32 map_offset, last_map_offset = (u32) - 1;
   u32 i;
   u16* dest_ptr = ((u16*)scanline) + start;
   dx = (s16)io_registers[REG_BG2PA + layer_offset];
   dy = (s16)io_registers[REG_BG2PC + layer_offset];
   source_x = affine_reference_x[layer - 2] + (start * dx);
   source_y = affine_reference_y[layer - 2] + (start * dy);
   end -= start;
   switch (((bg_control >> 12) & 0x02) | (dy != 0))
   {
   case 0x00:
   {
      pixel_y = source_y >> 8;
      u32 i = 0;
      current_pixel = palette_ram_converted[0];
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x < (u32)width_height)
               break;
            dest_ptr[0] = current_pixel;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x >= (u32)width_height) break;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            current_pixel = palette[current_pixel];;
            dest_ptr[0] = current_pixel;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      }
      current_pixel = palette_ram_converted[0];
      for (; i < end; i++)
      {
         dest_ptr[0] = current_pixel;
         dest_ptr += 1;
      };
   };
   break;
   case 0x01:
   {
      current_pixel = palette_ram_converted[0];
      for (i = 0; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x < (u32)width_height) && ((u32)pixel_y < (u32)width_height))
            break;
         dest_ptr[0] = current_pixel;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
      for (; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x >= (u32)width_height) || ((u32)pixel_y >= (u32)width_height))
         {
            current_pixel = palette_ram_converted[0];
            for (; i < end; i++)
            {
               dest_ptr[0] = current_pixel;
               dest_ptr += 1;
            };
            break;
         }
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         current_pixel = palette[current_pixel];;
         dest_ptr[0] = current_pixel;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   case 0x02:
   {
      u32 wrap_mask = width_height - 1;
      pixel_y = (source_y >> 8) & wrap_mask;
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (i = 0; i < end; i++)
         {
            pixel_x = (source_x >> 8) & wrap_mask;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            current_pixel = palette[current_pixel];;
            dest_ptr[0] = current_pixel;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      }
   };
   break;
   case 0x03:
   {
      u32 wrap_mask = width_height - 1;
      for (i = 0; i < end; i++)
      {
         pixel_x = (source_x >> 8) & wrap_mask;
         pixel_y = (source_y >> 8) & wrap_mask;
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         current_pixel = palette[current_pixel];;
         dest_ptr[0] = current_pixel;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   }
};
void render_scanline_affine_transparent_normal(u32 layer, u32 start, u32 end,
      void* scanline)
{
   u16* palette = palette_ram_converted;
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 current_pixel;
   s32 source_x, source_y;
   u32 pixel_x, pixel_y;
   u32 layer_offset = (layer - 2) * 8;
   s32 dx, dy;
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 width_height = 1 << (7 + map_size);
   u32 map_pitch = map_size + 4;
   u8* map_base = vram + (((bg_control >> 8) & 0x1F) * (1024 * 2));
   u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16));
   u8* tile_ptr = NULL;
   u32 map_offset, last_map_offset = (u32) - 1;
   u32 i;
   u16* dest_ptr = ((u16*)scanline) + start;
   dx = (s16)io_registers[REG_BG2PA + layer_offset];
   dy = (s16)io_registers[REG_BG2PC + layer_offset];
   source_x = affine_reference_x[layer - 2] + (start * dx);
   source_y = affine_reference_y[layer - 2] + (start * dy);
   end -= start;
   switch (((bg_control >> 12) & 0x02) | (dy != 0))
   {
   case 0x00:
   {
      pixel_y = source_y >> 8;
      u32 i = 0; ;
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x < (u32)width_height)
               break;   ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x >= (u32)width_height) break;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            if (current_pixel)
            {
               current_pixel = palette[current_pixel];;
               dest_ptr[0] = current_pixel;
            };
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      } ;
   };
   break;
   case 0x01:
   {
      ;
      for (i = 0; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x < (u32)width_height) && ((u32)pixel_y < (u32)width_height))
            break;   ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
      for (; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x >= (u32)width_height) || ((u32)pixel_y >= (u32)width_height))
         {
            ;
            break;
         }
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         if (current_pixel)
         {
            current_pixel = palette[current_pixel];;
            dest_ptr[0] = current_pixel;
         };
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   case 0x02:
   {
      u32 wrap_mask = width_height - 1;
      pixel_y = (source_y >> 8) & wrap_mask;
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (i = 0; i < end; i++)
         {
            pixel_x = (source_x >> 8) & wrap_mask;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            if (current_pixel)
            {
               current_pixel = palette[current_pixel];;
               dest_ptr[0] = current_pixel;
            };
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      }
   };
   break;
   case 0x03:
   {
      u32 wrap_mask = width_height - 1;
      for (i = 0; i < end; i++)
      {
         pixel_x = (source_x >> 8) & wrap_mask;
         pixel_y = (source_y >> 8) & wrap_mask;
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         if (current_pixel)
         {
            current_pixel = palette[current_pixel];;
            dest_ptr[0] = current_pixel;
         };
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   }
};
void render_scanline_affine_base_color16(u32 layer, u32 start, u32 end,
      void* scanline)
{
   u32 bg_combine = (((io_registers[REG_BLDCNT] >> 5) & 0x01) | ((
                        io_registers[REG_BLDCNT] >> (5 + 7)) & 0x02)) << 9;
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> layer) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (layer + 7)) & 0x02)) << 9;
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 current_pixel;
   s32 source_x, source_y;
   u32 pixel_x, pixel_y;
   u32 layer_offset = (layer - 2) * 8;
   s32 dx, dy;
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 width_height = 1 << (7 + map_size);
   u32 map_pitch = map_size + 4;
   u8* map_base = vram + (((bg_control >> 8) & 0x1F) * (1024 * 2));
   u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16));
   u8* tile_ptr = NULL;
   u32 map_offset, last_map_offset = (u32) - 1;
   u32 i;
   u16* dest_ptr = ((u16*)scanline) + start;
   dx = (s16)io_registers[REG_BG2PA + layer_offset];
   dy = (s16)io_registers[REG_BG2PC + layer_offset];
   source_x = affine_reference_x[layer - 2] + (start * dx);
   source_y = affine_reference_y[layer - 2] + (start * dy);
   end -= start;
   switch (((bg_control >> 12) & 0x02) | (dy != 0))
   {
   case 0x00:
   {
      pixel_y = source_y >> 8;
      u32 i = 0;
      current_pixel = bg_combine;
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x < (u32)width_height)
               break;
            dest_ptr[0] = current_pixel;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x >= (u32)width_height) break;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            if (current_pixel)
               dest_ptr[0] = current_pixel | pixel_combine;
            else
               dest_ptr[0] = bg_combine;  ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      }
      current_pixel = bg_combine;
      for (; i < end; i++)
      {
         dest_ptr[0] = current_pixel;
         dest_ptr += 1;
      };
   };
   break;
   case 0x01:
   {
      current_pixel = bg_combine;
      for (i = 0; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x < (u32)width_height) && ((u32)pixel_y < (u32)width_height))
            break;
         dest_ptr[0] = current_pixel;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
      for (; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x >= (u32)width_height) || ((u32)pixel_y >= (u32)width_height))
         {
            current_pixel = bg_combine;
            for (; i < end; i++)
            {
               dest_ptr[0] = current_pixel;
               dest_ptr += 1;
            };
            break;
         }
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         if (current_pixel)
            dest_ptr[0] = current_pixel | pixel_combine;
         else
            dest_ptr[0] = bg_combine;  ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   case 0x02:
   {
      u32 wrap_mask = width_height - 1;
      pixel_y = (source_y >> 8) & wrap_mask;
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (i = 0; i < end; i++)
         {
            pixel_x = (source_x >> 8) & wrap_mask;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            if (current_pixel)
               dest_ptr[0] = current_pixel | pixel_combine;
            else
               dest_ptr[0] = bg_combine;  ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      }
   };
   break;
   case 0x03:
   {
      u32 wrap_mask = width_height - 1;
      for (i = 0; i < end; i++)
      {
         pixel_x = (source_x >> 8) & wrap_mask;
         pixel_y = (source_y >> 8) & wrap_mask;
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         if (current_pixel)
            dest_ptr[0] = current_pixel | pixel_combine;
         else
            dest_ptr[0] = bg_combine;  ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   }
};
void render_scanline_affine_transparent_color16(u32 layer, u32 start, u32 end,
      void* scanline)
{
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> layer) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (layer + 7)) & 0x02)) << 9;
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 current_pixel;
   s32 source_x, source_y;
   u32 pixel_x, pixel_y;
   u32 layer_offset = (layer - 2) * 8;
   s32 dx, dy;
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 width_height = 1 << (7 + map_size);
   u32 map_pitch = map_size + 4;
   u8* map_base = vram + (((bg_control >> 8) & 0x1F) * (1024 * 2));
   u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16));
   u8* tile_ptr = NULL;
   u32 map_offset, last_map_offset = (u32) - 1;
   u32 i;
   u16* dest_ptr = ((u16*)scanline) + start;
   dx = (s16)io_registers[REG_BG2PA + layer_offset];
   dy = (s16)io_registers[REG_BG2PC + layer_offset];
   source_x = affine_reference_x[layer - 2] + (start * dx);
   source_y = affine_reference_y[layer - 2] + (start * dy);
   end -= start;
   switch (((bg_control >> 12) & 0x02) | (dy != 0))
   {
   case 0x00:
   {
      pixel_y = source_y >> 8;
      u32 i = 0; ;
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x < (u32)width_height)
               break;   ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x >= (u32)width_height) break;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            if (current_pixel)
               dest_ptr[0] = current_pixel | pixel_combine;  ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      } ;
   };
   break;
   case 0x01:
   {
      ;
      for (i = 0; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x < (u32)width_height) && ((u32)pixel_y < (u32)width_height))
            break;   ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
      for (; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x >= (u32)width_height) || ((u32)pixel_y >= (u32)width_height))
         {
            ;
            break;
         }
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         if (current_pixel)
            dest_ptr[0] = current_pixel | pixel_combine;  ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   case 0x02:
   {
      u32 wrap_mask = width_height - 1;
      pixel_y = (source_y >> 8) & wrap_mask;
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (i = 0; i < end; i++)
         {
            pixel_x = (source_x >> 8) & wrap_mask;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            if (current_pixel)
               dest_ptr[0] = current_pixel | pixel_combine;  ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      }
   };
   break;
   case 0x03:
   {
      u32 wrap_mask = width_height - 1;
      for (i = 0; i < end; i++)
      {
         pixel_x = (source_x >> 8) & wrap_mask;
         pixel_y = (source_y >> 8) & wrap_mask;
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         if (current_pixel)
            dest_ptr[0] = current_pixel | pixel_combine;  ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   }
};
void render_scanline_affine_base_color32(u32 layer, u32 start, u32 end,
      void* scanline)
{
   u32 bg_combine = (((io_registers[REG_BLDCNT] >> 5) & 0x01) | ((
                        io_registers[REG_BLDCNT] >> (5 + 7)) & 0x02)) << 9;
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> layer) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (layer + 7)) & 0x02)) << 9;
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 current_pixel;
   s32 source_x, source_y;
   u32 pixel_x, pixel_y;
   u32 layer_offset = (layer - 2) * 8;
   s32 dx, dy;
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 width_height = 1 << (7 + map_size);
   u32 map_pitch = map_size + 4;
   u8* map_base = vram + (((bg_control >> 8) & 0x1F) * (1024 * 2));
   u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16));
   u8* tile_ptr = NULL;
   u32 map_offset, last_map_offset = (u32) - 1;
   u32 i;
   u32* dest_ptr = ((u32*)scanline) + start;
   dx = (s16)io_registers[REG_BG2PA + layer_offset];
   dy = (s16)io_registers[REG_BG2PC + layer_offset];
   source_x = affine_reference_x[layer - 2] + (start * dx);
   source_y = affine_reference_y[layer - 2] + (start * dy);
   end -= start;
   switch (((bg_control >> 12) & 0x02) | (dy != 0))
   {
   case 0x00:
   {
      pixel_y = source_y >> 8;
      u32 i = 0;
      current_pixel = bg_combine;
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x < (u32)width_height)
               break;
            dest_ptr[0] = current_pixel;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x >= (u32)width_height) break;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            if (current_pixel)
               dest_ptr[0] = current_pixel | pixel_combine;
            else
               dest_ptr[0] = bg_combine;  ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      }
      current_pixel = bg_combine;
      for (; i < end; i++)
      {
         dest_ptr[0] = current_pixel;
         dest_ptr += 1;
      };
   };
   break;
   case 0x01:
   {
      current_pixel = bg_combine;
      for (i = 0; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x < (u32)width_height) && ((u32)pixel_y < (u32)width_height))
            break;
         dest_ptr[0] = current_pixel;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
      for (; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x >= (u32)width_height) || ((u32)pixel_y >= (u32)width_height))
         {
            current_pixel = bg_combine;
            for (; i < end; i++)
            {
               dest_ptr[0] = current_pixel;
               dest_ptr += 1;
            };
            break;
         }
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         if (current_pixel)
            dest_ptr[0] = current_pixel | pixel_combine;
         else
            dest_ptr[0] = bg_combine;  ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   case 0x02:
   {
      u32 wrap_mask = width_height - 1;
      pixel_y = (source_y >> 8) & wrap_mask;
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (i = 0; i < end; i++)
         {
            pixel_x = (source_x >> 8) & wrap_mask;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            if (current_pixel)
               dest_ptr[0] = current_pixel | pixel_combine;
            else
               dest_ptr[0] = bg_combine;  ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      }
   };
   break;
   case 0x03:
   {
      u32 wrap_mask = width_height - 1;
      for (i = 0; i < end; i++)
      {
         pixel_x = (source_x >> 8) & wrap_mask;
         pixel_y = (source_y >> 8) & wrap_mask;
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         if (current_pixel)
            dest_ptr[0] = current_pixel | pixel_combine;
         else
            dest_ptr[0] = bg_combine;  ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   }
};
void render_scanline_affine_transparent_color32(u32 layer, u32 start, u32 end,
      void* scanline)
{
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> layer) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (layer + 7)) & 0x02)) << 9;
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 current_pixel;
   s32 source_x, source_y;
   u32 pixel_x, pixel_y;
   u32 layer_offset = (layer - 2) * 8;
   s32 dx, dy;
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 width_height = 1 << (7 + map_size);
   u32 map_pitch = map_size + 4;
   u8* map_base = vram + (((bg_control >> 8) & 0x1F) * (1024 * 2));
   u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16));
   u8* tile_ptr = NULL;
   u32 map_offset, last_map_offset = (u32) - 1;
   u32 i;
   u32* dest_ptr = ((u32*)scanline) + start;
   dx = (s16)io_registers[REG_BG2PA + layer_offset];
   dy = (s16)io_registers[REG_BG2PC + layer_offset];
   source_x = affine_reference_x[layer - 2] + (start * dx);
   source_y = affine_reference_y[layer - 2] + (start * dy);
   end -= start;
   switch (((bg_control >> 12) & 0x02) | (dy != 0))
   {
   case 0x00:
   {
      pixel_y = source_y >> 8;
      u32 i = 0; ;
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x < (u32)width_height)
               break;   ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x >= (u32)width_height) break;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            if (current_pixel)
               dest_ptr[0] = current_pixel | pixel_combine;  ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      } ;
   };
   break;
   case 0x01:
   {
      ;
      for (i = 0; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x < (u32)width_height) && ((u32)pixel_y < (u32)width_height))
            break;   ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
      for (; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x >= (u32)width_height) || ((u32)pixel_y >= (u32)width_height))
         {
            ;
            break;
         }
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         if (current_pixel)
            dest_ptr[0] = current_pixel | pixel_combine;  ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   case 0x02:
   {
      u32 wrap_mask = width_height - 1;
      pixel_y = (source_y >> 8) & wrap_mask;
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (i = 0; i < end; i++)
         {
            pixel_x = (source_x >> 8) & wrap_mask;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            if (current_pixel)
               dest_ptr[0] = current_pixel | pixel_combine;  ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      }
   };
   break;
   case 0x03:
   {
      u32 wrap_mask = width_height - 1;
      for (i = 0; i < end; i++)
      {
         pixel_x = (source_x >> 8) & wrap_mask;
         pixel_y = (source_y >> 8) & wrap_mask;
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         if (current_pixel)
            dest_ptr[0] = current_pixel | pixel_combine;  ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   }
};
void render_scanline_affine_base_alpha(u32 layer, u32 start, u32 end,
                                       void* scanline)
{
   u32 bg_combine = (((io_registers[REG_BLDCNT] >> 5) & 0x01) | ((
                        io_registers[REG_BLDCNT] >> (5 + 7)) & 0x02)) << 9;
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> layer) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (layer + 7)) & 0x02)) << 9 | (bg_combine << 16);
   if ((pixel_combine & 0x00000200) == 0)
   {
      render_scanline_affine_base_color32(layer, start, end, scanline);
      return;
   };
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 current_pixel;
   s32 source_x, source_y;
   u32 pixel_x, pixel_y;
   u32 layer_offset = (layer - 2) * 8;
   s32 dx, dy;
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 width_height = 1 << (7 + map_size);
   u32 map_pitch = map_size + 4;
   u8* map_base = vram + (((bg_control >> 8) & 0x1F) * (1024 * 2));
   u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16));
   u8* tile_ptr = NULL;
   u32 map_offset, last_map_offset = (u32) - 1;
   u32 i;
   u32* dest_ptr = ((u32*)scanline) + start;
   dx = (s16)io_registers[REG_BG2PA + layer_offset];
   dy = (s16)io_registers[REG_BG2PC + layer_offset];
   source_x = affine_reference_x[layer - 2] + (start * dx);
   source_y = affine_reference_y[layer - 2] + (start * dy);
   end -= start;
   switch (((bg_control >> 12) & 0x02) | (dy != 0))
   {
   case 0x00:
   {
      pixel_y = source_y >> 8;
      u32 i = 0;
      current_pixel = bg_combine;
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x < (u32)width_height)
               break;
            dest_ptr[0] = current_pixel;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x >= (u32)width_height) break;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            if (current_pixel)
               dest_ptr[0] = current_pixel | pixel_combine;
            else
               dest_ptr[0] = bg_combine;  ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      }
      current_pixel = bg_combine;
      for (; i < end; i++)
      {
         dest_ptr[0] = current_pixel;
         dest_ptr += 1;
      };
   };
   break;
   case 0x01:
   {
      current_pixel = bg_combine;
      for (i = 0; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x < (u32)width_height) && ((u32)pixel_y < (u32)width_height))
            break;
         dest_ptr[0] = current_pixel;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
      for (; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x >= (u32)width_height) || ((u32)pixel_y >= (u32)width_height))
         {
            current_pixel = bg_combine;
            for (; i < end; i++)
            {
               dest_ptr[0] = current_pixel;
               dest_ptr += 1;
            };
            break;
         }
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         if (current_pixel)
            dest_ptr[0] = current_pixel | pixel_combine;
         else
            dest_ptr[0] = bg_combine;  ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   case 0x02:
   {
      u32 wrap_mask = width_height - 1;
      pixel_y = (source_y >> 8) & wrap_mask;
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (i = 0; i < end; i++)
         {
            pixel_x = (source_x >> 8) & wrap_mask;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            if (current_pixel)
               dest_ptr[0] = current_pixel | pixel_combine;
            else
               dest_ptr[0] = bg_combine;  ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      }
   };
   break;
   case 0x03:
   {
      u32 wrap_mask = width_height - 1;
      for (i = 0; i < end; i++)
      {
         pixel_x = (source_x >> 8) & wrap_mask;
         pixel_y = (source_y >> 8) & wrap_mask;
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         if (current_pixel)
            dest_ptr[0] = current_pixel | pixel_combine;
         else
            dest_ptr[0] = bg_combine;  ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   }
};
void render_scanline_affine_transparent_alpha(u32 layer, u32 start, u32 end,
      void* scanline)
{
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> layer) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (layer + 7)) & 0x02)) << 9;
   if ((pixel_combine & 0x00000200) == 0)
   {
      render_scanline_affine_transparent_color32(layer, start, end, scanline);
      return;
   };
   u32 bg_control = io_registers[REG_BG0CNT + layer];
   u32 current_pixel;
   s32 source_x, source_y;
   u32 pixel_x, pixel_y;
   u32 layer_offset = (layer - 2) * 8;
   s32 dx, dy;
   u32 map_size = (bg_control >> 14) & 0x03;
   u32 width_height = 1 << (7 + map_size);
   u32 map_pitch = map_size + 4;
   u8* map_base = vram + (((bg_control >> 8) & 0x1F) * (1024 * 2));
   u8* tile_base = vram + (((bg_control >> 2) & 0x03) * (1024 * 16));
   u8* tile_ptr = NULL;
   u32 map_offset, last_map_offset = (u32) - 1;
   u32 i;
   u32* dest_ptr = ((u32*)scanline) + start;
   dx = (s16)io_registers[REG_BG2PA + layer_offset];
   dy = (s16)io_registers[REG_BG2PC + layer_offset];
   source_x = affine_reference_x[layer - 2] + (start * dx);
   source_y = affine_reference_y[layer - 2] + (start * dy);
   end -= start;
   switch (((bg_control >> 12) & 0x02) | (dy != 0))
   {
   case 0x00:
   {
      pixel_y = source_y >> 8;
      u32 i = 0; ;
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x < (u32)width_height)
               break;   ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
         for (; i < end; i++)
         {
            pixel_x = source_x >> 8;
            if ((u32)pixel_x >= (u32)width_height) break;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            if (current_pixel)
               dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;  ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      } ;
   };
   break;
   case 0x01:
   {
      ;
      for (i = 0; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x < (u32)width_height) && ((u32)pixel_y < (u32)width_height))
            break;   ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
      for (; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x >= (u32)width_height) || ((u32)pixel_y >= (u32)width_height))
         {
            ;
            break;
         }
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         if (current_pixel)
            dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;  ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   case 0x02:
   {
      u32 wrap_mask = width_height - 1;
      pixel_y = (source_y >> 8) & wrap_mask;
      if ((u32)pixel_y < (u32)width_height)
      {
         tile_base += ((pixel_y % 8) * 8);
         map_base += (pixel_y / 8) << map_pitch;
         for (i = 0; i < end; i++)
         {
            pixel_x = (source_x >> 8) & wrap_mask;
            map_offset = (pixel_x / 8);
            if (map_offset != last_map_offset)
            {
               tile_ptr = tile_base + (map_base[map_offset] * 64);
               last_map_offset = map_offset;
            }
            tile_ptr = tile_base + (map_base[(pixel_x / 8)] * 64);
            current_pixel = tile_ptr[(pixel_x % 8)]; ;
            if (current_pixel)
               dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;  ;
            source_x += dx;
            source_y += dy;
            dest_ptr += 1;
         }
      }
   };
   break;
   case 0x03:
   {
      u32 wrap_mask = width_height - 1;
      for (i = 0; i < end; i++)
      {
         pixel_x = (source_x >> 8) & wrap_mask;
         pixel_y = (source_y >> 8) & wrap_mask;
         map_offset = (pixel_x / 8) + ((pixel_y / 8) << map_pitch);
         if (map_offset != last_map_offset)
         {
            tile_ptr = tile_base + (map_base[map_offset] * 64);
            last_map_offset = map_offset;
         }
         current_pixel = tile_ptr[(pixel_x % 8) + ((pixel_y % 8) * 8)]; ;
         if (current_pixel)
            dest_ptr[0] = (dest_ptr[0] << 16) | current_pixel | pixel_combine;  ;
         source_x += dx;
         source_y += dy;
         dest_ptr += 1;
      }
   };
   break;
   }
};

static void render_scanline_bitmap_mode3_normal(u32 start, u32 end,
      void* scanline)
{
   u32 current_pixel;
   s32 source_x, source_y;
   s32 pixel_x, pixel_y;
   s32 dx = (s16)io_registers[REG_BG2PA];
   s32 dy = (s16)io_registers[REG_BG2PC];
   u32 i;
   u16* dest_ptr = ((u16*)scanline) + start;
   u16* src_ptr = (u16*)vram;
   end -= start;
   source_x = affine_reference_x[0] + (start * dx);
   source_y = affine_reference_y[0] + (start * dy);
   if (dy == 0)
   {
      pixel_y = (source_y >> 8);
      if ((u32)pixel_y < (u32)160)
      {
         pixel_x = (source_x >> 8);
         src_ptr += (pixel_y * 240);
         if (dx == 0x100)
         {
            if (pixel_x < 0)
            {
               end += pixel_x;
               dest_ptr -= pixel_x;
               pixel_x = 0;
            }
            else if (pixel_x > 0) src_ptr += pixel_x;
            if ((pixel_x + end) >= 240) end = (240 - pixel_x);
            for (i = 0; (s32)i < (s32)end; i++)
            {
               current_pixel = *src_ptr;
               convert_palette(current_pixel);
               *dest_ptr = current_pixel;
               src_ptr++;
               dest_ptr++;
            }
         }
         else
         {
            if ((u32)(source_y >> 8) < (u32)160)
            {
               for (i = 0; i < end; i++)
               {
                  pixel_x = (source_x >> 8);
                  if ((u32)pixel_x < (u32)240) break;
                  source_x += dx;
                  dest_ptr++;
               }
               for (; i < end; i++)
               {
                  pixel_x = (source_x >> 8);
                  if ((u32)pixel_x >= (u32)240) break;
                  current_pixel = src_ptr[pixel_x];
                  convert_palette(current_pixel);
                  *dest_ptr = current_pixel;
                  source_x += dx;
                  dest_ptr++;
               }
            }
         }
      };
   }
   else
   {
      for (i = 0; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x < (u32)240) && ((u32)pixel_y < (u32)160)) break;
         source_x += dx;
         source_y += dy;
         dest_ptr++;
      }
      for (; i < end; i++)
      {
         pixel_x = (source_x >> 8);
         pixel_y = (source_y >> 8);
         if (((u32)pixel_x >= (u32)240) || ((u32)pixel_y >= (u32)160)) break;
         current_pixel = src_ptr[pixel_x + (pixel_y * 240)];
         convert_palette(current_pixel);
         *dest_ptr = current_pixel;
         source_x += dx;
         source_y += dy;
         dest_ptr++;
      };
   }
};
static void render_scanline_bitmap_mode4_normal(u32 start, u32 end,
      void* scanline)
{
   u32 current_pixel;
   s32 source_x, source_y;
   s32 pixel_x, pixel_y;
   s32 dx = (s16)io_registers[REG_BG2PA];
   s32 dy = (s16)io_registers[REG_BG2PC];
   u32 i;
   u16* dest_ptr = ((u16*)scanline) + start;
   u16* palette = palette_ram_converted;
   u8* src_ptr = vram;
   if (io_registers[REG_DISPCNT] & 0x10) src_ptr = vram + 0xA000;;
   end -= start;
   source_x = affine_reference_x[0] + (start * dx);
   source_y = affine_reference_y[0] + (start * dy);
   if (dy == 0)
   {
      pixel_y = (source_y >> 8);
      if ((u32)pixel_y < (u32)160)
      {
         pixel_x = (source_x >> 8);
         src_ptr += (pixel_y * 240);
         if (dx == 0x100)
         {
            if (pixel_x < 0)
            {
               end += pixel_x;
               dest_ptr -= pixel_x;
               pixel_x = 0;
            }
            else if (pixel_x > 0) src_ptr += pixel_x;
            if ((pixel_x + end) >= 240) end = (240 - pixel_x);
            for (i = 0; (s32)i < (s32)end; i++)
            {
               current_pixel = *src_ptr;
               current_pixel = palette[current_pixel];;
               dest_ptr[0] = current_pixel;
               src_ptr++;
               dest_ptr++;
            }
         }
         else
         {
            if ((u32)(source_y >> 8) < (u32)160)
            {
               for (i = 0; i < end; i++)
               {
                  pixel_x = (source_x >> 8);
                  if ((u32)pixel_x < (u32)240) break;
                  source_x += dx;
                  dest_ptr++;
               }
               for (; i < end; i++)
               {
                  pixel_x = (source_x >> 8);
                  if ((u32)pixel_x >= (u32)240) break;
                  current_pixel = src_ptr[pixel_x];
                  current_pixel = palette[current_pixel];;
                  dest_ptr[0] = current_pixel;
                  source_x += dx;
                  dest_ptr++;
               }
            }
         }
      };
   }
   else
   {
      for (i = 0; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x < (u32)240) && ((u32)pixel_y < (u32)160)) break;
         source_x += dx;
         source_y += dy;
         dest_ptr++;
      }
      for (; i < end; i++)
      {
         pixel_x = (source_x >> 8);
         pixel_y = (source_y >> 8);
         if (((u32)pixel_x >= (u32)240) || ((u32)pixel_y >= (u32)160)) break;
         current_pixel = src_ptr[pixel_x + (pixel_y * 240)];
         current_pixel = palette[current_pixel];;
         dest_ptr[0] = current_pixel;
         source_x += dx;
         source_y += dy;
         dest_ptr++;
      };
   }
};
static void render_scanline_bitmap_mode5_normal(u32 start, u32 end,
      void* scanline)
{
   u32 current_pixel;
   s32 source_x, source_y;
   s32 pixel_x, pixel_y;
   s32 dx = (s16)io_registers[REG_BG2PA];
   s32 dy = (s16)io_registers[REG_BG2PC];
   u32 i;
   u16* dest_ptr = ((u16*)scanline) + start;
   u16* src_ptr = (u16*)vram;
   if (io_registers[REG_DISPCNT] & 0x10) src_ptr = (u16*)(vram + 0xA000);;
   end -= start;
   source_x = affine_reference_x[0] + (start * dx);
   source_y = affine_reference_y[0] + (start * dy);
   if (dy == 0)
   {
      pixel_y = (source_y >> 8);
      if ((u32)pixel_y < (u32)128)
      {
         pixel_x = (source_x >> 8);
         src_ptr += (pixel_y * 160);
         if (dx == 0x100)
         {
            if (pixel_x < 0)
            {
               end += pixel_x;
               dest_ptr -= pixel_x;
               pixel_x = 0;
            }
            else if (pixel_x > 0) src_ptr += pixel_x;
            if ((pixel_x + end) >= 160) end = (160 - pixel_x);
            for (i = 0; (s32)i < (s32)end; i++)
            {
               current_pixel = *src_ptr;
               convert_palette(current_pixel);
               *dest_ptr = current_pixel;
               src_ptr++;
               dest_ptr++;
            }
         }
         else
         {
            if ((u32)(source_y >> 8) < (u32)128)
            {
               for (i = 0; i < end; i++)
               {
                  pixel_x = (source_x >> 8);
                  if ((u32)pixel_x < (u32)160) break;
                  source_x += dx;
                  dest_ptr++;
               }
               for (; i < end; i++)
               {
                  pixel_x = (source_x >> 8);
                  if ((u32)pixel_x >= (u32)160) break;
                  current_pixel = src_ptr[pixel_x];
                  convert_palette(current_pixel);
                  *dest_ptr = current_pixel;
                  source_x += dx;
                  dest_ptr++;
               }
            }
         }
      };
   }
   else
   {
      for (i = 0; i < end; i++)
      {
         pixel_x = source_x >> 8;
         pixel_y = source_y >> 8;
         if (((u32)pixel_x < (u32)160) && ((u32)pixel_y < (u32)128)) break;
         source_x += dx;
         source_y += dy;
         dest_ptr++;
      }
      for (; i < end; i++)
      {
         pixel_x = (source_x >> 8);
         pixel_y = (source_y >> 8);
         if (((u32)pixel_x >= (u32)160) || ((u32)pixel_y >= (u32)128)) break;
         current_pixel = src_ptr[pixel_x + (pixel_y * 160)];
         convert_palette(current_pixel);
         *dest_ptr = current_pixel;
         source_x += dx;
         source_y += dy;
         dest_ptr++;
      };
   }
};

static const tile_layer_render_struct tile_mode_renderers[3][4] =
{
   {
      { render_scanline_text_base_normal, render_scanline_text_transparent_normal, render_scanline_text_base_alpha, render_scanline_text_transparent_alpha, render_scanline_text_base_color16, render_scanline_text_transparent_color16, render_scanline_text_base_color32, render_scanline_text_transparent_color32 }, { render_scanline_text_base_normal, render_scanline_text_transparent_normal, render_scanline_text_base_alpha, render_scanline_text_transparent_alpha, render_scanline_text_base_color16, render_scanline_text_transparent_color16, render_scanline_text_base_color32, render_scanline_text_transparent_color32 },
      { render_scanline_text_base_normal, render_scanline_text_transparent_normal, render_scanline_text_base_alpha, render_scanline_text_transparent_alpha, render_scanline_text_base_color16, render_scanline_text_transparent_color16, render_scanline_text_base_color32, render_scanline_text_transparent_color32 }, { render_scanline_text_base_normal, render_scanline_text_transparent_normal, render_scanline_text_base_alpha, render_scanline_text_transparent_alpha, render_scanline_text_base_color16, render_scanline_text_transparent_color16, render_scanline_text_base_color32, render_scanline_text_transparent_color32 }
   },
   {
      { render_scanline_text_base_normal, render_scanline_text_transparent_normal, render_scanline_text_base_alpha, render_scanline_text_transparent_alpha, render_scanline_text_base_color16, render_scanline_text_transparent_color16, render_scanline_text_base_color32, render_scanline_text_transparent_color32 }, { render_scanline_text_base_normal, render_scanline_text_transparent_normal, render_scanline_text_base_alpha, render_scanline_text_transparent_alpha, render_scanline_text_base_color16, render_scanline_text_transparent_color16, render_scanline_text_base_color32, render_scanline_text_transparent_color32 },
      { render_scanline_affine_base_normal, render_scanline_affine_transparent_normal, render_scanline_affine_base_alpha, render_scanline_affine_transparent_alpha, render_scanline_affine_base_color16, render_scanline_affine_transparent_color16, render_scanline_affine_base_color32, render_scanline_affine_transparent_color32 }, { render_scanline_text_base_normal, render_scanline_text_transparent_normal, render_scanline_text_base_alpha, render_scanline_text_transparent_alpha, render_scanline_text_base_color16, render_scanline_text_transparent_color16, render_scanline_text_base_color32, render_scanline_text_transparent_color32 }
   },
   {
      { render_scanline_text_base_normal, render_scanline_text_transparent_normal, render_scanline_text_base_alpha, render_scanline_text_transparent_alpha, render_scanline_text_base_color16, render_scanline_text_transparent_color16, render_scanline_text_base_color32, render_scanline_text_transparent_color32 }, { render_scanline_text_base_normal, render_scanline_text_transparent_normal, render_scanline_text_base_alpha, render_scanline_text_transparent_alpha, render_scanline_text_base_color16, render_scanline_text_transparent_color16, render_scanline_text_base_color32, render_scanline_text_transparent_color32 },
      { render_scanline_affine_base_normal, render_scanline_affine_transparent_normal, render_scanline_affine_base_alpha, render_scanline_affine_transparent_alpha, render_scanline_affine_base_color16, render_scanline_affine_transparent_color16, render_scanline_affine_base_color32, render_scanline_affine_transparent_color32 }, { render_scanline_affine_base_normal, render_scanline_affine_transparent_normal, render_scanline_affine_base_alpha, render_scanline_affine_transparent_alpha, render_scanline_affine_base_color16, render_scanline_affine_transparent_color16, render_scanline_affine_base_color32, render_scanline_affine_transparent_color32 }
   }
};

static const bitmap_layer_render_struct bitmap_mode_renderers[3] =
{
   { render_scanline_bitmap_mode3_normal },
   { render_scanline_bitmap_mode4_normal },
   { render_scanline_bitmap_mode5_normal }
};

static const u32 obj_width_table[] =
{ 8, 16, 32, 64, 16, 32, 32, 64, 8, 8, 16, 32 };
static const u32 obj_height_table[] =
{ 8, 16, 32, 64, 8, 8, 16, 32, 16, 32, 32, 64 };

static u8 obj_priority_list[5][160][128];
static u32 obj_priority_count[5][160];
static u32 obj_alpha_count[160];

static void render_scanline_obj_normal_1D(u32 priority, u32 start, u32 end,
      u16* scanline)
{
   u16* palette = palette_ram_converted + 256;
   s32 obj_num, i;
   s32 obj_x, obj_y;
   s32 obj_size;
   s32 obj_width, obj_height;
   u32 obj_attribute_0, obj_attribute_1, obj_attribute_2;
   s32 vcount = io_registers[REG_VCOUNT];
   u32 tile_run;
   u32 current_pixels;
   u32 current_pixel;
   u32 current_palette;
   u32 vertical_offset;
   u32 partial_tile_run, partial_tile_offset;
   u32 pixel_run;
   u16* oam_ptr;
   u16* dest_ptr;
   u8* tile_base = vram + 0x10000;
   u8* tile_ptr;
   u32 obj_count = obj_priority_count[priority][vcount];
   u8* obj_list = obj_priority_list[priority][vcount];
   for (obj_num = 0; obj_num < obj_count; obj_num++)
   {
      oam_ptr = oam_ram + (obj_list[obj_num] * 4);
      obj_attribute_0 = oam_ptr[0];
      obj_attribute_1 = oam_ptr[1];
      obj_attribute_2 = oam_ptr[2];
      obj_size = ((obj_attribute_0 >> 12) & 0x0C) | (obj_attribute_1 >> 14);
      obj_x = (s32)(obj_attribute_1 << 23) >> 23;
      obj_width = obj_width_table[obj_size]; ;
      obj_y = obj_attribute_0 & 0xFF;
      if (obj_y > 160) obj_y -= 256;
      obj_height = obj_height_table[obj_size];
      if (obj_attribute_0 & 0x100)
      {
         if ((obj_attribute_0 >> 13) & 0x01)
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 8;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y); ;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * (max_x / 8) * 64) + ((vertical_offset % 8) * 8);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 64;
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = (max_x / 8) * 64;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                    tile_y & 0x07) * obj_pitch)]; ;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
         else
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 4;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y);
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * (max_x / 8) * 32) + ((vertical_offset % 8) * 4);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 32;
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = (max_x / 8) * 32;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                    tile_y & 0x07) * obj_pitch)];
                        if (tile_x & 0x01) current_pixel >>= 4;
                        else current_pixel &= 0x0F; ;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
      }
      else
      {
         vertical_offset = vcount - obj_y;
         if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                  vertical_offset - 1;
         switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
         {
         case 0x0:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0] = current_pixel;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[1] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[5] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[6] = current_pixel;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[7] = current_pixel;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr += 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[1] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[5] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[6] = current_pixel;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[7] = current_pixel;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[1] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[2] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[3] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[5] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[6] = current_pixel;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[7] = current_pixel;
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        current_pixels >>= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[1] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[2] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[3] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[5] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[6] = current_pixel;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[7] = current_pixel;
                     };
                  };
                  tile_ptr += 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x1:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) +
                       (32 * ((obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0] = current_pixel;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[7] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[6] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[5] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[1] = current_pixel;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr -= 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[7] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[6] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[5] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[1] = current_pixel;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[7] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[6] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[5] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[3] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[2] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[1] = current_pixel;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        current_pixels <<= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[7] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[6] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[5] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[3] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[2] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[1] = current_pixel;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                     };
                  };
                  tile_ptr -= 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x2:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4)
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels & 0xFF;
                                       if (current_pixel)
                                       {
                                          current_pixel = palette[current_pixel];;
                                          dest_ptr[0] = current_pixel;
                                       };
                                       current_pixels >>= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr + 4));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 0] = current_pixel;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 1] = current_pixel;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 2] = current_pixel;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 3] = current_pixel;
                                 };
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 0] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 1] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 2] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 3] = current_pixel;
                           };
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 0] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 1] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 2] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 3] = current_pixel;
                           };
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 0] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 1] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 2] = current_pixel;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 3] = current_pixel;
                              };
                           };
                           dest_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0] = current_pixel;
                              };
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0] = current_pixel;
                              };
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 0] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 1] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 2] = current_pixel;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 3] = current_pixel;
                              };
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr += 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 0] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 1] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 2] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 3] = current_pixel;
                           };
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 0] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 1] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 2] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 3] = current_pixel;
                           };
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 0] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 1] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 2] = current_pixel;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 3] = current_pixel;
                        };
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 0] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 1] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 2] = current_pixel;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 3] = current_pixel;
                        };
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 0] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 1] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 2] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 3] = current_pixel;
                           };
                        };
                        dest_ptr += 4;
                        tile_ptr += 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 0] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 1] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 2] = current_pixel;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 3] = current_pixel;
                     };
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 0] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 1] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 2] = current_pixel;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 3] = current_pixel;
                     };
                  };
                  tile_ptr += 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x3:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) +
                       (64 * ((obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                          partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels >> 24;
                                       if (current_pixel)
                                       {
                                          current_pixel = palette[current_pixel];;
                                          dest_ptr[0] = current_pixel;
                                       };
                                       current_pixels <<= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 3] = current_pixel;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 2] = current_pixel;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 1] = current_pixel;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 0] = current_pixel;
                                 };
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 1] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 0] = current_pixel;
                           };
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 1] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 0] = current_pixel;
                           };
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 3] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 2] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 1] = current_pixel;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 0] = current_pixel;
                              };
                           };
                           dest_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0] = current_pixel;
                              };
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0] = current_pixel;
                              };
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 3] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 2] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 1] = current_pixel;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 0] = current_pixel;
                              };
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr -= 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 1] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 0] = current_pixel;
                           };
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 1] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 0] = current_pixel;
                           };
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 3] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 2] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 1] = current_pixel;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 0] = current_pixel;
                        };
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 3] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 2] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 1] = current_pixel;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 0] = current_pixel;
                        };
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 1] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 0] = current_pixel;
                           };
                        };
                        dest_ptr += 4;
                        tile_ptr -= 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr + 4));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 3] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 2] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 1] = current_pixel;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 0] = current_pixel;
                     };
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 3] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 2] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 1] = current_pixel;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 0] = current_pixel;
                     };
                  };
                  tile_ptr -= 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         }
      };
   }
};
static void render_scanline_obj_normal_2D(u32 priority, u32 start, u32 end,
      u16* scanline)
{
   u16* palette = palette_ram_converted + 256;
   s32 obj_num, i;
   s32 obj_x, obj_y;
   s32 obj_size;
   s32 obj_width, obj_height;
   u32 obj_attribute_0, obj_attribute_1, obj_attribute_2;
   s32 vcount = io_registers[REG_VCOUNT];
   u32 tile_run;
   u32 current_pixels;
   u32 current_pixel;
   u32 current_palette;
   u32 vertical_offset;
   u32 partial_tile_run, partial_tile_offset;
   u32 pixel_run;
   u16* oam_ptr;
   u16* dest_ptr;
   u8* tile_base = vram + 0x10000;
   u8* tile_ptr;
   u32 obj_count = obj_priority_count[priority][vcount];
   u8* obj_list = obj_priority_list[priority][vcount];
   for (obj_num = 0; obj_num < obj_count; obj_num++)
   {
      oam_ptr = oam_ram + (obj_list[obj_num] * 4);
      obj_attribute_0 = oam_ptr[0];
      obj_attribute_1 = oam_ptr[1];
      obj_attribute_2 = oam_ptr[2];
      obj_size = ((obj_attribute_0 >> 12) & 0x0C) | (obj_attribute_1 >> 14);
      obj_x = (s32)(obj_attribute_1 << 23) >> 23;
      obj_width = obj_width_table[obj_size]; ;
      obj_y = obj_attribute_0 & 0xFF;
      if (obj_y > 160) obj_y -= 256;
      obj_height = obj_height_table[obj_size];
      if (obj_attribute_0 & 0x100)
      {
         if ((obj_attribute_0 >> 13) & 0x01)
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 8;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y); ;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 64;
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = 1024;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                    tile_y & 0x07) * obj_pitch)]; ;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
         else
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 4;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y);
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 32;
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = 1024;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                    tile_y & 0x07) * obj_pitch)];
                        if (tile_x & 0x01) current_pixel >>= 4;
                        else current_pixel &= 0x0F; ;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
      }
      else
      {
         vertical_offset = vcount - obj_y;
         if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                  vertical_offset - 1;
         switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
         {
         case 0x0:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0] = current_pixel;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[1] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[5] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[6] = current_pixel;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[7] = current_pixel;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr += 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[1] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[5] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[6] = current_pixel;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[7] = current_pixel;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[1] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[2] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[3] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[5] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[6] = current_pixel;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[7] = current_pixel;
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        current_pixels >>= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[1] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[2] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[3] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[5] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[6] = current_pixel;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[7] = current_pixel;
                     };
                  };
                  tile_ptr += 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x1:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) + (32 * ((
                                   obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0] = current_pixel;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[7] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[6] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[5] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[1] = current_pixel;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr -= 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[7] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[6] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[5] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[1] = current_pixel;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[7] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[6] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[5] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[3] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[2] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[1] = current_pixel;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        current_pixels <<= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[7] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[6] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[5] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[3] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[2] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[1] = current_pixel;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0] = current_pixel;
                     };
                  };
                  tile_ptr -= 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x2:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4)
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels & 0xFF;
                                       if (current_pixel)
                                       {
                                          current_pixel = palette[current_pixel];;
                                          dest_ptr[0] = current_pixel;
                                       };
                                       current_pixels >>= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr + 4));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 0] = current_pixel;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 1] = current_pixel;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 2] = current_pixel;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 3] = current_pixel;
                                 };
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 0] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 1] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 2] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 3] = current_pixel;
                           };
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 0] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 1] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 2] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 3] = current_pixel;
                           };
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 0] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 1] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 2] = current_pixel;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 3] = current_pixel;
                              };
                           };
                           dest_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0] = current_pixel;
                              };
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0] = current_pixel;
                              };
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 0] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 1] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 2] = current_pixel;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 3] = current_pixel;
                              };
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr += 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 0] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 1] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 2] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 3] = current_pixel;
                           };
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 0] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 1] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 2] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 3] = current_pixel;
                           };
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 0] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 1] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 2] = current_pixel;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 3] = current_pixel;
                        };
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 0] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 1] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 2] = current_pixel;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 3] = current_pixel;
                        };
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 0] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 1] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 2] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 3] = current_pixel;
                           };
                        };
                        dest_ptr += 4;
                        tile_ptr += 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 0] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 1] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 2] = current_pixel;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 3] = current_pixel;
                     };
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 0] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 1] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 2] = current_pixel;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 3] = current_pixel;
                     };
                  };
                  tile_ptr += 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x3:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) + (64 * ((
                                   obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                          partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels >> 24;
                                       if (current_pixel)
                                       {
                                          current_pixel = palette[current_pixel];;
                                          dest_ptr[0] = current_pixel;
                                       };
                                       current_pixels <<= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0] = current_pixel;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 3] = current_pixel;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 2] = current_pixel;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 1] = current_pixel;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    current_pixel = palette[current_pixel];;
                                    dest_ptr[0 + 0] = current_pixel;
                                 };
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 1] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 0] = current_pixel;
                           };
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 1] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 0] = current_pixel;
                           };
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 3] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 2] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 1] = current_pixel;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 0] = current_pixel;
                              };
                           };
                           dest_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0] = current_pixel;
                           };
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0] = current_pixel;
                              };
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0] = current_pixel;
                              };
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 3] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 2] = current_pixel;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 1] = current_pixel;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 current_pixel = palette[current_pixel];;
                                 dest_ptr[0 + 0] = current_pixel;
                              };
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr -= 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 1] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 0] = current_pixel;
                           };
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 1] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[4 + 0] = current_pixel;
                           };
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 3] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 2] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 1] = current_pixel;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0 + 0] = current_pixel;
                        };
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 3] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 2] = current_pixel;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 1] = current_pixel;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[4 + 0] = current_pixel;
                        };
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 3] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 2] = current_pixel;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 1] = current_pixel;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              current_pixel = palette[current_pixel];;
                              dest_ptr[0 + 0] = current_pixel;
                           };
                        };
                        dest_ptr += 4;
                        tile_ptr -= 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr + 4));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           current_pixel = palette[current_pixel];;
                           dest_ptr[0] = current_pixel;
                        };
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 3] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 2] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 1] = current_pixel;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[0 + 0] = current_pixel;
                     };
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 3] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 2] = current_pixel;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 1] = current_pixel;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        current_pixel = palette[current_pixel];;
                        dest_ptr[4 + 0] = current_pixel;
                     };
                  };
                  tile_ptr -= 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         }
      };
   }
};
static void render_scanline_obj_color16_1D(u32 priority, u32 start, u32 end,
      u16* scanline)
{
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> 4) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (4 + 7)) & 0x02)) << 9 | (1 << 8);
   s32 obj_num, i;
   s32 obj_x, obj_y;
   s32 obj_size;
   s32 obj_width, obj_height;
   u32 obj_attribute_0, obj_attribute_1, obj_attribute_2;
   s32 vcount = io_registers[REG_VCOUNT];
   u32 tile_run;
   u32 current_pixels;
   u32 current_pixel;
   u32 current_palette;
   u32 vertical_offset;
   u32 partial_tile_run, partial_tile_offset;
   u32 pixel_run;
   u16* oam_ptr;
   u16* dest_ptr;
   u8* tile_base = vram + 0x10000;
   u8* tile_ptr;
   u32 obj_count = obj_priority_count[priority][vcount];
   u8* obj_list = obj_priority_list[priority][vcount];
   for (obj_num = 0; obj_num < obj_count; obj_num++)
   {
      oam_ptr = oam_ram + (obj_list[obj_num] * 4);
      obj_attribute_0 = oam_ptr[0];
      obj_attribute_1 = oam_ptr[1];
      obj_attribute_2 = oam_ptr[2];
      obj_size = ((obj_attribute_0 >> 12) & 0x0C) | (obj_attribute_1 >> 14);
      obj_x = (s32)(obj_attribute_1 << 23) >> 23;
      obj_width = obj_width_table[obj_size]; ;
      obj_y = obj_attribute_0 & 0xFF;
      if (obj_y > 160) obj_y -= 256;
      obj_height = obj_height_table[obj_size];
      if (obj_attribute_0 & 0x100)
      {
         if ((obj_attribute_0 >> 13) & 0x01)
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 8;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y); ;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * (max_x / 8) * 64) + ((vertical_offset % 8) * 8);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 64;
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = (max_x / 8) * 64;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                    tile_y & 0x07) * obj_pitch)]; ;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;  ;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
         else
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 4;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y);
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * (max_x / 8) * 32) + ((vertical_offset % 8) * 4);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 32;
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = (max_x / 8) * 32;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                    tile_y & 0x07) * obj_pitch)];
                        if (tile_x & 0x01) current_pixel >>= 4;
                        else current_pixel &= 0x0F; ;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
      }
      else
      {
         vertical_offset = vcount - obj_y;
         if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                  vertical_offset - 1;
         switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
         {
         case 0x0:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = current_pixel | pixel_combine;
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr += 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = current_pixel | pixel_combine;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = current_pixel | pixel_combine;
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        current_pixels >>= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = current_pixel | pixel_combine;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = current_pixel | pixel_combine;
                     };
                  };
                  tile_ptr += 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x1:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) +
                       (32 * ((obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = current_pixel | pixel_combine;
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr -= 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = current_pixel | pixel_combine;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        current_pixels <<= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = current_pixel | pixel_combine;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                  };
                  tile_ptr -= 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x2:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4)
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels & 0xFF;
                                       if (current_pixel)
                                          dest_ptr[0] = current_pixel | pixel_combine;  ;
                                       current_pixels >>= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr + 4));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr += 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        };
                        dest_ptr += 4;
                        tile_ptr += 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;  ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                  };
                  tile_ptr += 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x3:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) +
                       (64 * ((obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                          partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels >> 24;
                                       if (current_pixel)
                                          dest_ptr[0] = current_pixel | pixel_combine;  ;
                                       current_pixels <<= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr -= 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        };
                        dest_ptr += 4;
                        tile_ptr -= 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr + 4));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;  ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                  };
                  tile_ptr -= 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         }
      };
   }
};
static void render_scanline_obj_color16_2D(u32 priority, u32 start, u32 end,
      u16* scanline)
{
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> 4) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (4 + 7)) & 0x02)) << 9 | (1 << 8);
   s32 obj_num, i;
   s32 obj_x, obj_y;
   s32 obj_size;
   s32 obj_width, obj_height;
   u32 obj_attribute_0, obj_attribute_1, obj_attribute_2;
   s32 vcount = io_registers[REG_VCOUNT];
   u32 tile_run;
   u32 current_pixels;
   u32 current_pixel;
   u32 current_palette;
   u32 vertical_offset;
   u32 partial_tile_run, partial_tile_offset;
   u32 pixel_run;
   u16* oam_ptr;
   u16* dest_ptr;
   u8* tile_base = vram + 0x10000;
   u8* tile_ptr;
   u32 obj_count = obj_priority_count[priority][vcount];
   u8* obj_list = obj_priority_list[priority][vcount];
   for (obj_num = 0; obj_num < obj_count; obj_num++)
   {
      oam_ptr = oam_ram + (obj_list[obj_num] * 4);
      obj_attribute_0 = oam_ptr[0];
      obj_attribute_1 = oam_ptr[1];
      obj_attribute_2 = oam_ptr[2];
      obj_size = ((obj_attribute_0 >> 12) & 0x0C) | (obj_attribute_1 >> 14);
      obj_x = (s32)(obj_attribute_1 << 23) >> 23;
      obj_width = obj_width_table[obj_size]; ;
      obj_y = obj_attribute_0 & 0xFF;
      if (obj_y > 160) obj_y -= 256;
      obj_height = obj_height_table[obj_size];
      if (obj_attribute_0 & 0x100)
      {
         if ((obj_attribute_0 >> 13) & 0x01)
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 8;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y); ;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 64;
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = 1024;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                    tile_y & 0x07) * obj_pitch)]; ;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;  ;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
         else
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 4;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y);
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 32;
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = 1024;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                    tile_y & 0x07) * obj_pitch)];
                        if (tile_x & 0x01) current_pixel >>= 4;
                        else current_pixel &= 0x0F; ;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
      }
      else
      {
         vertical_offset = vcount - obj_y;
         if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                  vertical_offset - 1;
         switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
         {
         case 0x0:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = current_pixel | pixel_combine;
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr += 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = current_pixel | pixel_combine;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = current_pixel | pixel_combine;
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        current_pixels >>= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = current_pixel | pixel_combine;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = current_pixel | pixel_combine;
                     };
                  };
                  tile_ptr += 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x1:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) + (32 * ((
                                   obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = current_pixel | pixel_combine;
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr -= 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = current_pixel | pixel_combine;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        current_pixels <<= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = current_pixel | pixel_combine;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                  };
                  tile_ptr -= 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x2:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4)
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels & 0xFF;
                                       if (current_pixel)
                                          dest_ptr[0] = current_pixel | pixel_combine;  ;
                                       current_pixels >>= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr + 4));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr += 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        };
                        dest_ptr += 4;
                        tile_ptr += 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;  ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                  };
                  tile_ptr += 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x3:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) + (64 * ((
                                   obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                          partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels >> 24;
                                       if (current_pixel)
                                          dest_ptr[0] = current_pixel | pixel_combine;  ;
                                       current_pixels <<= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr -= 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        };
                        dest_ptr += 4;
                        tile_ptr -= 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr + 4));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;  ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                  };
                  tile_ptr -= 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         }
      };
   }
};
static void render_scanline_obj_color32_1D(u32 priority, u32 start, u32 end,
      u32* scanline)
{
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> 4) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (4 + 7)) & 0x02)) << 9 | (1 << 8);
   s32 obj_num, i;
   s32 obj_x, obj_y;
   s32 obj_size;
   s32 obj_width, obj_height;
   u32 obj_attribute_0, obj_attribute_1, obj_attribute_2;
   s32 vcount = io_registers[REG_VCOUNT];
   u32 tile_run;
   u32 current_pixels;
   u32 current_pixel;
   u32 current_palette;
   u32 vertical_offset;
   u32 partial_tile_run, partial_tile_offset;
   u32 pixel_run;
   u16* oam_ptr;
   u32* dest_ptr;
   u8* tile_base = vram + 0x10000;
   u8* tile_ptr;
   u32 obj_count = obj_priority_count[priority][vcount];
   u8* obj_list = obj_priority_list[priority][vcount];
   for (obj_num = 0; obj_num < obj_count; obj_num++)
   {
      oam_ptr = oam_ram + (obj_list[obj_num] * 4);
      obj_attribute_0 = oam_ptr[0];
      obj_attribute_1 = oam_ptr[1];
      obj_attribute_2 = oam_ptr[2];
      obj_size = ((obj_attribute_0 >> 12) & 0x0C) | (obj_attribute_1 >> 14);
      obj_x = (s32)(obj_attribute_1 << 23) >> 23;
      obj_width = obj_width_table[obj_size]; ;
      obj_y = obj_attribute_0 & 0xFF;
      if (obj_y > 160) obj_y -= 256;
      obj_height = obj_height_table[obj_size];
      if (obj_attribute_0 & 0x100)
      {
         if ((obj_attribute_0 >> 13) & 0x01)
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 8;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y); ;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * (max_x / 8) * 64) + ((vertical_offset % 8) * 8);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 64;
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = (max_x / 8) * 64;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                    tile_y & 0x07) * obj_pitch)]; ;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;  ;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
         else
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 4;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y);
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * (max_x / 8) * 32) + ((vertical_offset % 8) * 4);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 32;
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = (max_x / 8) * 32;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                    tile_y & 0x07) * obj_pitch)];
                        if (tile_x & 0x01) current_pixel >>= 4;
                        else current_pixel &= 0x0F; ;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
      }
      else
      {
         vertical_offset = vcount - obj_y;
         if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                  vertical_offset - 1;
         switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
         {
         case 0x0:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = current_pixel | pixel_combine;
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr += 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = current_pixel | pixel_combine;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = current_pixel | pixel_combine;
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        current_pixels >>= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = current_pixel | pixel_combine;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = current_pixel | pixel_combine;
                     };
                  };
                  tile_ptr += 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x1:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) +
                       (32 * ((obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = current_pixel | pixel_combine;
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr -= 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = current_pixel | pixel_combine;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        current_pixels <<= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = current_pixel | pixel_combine;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                  };
                  tile_ptr -= 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x2:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4)
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels & 0xFF;
                                       if (current_pixel)
                                          dest_ptr[0] = current_pixel | pixel_combine;  ;
                                       current_pixels >>= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr + 4));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr += 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        };
                        dest_ptr += 4;
                        tile_ptr += 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;  ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                  };
                  tile_ptr += 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x3:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) +
                       (64 * ((obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                          partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels >> 24;
                                       if (current_pixel)
                                          dest_ptr[0] = current_pixel | pixel_combine;  ;
                                       current_pixels <<= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr -= 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        };
                        dest_ptr += 4;
                        tile_ptr -= 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr + 4));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;  ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                  };
                  tile_ptr -= 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         }
      };
   }
};
static void render_scanline_obj_color32_2D(u32 priority, u32 start, u32 end,
      u32* scanline)
{
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> 4) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (4 + 7)) & 0x02)) << 9 | (1 << 8);
   s32 obj_num, i;
   s32 obj_x, obj_y;
   s32 obj_size;
   s32 obj_width, obj_height;
   u32 obj_attribute_0, obj_attribute_1, obj_attribute_2;
   s32 vcount = io_registers[REG_VCOUNT];
   u32 tile_run;
   u32 current_pixels;
   u32 current_pixel;
   u32 current_palette;
   u32 vertical_offset;
   u32 partial_tile_run, partial_tile_offset;
   u32 pixel_run;
   u16* oam_ptr;
   u32* dest_ptr;
   u8* tile_base = vram + 0x10000;
   u8* tile_ptr;
   u32 obj_count = obj_priority_count[priority][vcount];
   u8* obj_list = obj_priority_list[priority][vcount];
   for (obj_num = 0; obj_num < obj_count; obj_num++)
   {
      oam_ptr = oam_ram + (obj_list[obj_num] * 4);
      obj_attribute_0 = oam_ptr[0];
      obj_attribute_1 = oam_ptr[1];
      obj_attribute_2 = oam_ptr[2];
      obj_size = ((obj_attribute_0 >> 12) & 0x0C) | (obj_attribute_1 >> 14);
      obj_x = (s32)(obj_attribute_1 << 23) >> 23;
      obj_width = obj_width_table[obj_size]; ;
      obj_y = obj_attribute_0 & 0xFF;
      if (obj_y > 160) obj_y -= 256;
      obj_height = obj_height_table[obj_size];
      if (obj_attribute_0 & 0x100)
      {
         if ((obj_attribute_0 >> 13) & 0x01)
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 8;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y); ;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 64;
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = 1024;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                    tile_y & 0x07) * obj_pitch)]; ;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;  ;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
         else
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 4;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y);
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 32;
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = 1024;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                    tile_y & 0x07) * obj_pitch)];
                        if (tile_x & 0x01) current_pixel >>= 4;
                        else current_pixel &= 0x0F; ;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
      }
      else
      {
         vertical_offset = vcount - obj_y;
         if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                  vertical_offset - 1;
         switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
         {
         case 0x0:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = current_pixel | pixel_combine;
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr += 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = current_pixel | pixel_combine;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = current_pixel | pixel_combine;
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        current_pixels >>= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = current_pixel | pixel_combine;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = current_pixel | pixel_combine;
                     };
                  };
                  tile_ptr += 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x1:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) + (32 * ((
                                   obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = current_pixel | pixel_combine;
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr -= 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = current_pixel | pixel_combine;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        current_pixels <<= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = current_pixel | pixel_combine;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = current_pixel | pixel_combine;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = current_pixel | pixel_combine;
                     };
                  };
                  tile_ptr -= 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x2:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4)
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels & 0xFF;
                                       if (current_pixel)
                                          dest_ptr[0] = current_pixel | pixel_combine;  ;
                                       current_pixels >>= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr + 4));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr += 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        };
                        dest_ptr += 4;
                        tile_ptr += 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;  ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                  };
                  tile_ptr += 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x3:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) + (64 * ((
                                   obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                          partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels >> 24;
                                       if (current_pixel)
                                          dest_ptr[0] = current_pixel | pixel_combine;  ;
                                       current_pixels <<= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr -= 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        };
                        dest_ptr += 4;
                        tile_ptr -= 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr + 4));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = current_pixel | pixel_combine;  ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                  };
                  tile_ptr -= 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         }
      };
   }
};
static void render_scanline_obj_alpha_obj_1D(u32 priority, u32 start, u32 end,
      u32* scanline)
{
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> 4) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (4 + 7)) & 0x02)) << 9 | (1 << 8);
   u32 dest;
   if ((pixel_combine & 0x00000200) == 0)
   {
      render_scanline_obj_color32_1D(priority, start, end, scanline);
      return;
   };
   s32 obj_num, i;
   s32 obj_x, obj_y;
   s32 obj_size;
   s32 obj_width, obj_height;
   u32 obj_attribute_0, obj_attribute_1, obj_attribute_2;
   s32 vcount = io_registers[REG_VCOUNT];
   u32 tile_run;
   u32 current_pixels;
   u32 current_pixel;
   u32 current_palette;
   u32 vertical_offset;
   u32 partial_tile_run, partial_tile_offset;
   u32 pixel_run;
   u16* oam_ptr;
   u32* dest_ptr;
   u8* tile_base = vram + 0x10000;
   u8* tile_ptr;
   u32 obj_count = obj_priority_count[priority][vcount];
   u8* obj_list = obj_priority_list[priority][vcount];
   for (obj_num = 0; obj_num < obj_count; obj_num++)
   {
      oam_ptr = oam_ram + (obj_list[obj_num] * 4);
      obj_attribute_0 = oam_ptr[0];
      obj_attribute_1 = oam_ptr[1];
      obj_attribute_2 = oam_ptr[2];
      obj_size = ((obj_attribute_0 >> 12) & 0x0C) | (obj_attribute_1 >> 14);
      obj_x = (s32)(obj_attribute_1 << 23) >> 23;
      obj_width = obj_width_table[obj_size]; ;
      obj_y = obj_attribute_0 & 0xFF;
      if (obj_y > 160) obj_y -= 256;
      obj_height = obj_height_table[obj_size];
      if (obj_attribute_0 & 0x100)
      {
         if ((obj_attribute_0 >> 13) & 0x01)
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 8;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y); ;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * (max_x / 8) * 64) + ((vertical_offset % 8) * 8);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 64;
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = (max_x / 8) * 64;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                    tile_y & 0x07) * obj_pitch)]; ;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
         else
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 4;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y);
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * (max_x / 8) * 32) + ((vertical_offset % 8) * 4);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 32;
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = (max_x / 8) * 32;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                    tile_y & 0x07) * obj_pitch)];
                        if (tile_x & 0x01) current_pixel >>= 4;
                        else current_pixel &= 0x0F; ;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
      }
      else
      {
         vertical_offset = vcount - obj_y;
         if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                  vertical_offset - 1;
         switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
         {
         case 0x0:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[1];
                              if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[2];
                              if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[3];
                              if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[4];
                              if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[5];
                              if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[6];
                              if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[7];
                              if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr += 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[1];
                              if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[2];
                              if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[3];
                              if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[4];
                              if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[5];
                              if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[6];
                              if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[7];
                              if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[1];
                           if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[2];
                           if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[3];
                           if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[4];
                           if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[5];
                           if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[6];
                           if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[7];
                           if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixels >>= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[0];
                        if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[1];
                        if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[2];
                        if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[3];
                        if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[4];
                        if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[5];
                        if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[6];
                        if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[7];
                        if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                  };
                  tile_ptr += 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x1:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) +
                       (32 * ((obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[7];
                              if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[6];
                              if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[5];
                              if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[4];
                              if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[3];
                              if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[2];
                              if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[1];
                              if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr -= 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[7];
                              if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[6];
                              if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[5];
                              if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[4];
                              if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[3];
                              if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[2];
                              if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[1];
                              if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[7];
                           if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[6];
                           if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[5];
                           if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[4];
                           if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[3];
                           if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[2];
                           if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[1];
                           if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixels <<= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[7];
                        if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[6];
                        if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[5];
                        if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[4];
                        if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[3];
                        if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[2];
                        if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[1];
                        if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[0];
                        if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                  };
                  tile_ptr -= 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x2:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4)
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels & 0xFF;
                                       if (current_pixel)
                                       {
                                          dest = dest_ptr[0];
                                          if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                                  pixel_combine;
                                          else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                       };
                                       current_pixels >>= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr + 4));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 0];
                                    if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 1];
                                    if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 2];
                                    if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 3];
                                    if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 0];
                              if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 1];
                              if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 2];
                              if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 3];
                              if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           dest_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr += 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 0];
                              if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 1];
                              if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 2];
                              if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 3];
                              if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 0];
                           if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 1];
                           if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 2];
                           if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 3];
                           if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 0];
                           if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 1];
                           if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 2];
                           if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 3];
                           if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        dest_ptr += 4;
                        tile_ptr += 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 0];
                        if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 1];
                        if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 2];
                        if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 3];
                        if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 0];
                        if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 1];
                        if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 2];
                        if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 3];
                        if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                  };
                  tile_ptr += 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x3:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) +
                       (64 * ((obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                          partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels >> 24;
                                       if (current_pixel)
                                       {
                                          dest = dest_ptr[0];
                                          if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                                  pixel_combine;
                                          else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                       };
                                       current_pixels <<= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 3];
                                    if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 2];
                                    if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 1];
                                    if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 0];
                                    if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 3];
                              if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 2];
                              if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 1];
                              if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 0];
                              if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           dest_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr -= 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 3];
                              if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 2];
                              if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 1];
                              if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 0];
                              if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 3];
                           if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 2];
                           if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 1];
                           if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 0];
                           if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 3];
                           if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 2];
                           if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 1];
                           if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 0];
                           if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        dest_ptr += 4;
                        tile_ptr -= 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr + 4));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 3];
                        if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 2];
                        if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 1];
                        if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 0];
                        if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 3];
                        if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 2];
                        if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 1];
                        if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 0];
                        if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                  };
                  tile_ptr -= 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         }
      };
   }
};
static void render_scanline_obj_alpha_obj_2D(u32 priority, u32 start, u32 end,
      u32* scanline)
{
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> 4) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (4 + 7)) & 0x02)) << 9 | (1 << 8);
   u32 dest;
   if ((pixel_combine & 0x00000200) == 0)
   {
      render_scanline_obj_color32_2D(priority, start, end, scanline);
      return;
   };
   s32 obj_num, i;
   s32 obj_x, obj_y;
   s32 obj_size;
   s32 obj_width, obj_height;
   u32 obj_attribute_0, obj_attribute_1, obj_attribute_2;
   s32 vcount = io_registers[REG_VCOUNT];
   u32 tile_run;
   u32 current_pixels;
   u32 current_pixel;
   u32 current_palette;
   u32 vertical_offset;
   u32 partial_tile_run, partial_tile_offset;
   u32 pixel_run;
   u16* oam_ptr;
   u32* dest_ptr;
   u8* tile_base = vram + 0x10000;
   u8* tile_ptr;
   u32 obj_count = obj_priority_count[priority][vcount];
   u8* obj_list = obj_priority_list[priority][vcount];
   for (obj_num = 0; obj_num < obj_count; obj_num++)
   {
      oam_ptr = oam_ram + (obj_list[obj_num] * 4);
      obj_attribute_0 = oam_ptr[0];
      obj_attribute_1 = oam_ptr[1];
      obj_attribute_2 = oam_ptr[2];
      obj_size = ((obj_attribute_0 >> 12) & 0x0C) | (obj_attribute_1 >> 14);
      obj_x = (s32)(obj_attribute_1 << 23) >> 23;
      obj_width = obj_width_table[obj_size]; ;
      obj_y = obj_attribute_0 & 0xFF;
      if (obj_y > 160) obj_y -= 256;
      obj_height = obj_height_table[obj_size];
      if (obj_attribute_0 & 0x100)
      {
         if ((obj_attribute_0 >> 13) & 0x01)
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 8;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y); ;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 64;
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = 1024;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                    tile_y & 0x07) * obj_pitch)]; ;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
         else
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 4;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y);
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 32;
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           source_x += dx;
                           dest_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = 1024;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                    tile_y & 0x07) * obj_pitch)];
                        if (tile_x & 0x01) current_pixel >>= 4;
                        else current_pixel &= 0x0F; ;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                     }
                  };
               }
            };
         }
      }
      else
      {
         vertical_offset = vcount - obj_y;
         if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                  vertical_offset - 1;
         switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
         {
         case 0x0:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[1];
                              if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[2];
                              if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[3];
                              if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[4];
                              if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[5];
                              if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[6];
                              if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[7];
                              if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr += 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[1];
                              if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[2];
                              if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[3];
                              if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[4];
                              if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[5];
                              if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[6];
                              if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[7];
                              if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[1];
                           if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[2];
                           if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[3];
                           if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[4];
                           if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[5];
                           if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[6];
                           if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[7];
                           if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixels >>= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[0];
                        if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[1];
                        if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[2];
                        if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[3];
                        if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[4];
                        if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[5];
                        if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[6];
                        if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[7];
                        if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                  };
                  tile_ptr += 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x1:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) + (32 * ((
                                   obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[7];
                              if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[6];
                              if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[5];
                              if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[4];
                              if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[3];
                              if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[2];
                              if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[1];
                              if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                        tile_ptr -= 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[7];
                              if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[6];
                              if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[5];
                              if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[4];
                              if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[3];
                              if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[2];
                              if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[1];
                              if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[7];
                           if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[6];
                           if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[5];
                           if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[4];
                           if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[3];
                           if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[2];
                           if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[1];
                           if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixels <<= 4;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[7];
                        if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[6];
                        if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[5];
                        if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[4];
                        if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[3];
                        if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[2];
                        if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[1];
                        if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest = dest_ptr[0];
                        if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                pixel_combine;
                        else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                  };
                  tile_ptr -= 32;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x2:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4)
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels & 0xFF;
                                       if (current_pixel)
                                       {
                                          dest = dest_ptr[0];
                                          if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                                  pixel_combine;
                                          else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                       };
                                       current_pixels >>= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr + 4));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 0];
                                    if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 1];
                                    if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 2];
                                    if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 3];
                                    if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 0];
                              if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 1];
                              if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 2];
                              if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 3];
                              if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           dest_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr += 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 0];
                              if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 1];
                              if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 2];
                              if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 3];
                              if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 0];
                           if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 1];
                           if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 2];
                           if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 3];
                           if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 0];
                           if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 1];
                           if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 2];
                           if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 3];
                           if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        dest_ptr += 4;
                        tile_ptr += 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixels >>= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 0];
                        if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 1];
                        if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 2];
                        if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 3];
                        if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 0];
                        if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 1];
                        if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 2];
                        if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 3];
                        if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                  };
                  tile_ptr += 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         case 0x3:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) + (64 * ((
                                   obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                          partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels >> 24;
                                       if (current_pixel)
                                       {
                                          dest = dest_ptr[0];
                                          if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                                  pixel_combine;
                                          else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                       };
                                       current_pixels <<= 8;
                                       dest_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 3];
                                    if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 2];
                                    if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 1];
                                    if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 0];
                                    if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 3];
                              if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 2];
                              if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 1];
                              if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 0];
                              if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           dest_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           dest_ptr += 4;
                        };
                        tile_ptr -= 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 3];
                              if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 2];
                              if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 1];
                              if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 0];
                              if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 3];
                           if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 2];
                           if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 1];
                           if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 0];
                           if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 3];
                           if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 2];
                           if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 1];
                           if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 0];
                           if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        dest_ptr += 4;
                        tile_ptr -= 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr + 4));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixels <<= 8;
                        dest_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 3];
                        if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 2];
                        if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 1];
                        if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        dest = dest_ptr[0 + 0];
                        if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 3];
                        if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 2];
                        if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 1];
                        if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                     {
                        dest = dest_ptr[4 + 0];
                        if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                 pixel_combine;
                        else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                     };
                  };
                  tile_ptr -= 64;
                  dest_ptr += 8;
               };
            }
         };
         break;
         }
      };
   }
};
static void render_scanline_obj_partial_alpha_1D(u32 priority, u32 start,
      u32 end, u32* scanline)
{
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> 4) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (4 + 7)) & 0x02)) << 9 | (1 << 8);
   u32 base_pixel_combine = pixel_combine;
   u32 dest;
   s32 obj_num, i;
   s32 obj_x, obj_y;
   s32 obj_size;
   s32 obj_width, obj_height;
   u32 obj_attribute_0, obj_attribute_1, obj_attribute_2;
   s32 vcount = io_registers[REG_VCOUNT];
   u32 tile_run;
   u32 current_pixels;
   u32 current_pixel;
   u32 current_palette;
   u32 vertical_offset;
   u32 partial_tile_run, partial_tile_offset;
   u32 pixel_run;
   u16* oam_ptr;
   u32* dest_ptr;
   u8* tile_base = vram + 0x10000;
   u8* tile_ptr;
   u32 obj_count = obj_priority_count[priority][vcount];
   u8* obj_list = obj_priority_list[priority][vcount];
   for (obj_num = 0; obj_num < obj_count; obj_num++)
   {
      oam_ptr = oam_ram + (obj_list[obj_num] * 4);
      obj_attribute_0 = oam_ptr[0];
      obj_attribute_1 = oam_ptr[1];
      obj_attribute_2 = oam_ptr[2];
      obj_size = ((obj_attribute_0 >> 12) & 0x0C) | (obj_attribute_1 >> 14);
      obj_x = (s32)(obj_attribute_1 << 23) >> 23;
      obj_width = obj_width_table[obj_size]; ;
      obj_y = obj_attribute_0 & 0xFF;
      if (obj_y > 160) obj_y -= 256;
      obj_height = obj_height_table[obj_size];
      if ((obj_attribute_0 >> 10) & 0x03)
      {
         pixel_combine = 0x00000300;
         if (obj_attribute_0 & 0x100)
         {
            if ((obj_attribute_0 >> 13) & 0x01)
            {
               {
                  s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
                  s32 dx = params[3];
                  s32 dmx = params[7];
                  s32 dy = params[11];
                  s32 dmy = params[15];
                  s32 source_x, source_y;
                  s32 tile_x, tile_y;
                  u32 tile_map_offset;
                  s32 middle_x;
                  s32 middle_y;
                  s32 max_x = obj_width;
                  s32 max_y = obj_height;
                  s32 y_delta;
                  u32 obj_pitch = 8;
                  u32 obj_tile_pitch;
                  middle_x = (obj_width / 2);
                  middle_y = (obj_height / 2);
                  source_x = (middle_x << 8);
                  source_y = (middle_y << 8);
                  if (obj_attribute_0 & 0x200)
                  {
                     obj_width *= 2;
                     obj_height *= 2;
                     middle_x *= 2;
                     middle_y *= 2;
                  }
                  if ((s32)obj_x < (s32)start)
                  {
                     u32 x_delta = start - obj_x;
                     middle_x -= x_delta;
                     obj_width -= x_delta;
                     obj_x = start;
                     if ((s32)obj_width <= 0) continue;
                  }
                  if ((s32)(obj_x + obj_width) >= (s32)end)
                  {
                     obj_width = end - obj_x;
                     if ((s32)obj_width <= 0) continue;
                  }
                  dest_ptr = scanline + obj_x;
                  y_delta = vcount - (obj_y + middle_y); ;
                  if (dy == 0)
                  {
                     {
                        u32 vertical_offset;
                        source_y += (y_delta * dmy);
                        vertical_offset = (source_y >> 8);
                        if ((u32)vertical_offset < (u32)max_y)
                        {
                           tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                         vertical_offset / 8) * (max_x / 8) * 64) + ((vertical_offset % 8) * 8);
                           source_x += (y_delta * dmx) - (middle_x * dx);
                           for (i = 0; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x < (u32)max_x) break;
                              source_x += dx;
                              dest_ptr += 1;
                           }
                           for (; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x >= (u32)max_x) break;
                              tile_map_offset = (tile_x >> 3) * 64;
                              current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };;
                              source_x += dx;
                              dest_ptr += 1;
                           }
                        }
                     };
                  }
                  else
                  {
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                        obj_tile_pitch = (max_x / 8) * 64;
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        source_y += (y_delta * dmy) - (middle_x * dy);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                           tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                       tile_y & 0x07) * obj_pitch)]; ;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                     };
                  }
               };
            }
            else
            {
               {
                  s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
                  s32 dx = params[3];
                  s32 dmx = params[7];
                  s32 dy = params[11];
                  s32 dmy = params[15];
                  s32 source_x, source_y;
                  s32 tile_x, tile_y;
                  u32 tile_map_offset;
                  s32 middle_x;
                  s32 middle_y;
                  s32 max_x = obj_width;
                  s32 max_y = obj_height;
                  s32 y_delta;
                  u32 obj_pitch = 4;
                  u32 obj_tile_pitch;
                  middle_x = (obj_width / 2);
                  middle_y = (obj_height / 2);
                  source_x = (middle_x << 8);
                  source_y = (middle_y << 8);
                  if (obj_attribute_0 & 0x200)
                  {
                     obj_width *= 2;
                     obj_height *= 2;
                     middle_x *= 2;
                     middle_y *= 2;
                  }
                  if ((s32)obj_x < (s32)start)
                  {
                     u32 x_delta = start - obj_x;
                     middle_x -= x_delta;
                     obj_width -= x_delta;
                     obj_x = start;
                     if ((s32)obj_width <= 0) continue;
                  }
                  if ((s32)(obj_x + obj_width) >= (s32)end)
                  {
                     obj_width = end - obj_x;
                     if ((s32)obj_width <= 0) continue;
                  }
                  dest_ptr = scanline + obj_x;
                  y_delta = vcount - (obj_y + middle_y);
                  current_palette = (obj_attribute_2 >> 8) & 0xF0;
                  if (dy == 0)
                  {
                     {
                        u32 vertical_offset;
                        source_y += (y_delta * dmy);
                        vertical_offset = (source_y >> 8);
                        if ((u32)vertical_offset < (u32)max_y)
                        {
                           tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                         vertical_offset / 8) * (max_x / 8) * 32) + ((vertical_offset % 8) * 4);
                           source_x += (y_delta * dmx) - (middle_x * dx);
                           for (i = 0; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x < (u32)max_x) break;
                              source_x += dx;
                              dest_ptr += 1;
                           }
                           for (; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x >= (u32)max_x) break;
                              tile_map_offset = (tile_x >> 3) * 32;
                              current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                              if (tile_x & 0x01) current_pixel >>= 4;
                              else current_pixel &= 0x0F; ;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              source_x += dx;
                              dest_ptr += 1;
                           }
                        }
                     };
                  }
                  else
                  {
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                        obj_tile_pitch = (max_x / 8) * 32;
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        source_y += (y_delta * dmy) - (middle_x * dy);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                           tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                       tile_y & 0x07) * obj_pitch)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                     };
                  }
               };
            }
         }
         else
         {
            vertical_offset = vcount - obj_y;
            if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                     vertical_offset - 1;
            switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
            {
            case 0x0:
            {
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) ;
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0x0F;
                                    if (current_pixel)
                                    {
                                       current_pixel |= current_palette;
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels >>= 4;
                                    dest_ptr += 1;
                                 };
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                              };
                              tile_ptr += 32;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[1];
                                 if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[2];
                                 if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[3];
                                 if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[4];
                                 if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[5];
                                 if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[6];
                                 if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[7];
                                 if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr += 32;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[1];
                                 if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[2];
                                 if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[3];
                                 if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[4];
                                 if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[5];
                                 if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[6];
                                 if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[7];
                                 if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr += 32;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[1];
                              if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[2];
                              if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[3];
                              if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[4];
                              if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[5];
                              if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[6];
                              if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[7];
                              if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[1];
                           if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[2];
                           if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[3];
                           if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[4];
                           if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[5];
                           if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[6];
                           if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[7];
                           if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            case 0x1:
            {
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) +
                          (32 * ((obj_width - 8) / 8));
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 28;
                                    if (current_pixel)
                                    {
                                       current_pixel |= current_palette;
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels <<= 4;
                                    dest_ptr += 1;
                                 };
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                              };
                              tile_ptr -= 32;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[7];
                                 if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[6];
                                 if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[5];
                                 if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[4];
                                 if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[3];
                                 if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[2];
                                 if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[1];
                                 if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr -= 32;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[7];
                                 if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[6];
                                 if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[5];
                                 if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[4];
                                 if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[3];
                                 if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[2];
                                 if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[1];
                                 if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr -= 32;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[7];
                              if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[6];
                              if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[5];
                              if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[4];
                              if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[3];
                              if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[2];
                              if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[1];
                              if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[7];
                           if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[6];
                           if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[5];
                           if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[4];
                           if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[3];
                           if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[2];
                           if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[1];
                           if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            case 0x2:
            {
               ;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) ;
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 if (partial_tile_offset >= 4)
                                    current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                                 else
                                 {
                                    current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                    if ((partial_tile_offset + partial_tile_run) > 4)
                                    {
                                       u32 old_run = partial_tile_run;
                                       partial_tile_run = 4 - partial_tile_offset;
                                       for (i = 0; i < partial_tile_run; i++)
                                       {
                                          current_pixel = current_pixels & 0xFF;
                                          if (current_pixel)
                                          {
                                             dest = dest_ptr[0];
                                             if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                                     pixel_combine;
                                             else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                          };
                                          current_pixels >>= 8;
                                          dest_ptr += 1;
                                       };
                                       partial_tile_run = old_run - partial_tile_run;
                                       current_pixels = *((u32*)(tile_ptr + 4));
                                    }
                                 }
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels >>= 8;
                                    dest_ptr += 1;
                                 };;
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              if (partial_tile_offset >= 4)
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels >>= 8;
                                    dest_ptr += 1;
                                 };
                              }
                              else
                              {
                                 partial_tile_run -= 4;
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels >>= 8;
                                    dest_ptr += 1;
                                 };
                                 current_pixels = *((u32*)(tile_ptr + 4));
                                 if (current_pixels != 0)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 0];
                                       if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixel = (current_pixels >> 8) & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 1];
                                       if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixel = (current_pixels >> 16) & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 2];
                                       if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 3];
                                       if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                 };
                                 dest_ptr += 4;
                              };
                              tile_ptr += 64;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 0];
                                 if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 1];
                                 if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 2];
                                 if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 3];
                                 if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr += 64;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           if (partial_tile_run >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 0];
                                    if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 1];
                                    if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 2];
                                    if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 3];
                                    if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                              };
                              dest_ptr += 4;
                              tile_ptr += 4;
                              partial_tile_run -= 4;
                           }
                           current_pixels = *((u32*)(tile_ptr));
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 0];
                                    if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 1];
                                    if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 2];
                                    if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 3];
                                    if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 0];
                                 if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 1];
                                 if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 2];
                                 if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 3];
                                 if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr += 64;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 0];
                              if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 1];
                              if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 2];
                              if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 3];
                              if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           dest_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 0];
                           if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 1];
                           if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 2];
                           if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 3];
                           if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 0];
                           if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 1];
                           if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 2];
                           if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 3];
                           if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            case 0x3:
            {
               ;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) +
                          (64 * ((obj_width - 8) / 8));
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                             partial_tile_offset - 4) * 8);
                                 else
                                 {
                                    current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                    if ((partial_tile_offset + partial_tile_run) > 4)
                                    {
                                       u32 old_run = partial_tile_run;
                                       partial_tile_run = 4 - partial_tile_offset;
                                       for (i = 0; i < partial_tile_run; i++)
                                       {
                                          current_pixel = current_pixels >> 24;
                                          if (current_pixel)
                                          {
                                             dest = dest_ptr[0];
                                             if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                                     pixel_combine;
                                             else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                          };
                                          current_pixels <<= 8;
                                          dest_ptr += 1;
                                       };
                                       partial_tile_run = old_run - partial_tile_run;
                                       current_pixels = *((u32*)(tile_ptr));
                                    }
                                 }
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels <<= 8;
                                    dest_ptr += 1;
                                 };;
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              if (partial_tile_offset >= 4)
                              {
                                 current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels <<= 8;
                                    dest_ptr += 1;
                                 };
                              }
                              else
                              {
                                 partial_tile_run -= 4;
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels <<= 8;
                                    dest_ptr += 1;
                                 };
                                 current_pixels = *((u32*)tile_ptr);
                                 if (current_pixels != 0)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 3];
                                       if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixel = (current_pixels >> 8) & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 2];
                                       if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixel = (current_pixels >> 16) & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 1];
                                       if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 0];
                                       if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                 };
                                 dest_ptr += 4;
                              };
                              tile_ptr -= 64;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 3];
                                 if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 2];
                                 if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 1];
                                 if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 0];
                                 if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr -= 64;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           if (partial_tile_run >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 3];
                                    if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 2];
                                    if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 1];
                                    if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 0];
                                    if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                              };
                              dest_ptr += 4;
                              tile_ptr -= 4;
                              partial_tile_run -= 4;
                           }
                           current_pixels = *((u32*)(tile_ptr + 4));
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 3];
                                    if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 2];
                                    if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 1];
                                    if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 0];
                                    if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 3];
                                 if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 2];
                                 if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 1];
                                 if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 0];
                                 if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr -= 64;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 3];
                              if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 2];
                              if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 1];
                              if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 0];
                              if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           dest_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 3];
                           if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 2];
                           if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 1];
                           if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 0];
                           if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 3];
                           if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 2];
                           if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 1];
                           if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 0];
                           if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            }
         };
      }
      else
      {
         pixel_combine = base_pixel_combine;
         if (obj_attribute_0 & 0x100)
         {
            if ((obj_attribute_0 >> 13) & 0x01)
            {
               {
                  s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
                  s32 dx = params[3];
                  s32 dmx = params[7];
                  s32 dy = params[11];
                  s32 dmy = params[15];
                  s32 source_x, source_y;
                  s32 tile_x, tile_y;
                  u32 tile_map_offset;
                  s32 middle_x;
                  s32 middle_y;
                  s32 max_x = obj_width;
                  s32 max_y = obj_height;
                  s32 y_delta;
                  u32 obj_pitch = 8;
                  u32 obj_tile_pitch;
                  middle_x = (obj_width / 2);
                  middle_y = (obj_height / 2);
                  source_x = (middle_x << 8);
                  source_y = (middle_y << 8);
                  if (obj_attribute_0 & 0x200)
                  {
                     obj_width *= 2;
                     obj_height *= 2;
                     middle_x *= 2;
                     middle_y *= 2;
                  }
                  if ((s32)obj_x < (s32)start)
                  {
                     u32 x_delta = start - obj_x;
                     middle_x -= x_delta;
                     obj_width -= x_delta;
                     obj_x = start;
                     if ((s32)obj_width <= 0) continue;
                  }
                  if ((s32)(obj_x + obj_width) >= (s32)end)
                  {
                     obj_width = end - obj_x;
                     if ((s32)obj_width <= 0) continue;
                  }
                  dest_ptr = scanline + obj_x;
                  y_delta = vcount - (obj_y + middle_y); ;
                  if (dy == 0)
                  {
                     {
                        u32 vertical_offset;
                        source_y += (y_delta * dmy);
                        vertical_offset = (source_y >> 8);
                        if ((u32)vertical_offset < (u32)max_y)
                        {
                           tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                         vertical_offset / 8) * (max_x / 8) * 64) + ((vertical_offset % 8) * 8);
                           source_x += (y_delta * dmx) - (middle_x * dx);
                           for (i = 0; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x < (u32)max_x) break;
                              source_x += dx;
                              dest_ptr += 1;
                           }
                           for (; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x >= (u32)max_x) break;
                              tile_map_offset = (tile_x >> 3) * 64;
                              current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;;
                              source_x += dx;
                              dest_ptr += 1;
                           }
                        }
                     };
                  }
                  else
                  {
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                        obj_tile_pitch = (max_x / 8) * 64;
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        source_y += (y_delta * dmy) - (middle_x * dy);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                           tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                       tile_y & 0x07) * obj_pitch)]; ;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                     };
                  }
               };
            }
            else
            {
               {
                  s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
                  s32 dx = params[3];
                  s32 dmx = params[7];
                  s32 dy = params[11];
                  s32 dmy = params[15];
                  s32 source_x, source_y;
                  s32 tile_x, tile_y;
                  u32 tile_map_offset;
                  s32 middle_x;
                  s32 middle_y;
                  s32 max_x = obj_width;
                  s32 max_y = obj_height;
                  s32 y_delta;
                  u32 obj_pitch = 4;
                  u32 obj_tile_pitch;
                  middle_x = (obj_width / 2);
                  middle_y = (obj_height / 2);
                  source_x = (middle_x << 8);
                  source_y = (middle_y << 8);
                  if (obj_attribute_0 & 0x200)
                  {
                     obj_width *= 2;
                     obj_height *= 2;
                     middle_x *= 2;
                     middle_y *= 2;
                  }
                  if ((s32)obj_x < (s32)start)
                  {
                     u32 x_delta = start - obj_x;
                     middle_x -= x_delta;
                     obj_width -= x_delta;
                     obj_x = start;
                     if ((s32)obj_width <= 0) continue;
                  }
                  if ((s32)(obj_x + obj_width) >= (s32)end)
                  {
                     obj_width = end - obj_x;
                     if ((s32)obj_width <= 0) continue;
                  }
                  dest_ptr = scanline + obj_x;
                  y_delta = vcount - (obj_y + middle_y);
                  current_palette = (obj_attribute_2 >> 8) & 0xF0;
                  if (dy == 0)
                  {
                     {
                        u32 vertical_offset;
                        source_y += (y_delta * dmy);
                        vertical_offset = (source_y >> 8);
                        if ((u32)vertical_offset < (u32)max_y)
                        {
                           tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                         vertical_offset / 8) * (max_x / 8) * 32) + ((vertical_offset % 8) * 4);
                           source_x += (y_delta * dmx) - (middle_x * dx);
                           for (i = 0; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x < (u32)max_x) break;
                              source_x += dx;
                              dest_ptr += 1;
                           }
                           for (; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x >= (u32)max_x) break;
                              tile_map_offset = (tile_x >> 3) * 32;
                              current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                              if (tile_x & 0x01) current_pixel >>= 4;
                              else current_pixel &= 0x0F; ;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              source_x += dx;
                              dest_ptr += 1;
                           }
                        }
                     };
                  }
                  else
                  {
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                        obj_tile_pitch = (max_x / 8) * 32;
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        source_y += (y_delta * dmy) - (middle_x * dy);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                           tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                       tile_y & 0x07) * obj_pitch)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                     };
                  }
               };
            }
         }
         else
         {
            vertical_offset = vcount - obj_y;
            if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                     vertical_offset - 1;
            switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
            {
            case 0x0:
            {
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) ;
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0x0F;
                                    if (current_pixel)
                                    {
                                       current_pixel |= current_palette;
                                       dest_ptr[0] = current_pixel | pixel_combine;
                                    };
                                    current_pixels >>= 4;
                                    dest_ptr += 1;
                                 };
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = current_pixel | pixel_combine;
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                              };
                              tile_ptr += 32;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[1] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[2] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[3] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[4] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[5] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[6] = current_pixel | pixel_combine;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[7] = current_pixel | pixel_combine;
                              };
                           };
                           tile_ptr += 32;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[1] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[2] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[3] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[4] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[5] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[6] = current_pixel | pixel_combine;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[7] = current_pixel | pixel_combine;
                              };
                           };
                           tile_ptr += 32;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = current_pixel | pixel_combine;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = current_pixel | pixel_combine;
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            case 0x1:
            {
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) +
                          (32 * ((obj_width - 8) / 8));
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 28;
                                    if (current_pixel)
                                    {
                                       current_pixel |= current_palette;
                                       dest_ptr[0] = current_pixel | pixel_combine;
                                    };
                                    current_pixels <<= 4;
                                    dest_ptr += 1;
                                 };
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = current_pixel | pixel_combine;
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                              };
                              tile_ptr -= 32;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[7] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[6] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[5] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[4] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[3] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[2] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[1] = current_pixel | pixel_combine;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                           };
                           tile_ptr -= 32;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[7] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[6] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[5] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[4] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[3] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[2] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[1] = current_pixel | pixel_combine;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                           };
                           tile_ptr -= 32;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = current_pixel | pixel_combine;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            case 0x2:
            {
               ;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) ;
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 if (partial_tile_offset >= 4)
                                    current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                                 else
                                 {
                                    current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                    if ((partial_tile_offset + partial_tile_run) > 4)
                                    {
                                       u32 old_run = partial_tile_run;
                                       partial_tile_run = 4 - partial_tile_offset;
                                       for (i = 0; i < partial_tile_run; i++)
                                       {
                                          current_pixel = current_pixels & 0xFF;
                                          if (current_pixel)
                                             dest_ptr[0] = current_pixel | pixel_combine;  ;
                                          current_pixels >>= 8;
                                          dest_ptr += 1;
                                       };
                                       partial_tile_run = old_run - partial_tile_run;
                                       current_pixels = *((u32*)(tile_ptr + 4));
                                    }
                                 }
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0] = current_pixel | pixel_combine;  ;
                                    current_pixels >>= 8;
                                    dest_ptr += 1;
                                 };;
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              if (partial_tile_offset >= 4)
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0] = current_pixel | pixel_combine;  ;
                                    current_pixels >>= 8;
                                    dest_ptr += 1;
                                 };
                              }
                              else
                              {
                                 partial_tile_run -= 4;
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0] = current_pixel | pixel_combine;  ;
                                    current_pixels >>= 8;
                                    dest_ptr += 1;
                                 };
                                 current_pixels = *((u32*)(tile_ptr + 4));
                                 if (current_pixels != 0)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                                    current_pixel = (current_pixels >> 8) & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                    current_pixel = (current_pixels >> 16) & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                       dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                                 };
                                 dest_ptr += 4;
                              };
                              tile_ptr += 64;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                           };
                           tile_ptr += 64;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           if (partial_tile_run >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                              tile_ptr += 4;
                              partial_tile_run -= 4;
                           }
                           current_pixels = *((u32*)(tile_ptr));
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                           };
                           tile_ptr += 64;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            case 0x3:
            {
               ;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) +
                          (64 * ((obj_width - 8) / 8));
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                             partial_tile_offset - 4) * 8);
                                 else
                                 {
                                    current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                    if ((partial_tile_offset + partial_tile_run) > 4)
                                    {
                                       u32 old_run = partial_tile_run;
                                       partial_tile_run = 4 - partial_tile_offset;
                                       for (i = 0; i < partial_tile_run; i++)
                                       {
                                          current_pixel = current_pixels >> 24;
                                          if (current_pixel)
                                             dest_ptr[0] = current_pixel | pixel_combine;  ;
                                          current_pixels <<= 8;
                                          dest_ptr += 1;
                                       };
                                       partial_tile_run = old_run - partial_tile_run;
                                       current_pixels = *((u32*)(tile_ptr));
                                    }
                                 }
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                       dest_ptr[0] = current_pixel | pixel_combine;  ;
                                    current_pixels <<= 8;
                                    dest_ptr += 1;
                                 };;
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              if (partial_tile_offset >= 4)
                              {
                                 current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                       dest_ptr[0] = current_pixel | pixel_combine;  ;
                                    current_pixels <<= 8;
                                    dest_ptr += 1;
                                 };
                              }
                              else
                              {
                                 partial_tile_run -= 4;
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                       dest_ptr[0] = current_pixel | pixel_combine;  ;
                                    current_pixels <<= 8;
                                    dest_ptr += 1;
                                 };
                                 current_pixels = *((u32*)tile_ptr);
                                 if (current_pixels != 0)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                                    current_pixel = (current_pixels >> 8) & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                    current_pixel = (current_pixels >> 16) & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                       dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                                 };
                                 dest_ptr += 4;
                              };
                              tile_ptr -= 64;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                           };
                           tile_ptr -= 64;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           if (partial_tile_run >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                              tile_ptr -= 4;
                              partial_tile_run -= 4;
                           }
                           current_pixels = *((u32*)(tile_ptr + 4));
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                           };
                           tile_ptr -= 64;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            }
         };
      };
   }
};
static void render_scanline_obj_partial_alpha_2D(u32 priority, u32 start,
      u32 end, u32* scanline)
{
   u32 pixel_combine = (((io_registers[REG_BLDCNT] >> 4) & 0x01) | ((
                           io_registers[REG_BLDCNT] >> (4 + 7)) & 0x02)) << 9 | (1 << 8);
   u32 base_pixel_combine = pixel_combine;
   u32 dest;
   s32 obj_num, i;
   s32 obj_x, obj_y;
   s32 obj_size;
   s32 obj_width, obj_height;
   u32 obj_attribute_0, obj_attribute_1, obj_attribute_2;
   s32 vcount = io_registers[REG_VCOUNT];
   u32 tile_run;
   u32 current_pixels;
   u32 current_pixel;
   u32 current_palette;
   u32 vertical_offset;
   u32 partial_tile_run, partial_tile_offset;
   u32 pixel_run;
   u16* oam_ptr;
   u32* dest_ptr;
   u8* tile_base = vram + 0x10000;
   u8* tile_ptr;
   u32 obj_count = obj_priority_count[priority][vcount];
   u8* obj_list = obj_priority_list[priority][vcount];
   for (obj_num = 0; obj_num < obj_count; obj_num++)
   {
      oam_ptr = oam_ram + (obj_list[obj_num] * 4);
      obj_attribute_0 = oam_ptr[0];
      obj_attribute_1 = oam_ptr[1];
      obj_attribute_2 = oam_ptr[2];
      obj_size = ((obj_attribute_0 >> 12) & 0x0C) | (obj_attribute_1 >> 14);
      obj_x = (s32)(obj_attribute_1 << 23) >> 23;
      obj_width = obj_width_table[obj_size]; ;
      obj_y = obj_attribute_0 & 0xFF;
      if (obj_y > 160) obj_y -= 256;
      obj_height = obj_height_table[obj_size];
      if ((obj_attribute_0 >> 10) & 0x03)
      {
         pixel_combine = 0x00000300;
         if (obj_attribute_0 & 0x100)
         {
            if ((obj_attribute_0 >> 13) & 0x01)
            {
               {
                  s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
                  s32 dx = params[3];
                  s32 dmx = params[7];
                  s32 dy = params[11];
                  s32 dmy = params[15];
                  s32 source_x, source_y;
                  s32 tile_x, tile_y;
                  u32 tile_map_offset;
                  s32 middle_x;
                  s32 middle_y;
                  s32 max_x = obj_width;
                  s32 max_y = obj_height;
                  s32 y_delta;
                  u32 obj_pitch = 8;
                  u32 obj_tile_pitch;
                  middle_x = (obj_width / 2);
                  middle_y = (obj_height / 2);
                  source_x = (middle_x << 8);
                  source_y = (middle_y << 8);
                  if (obj_attribute_0 & 0x200)
                  {
                     obj_width *= 2;
                     obj_height *= 2;
                     middle_x *= 2;
                     middle_y *= 2;
                  }
                  if ((s32)obj_x < (s32)start)
                  {
                     u32 x_delta = start - obj_x;
                     middle_x -= x_delta;
                     obj_width -= x_delta;
                     obj_x = start;
                     if ((s32)obj_width <= 0) continue;
                  }
                  if ((s32)(obj_x + obj_width) >= (s32)end)
                  {
                     obj_width = end - obj_x;
                     if ((s32)obj_width <= 0) continue;
                  }
                  dest_ptr = scanline + obj_x;
                  y_delta = vcount - (obj_y + middle_y); ;
                  if (dy == 0)
                  {
                     {
                        u32 vertical_offset;
                        source_y += (y_delta * dmy);
                        vertical_offset = (source_y >> 8);
                        if ((u32)vertical_offset < (u32)max_y)
                        {
                           tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                         vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8);
                           source_x += (y_delta * dmx) - (middle_x * dx);
                           for (i = 0; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x < (u32)max_x) break;
                              source_x += dx;
                              dest_ptr += 1;
                           }
                           for (; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x >= (u32)max_x) break;
                              tile_map_offset = (tile_x >> 3) * 64;
                              current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };;
                              source_x += dx;
                              dest_ptr += 1;
                           }
                        }
                     };
                  }
                  else
                  {
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                        obj_tile_pitch = 1024;
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        source_y += (y_delta * dmy) - (middle_x * dy);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                           tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                       tile_y & 0x07) * obj_pitch)]; ;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                     };
                  }
               };
            }
            else
            {
               {
                  s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
                  s32 dx = params[3];
                  s32 dmx = params[7];
                  s32 dy = params[11];
                  s32 dmy = params[15];
                  s32 source_x, source_y;
                  s32 tile_x, tile_y;
                  u32 tile_map_offset;
                  s32 middle_x;
                  s32 middle_y;
                  s32 max_x = obj_width;
                  s32 max_y = obj_height;
                  s32 y_delta;
                  u32 obj_pitch = 4;
                  u32 obj_tile_pitch;
                  middle_x = (obj_width / 2);
                  middle_y = (obj_height / 2);
                  source_x = (middle_x << 8);
                  source_y = (middle_y << 8);
                  if (obj_attribute_0 & 0x200)
                  {
                     obj_width *= 2;
                     obj_height *= 2;
                     middle_x *= 2;
                     middle_y *= 2;
                  }
                  if ((s32)obj_x < (s32)start)
                  {
                     u32 x_delta = start - obj_x;
                     middle_x -= x_delta;
                     obj_width -= x_delta;
                     obj_x = start;
                     if ((s32)obj_width <= 0) continue;
                  }
                  if ((s32)(obj_x + obj_width) >= (s32)end)
                  {
                     obj_width = end - obj_x;
                     if ((s32)obj_width <= 0) continue;
                  }
                  dest_ptr = scanline + obj_x;
                  y_delta = vcount - (obj_y + middle_y);
                  current_palette = (obj_attribute_2 >> 8) & 0xF0;
                  if (dy == 0)
                  {
                     {
                        u32 vertical_offset;
                        source_y += (y_delta * dmy);
                        vertical_offset = (source_y >> 8);
                        if ((u32)vertical_offset < (u32)max_y)
                        {
                           tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                         vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4);
                           source_x += (y_delta * dmx) - (middle_x * dx);
                           for (i = 0; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x < (u32)max_x) break;
                              source_x += dx;
                              dest_ptr += 1;
                           }
                           for (; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x >= (u32)max_x) break;
                              tile_map_offset = (tile_x >> 3) * 32;
                              current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                              if (tile_x & 0x01) current_pixel >>= 4;
                              else current_pixel &= 0x0F; ;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              source_x += dx;
                              dest_ptr += 1;
                           }
                        }
                     };
                  }
                  else
                  {
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                        obj_tile_pitch = 1024;
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        source_y += (y_delta * dmy) - (middle_x * dy);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                           tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                       tile_y & 0x07) * obj_pitch)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                     };
                  }
               };
            }
         }
         else
         {
            vertical_offset = vcount - obj_y;
            if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                     vertical_offset - 1;
            switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
            {
            case 0x0:
            {
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) ;
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0x0F;
                                    if (current_pixel)
                                    {
                                       current_pixel |= current_palette;
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels >>= 4;
                                    dest_ptr += 1;
                                 };
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                              };
                              tile_ptr += 32;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[1];
                                 if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[2];
                                 if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[3];
                                 if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[4];
                                 if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[5];
                                 if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[6];
                                 if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[7];
                                 if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr += 32;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[1];
                                 if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[2];
                                 if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[3];
                                 if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[4];
                                 if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[5];
                                 if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[6];
                                 if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[7];
                                 if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr += 32;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[1];
                              if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[2];
                              if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[3];
                              if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[4];
                              if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[5];
                              if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[6];
                              if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[7];
                              if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[1];
                           if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[2];
                           if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[3];
                           if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[4];
                           if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[5];
                           if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[6];
                           if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[7];
                           if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            case 0x1:
            {
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) + (32 * ((
                                      obj_width - 8) / 8));
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 28;
                                    if (current_pixel)
                                    {
                                       current_pixel |= current_palette;
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels <<= 4;
                                    dest_ptr += 1;
                                 };
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                              };
                              tile_ptr -= 32;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[7];
                                 if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[6];
                                 if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[5];
                                 if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[4];
                                 if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[3];
                                 if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[2];
                                 if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[1];
                                 if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr -= 32;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[7];
                                 if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[6];
                                 if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[5];
                                 if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[4];
                                 if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[3];
                                 if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[2];
                                 if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[1];
                                 if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr -= 32;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[7];
                              if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[6];
                              if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[5];
                              if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[4];
                              if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[3];
                              if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[2];
                              if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[1];
                              if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[7];
                           if (dest & 0x00000100) dest_ptr[7] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[7] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[6];
                           if (dest & 0x00000100) dest_ptr[6] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[6] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[5];
                           if (dest & 0x00000100) dest_ptr[5] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[5] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[4];
                           if (dest & 0x00000100) dest_ptr[4] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[4] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[3];
                           if (dest & 0x00000100) dest_ptr[3] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[2];
                           if (dest & 0x00000100) dest_ptr[2] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[1];
                           if (dest & 0x00000100) dest_ptr[1] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest = dest_ptr[0];
                           if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                   pixel_combine;
                           else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            case 0x2:
            {
               ;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) ;
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 if (partial_tile_offset >= 4)
                                    current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                                 else
                                 {
                                    current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                    if ((partial_tile_offset + partial_tile_run) > 4)
                                    {
                                       u32 old_run = partial_tile_run;
                                       partial_tile_run = 4 - partial_tile_offset;
                                       for (i = 0; i < partial_tile_run; i++)
                                       {
                                          current_pixel = current_pixels & 0xFF;
                                          if (current_pixel)
                                          {
                                             dest = dest_ptr[0];
                                             if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                                     pixel_combine;
                                             else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                          };
                                          current_pixels >>= 8;
                                          dest_ptr += 1;
                                       };
                                       partial_tile_run = old_run - partial_tile_run;
                                       current_pixels = *((u32*)(tile_ptr + 4));
                                    }
                                 }
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels >>= 8;
                                    dest_ptr += 1;
                                 };;
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              if (partial_tile_offset >= 4)
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels >>= 8;
                                    dest_ptr += 1;
                                 };
                              }
                              else
                              {
                                 partial_tile_run -= 4;
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels >>= 8;
                                    dest_ptr += 1;
                                 };
                                 current_pixels = *((u32*)(tile_ptr + 4));
                                 if (current_pixels != 0)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 0];
                                       if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixel = (current_pixels >> 8) & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 1];
                                       if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixel = (current_pixels >> 16) & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 2];
                                       if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 3];
                                       if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                 };
                                 dest_ptr += 4;
                              };
                              tile_ptr += 64;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 0];
                                 if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 1];
                                 if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 2];
                                 if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 3];
                                 if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr += 64;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           if (partial_tile_run >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 0];
                                    if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 1];
                                    if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 2];
                                    if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 3];
                                    if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                              };
                              dest_ptr += 4;
                              tile_ptr += 4;
                              partial_tile_run -= 4;
                           }
                           current_pixels = *((u32*)(tile_ptr));
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 0];
                                    if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 1];
                                    if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 2];
                                    if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 3];
                                    if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 0];
                                 if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 1];
                                 if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 2];
                                 if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 3];
                                 if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr += 64;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 0];
                              if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 1];
                              if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 2];
                              if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 3];
                              if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           dest_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 0];
                           if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 1];
                           if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 2];
                           if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 3];
                           if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 0];
                           if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 1];
                           if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 2];
                           if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 3];
                           if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            case 0x3:
            {
               ;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) + (64 * ((
                                      obj_width - 8) / 8));
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                             partial_tile_offset - 4) * 8);
                                 else
                                 {
                                    current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                    if ((partial_tile_offset + partial_tile_run) > 4)
                                    {
                                       u32 old_run = partial_tile_run;
                                       partial_tile_run = 4 - partial_tile_offset;
                                       for (i = 0; i < partial_tile_run; i++)
                                       {
                                          current_pixel = current_pixels >> 24;
                                          if (current_pixel)
                                          {
                                             dest = dest_ptr[0];
                                             if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                                     pixel_combine;
                                             else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                          };
                                          current_pixels <<= 8;
                                          dest_ptr += 1;
                                       };
                                       partial_tile_run = old_run - partial_tile_run;
                                       current_pixels = *((u32*)(tile_ptr));
                                    }
                                 }
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels <<= 8;
                                    dest_ptr += 1;
                                 };;
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              if (partial_tile_offset >= 4)
                              {
                                 current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels <<= 8;
                                    dest_ptr += 1;
                                 };
                              }
                              else
                              {
                                 partial_tile_run -= 4;
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0];
                                       if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                               pixel_combine;
                                       else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixels <<= 8;
                                    dest_ptr += 1;
                                 };
                                 current_pixels = *((u32*)tile_ptr);
                                 if (current_pixels != 0)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 3];
                                       if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixel = (current_pixels >> 8) & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 2];
                                       if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixel = (current_pixels >> 16) & 0xFF;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 1];
                                       if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                    {
                                       dest = dest_ptr[0 + 0];
                                       if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                                pixel_combine;
                                       else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                    };
                                 };
                                 dest_ptr += 4;
                              };
                              tile_ptr -= 64;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 3];
                                 if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 2];
                                 if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 1];
                                 if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 0];
                                 if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr -= 64;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           if (partial_tile_run >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 3];
                                    if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 2];
                                    if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 1];
                                    if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 0];
                                    if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                              };
                              dest_ptr += 4;
                              tile_ptr -= 4;
                              partial_tile_run -= 4;
                           }
                           current_pixels = *((u32*)(tile_ptr + 4));
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0];
                                 if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                         pixel_combine;
                                 else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0];
                                    if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                            pixel_combine;
                                    else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 3];
                                    if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 2];
                                    if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 1];
                                    if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                 {
                                    dest = dest_ptr[0 + 0];
                                    if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                             pixel_combine;
                                    else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                                 };
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 3];
                                 if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 2];
                                 if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 1];
                                 if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[4 + 0];
                                 if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           tile_ptr -= 64;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 3];
                              if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 2];
                              if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 1];
                              if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0 + 0];
                              if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 3];
                              if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 2];
                              if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 1];
                              if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[4 + 0];
                              if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                       pixel_combine;
                              else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 3];
                                 if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 2];
                                 if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 1];
                                 if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                              {
                                 dest = dest_ptr[0 + 0];
                                 if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                          pixel_combine;
                                 else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                              };
                           };
                           dest_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                           {
                              dest = dest_ptr[0];
                              if (dest & 0x00000100) dest_ptr[0] = (dest & 0xFFFF0000) | current_pixel |
                                                                      pixel_combine;
                              else dest_ptr[0] = (dest << 16) | current_pixel | pixel_combine;;
                           };
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 3];
                           if (dest & 0x00000100) dest_ptr[0 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 2];
                           if (dest & 0x00000100) dest_ptr[0 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 1];
                           if (dest & 0x00000100) dest_ptr[0 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[0 + 0];
                           if (dest & 0x00000100) dest_ptr[0 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[0 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 3];
                           if (dest & 0x00000100) dest_ptr[4 + 3] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 3] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 2];
                           if (dest & 0x00000100) dest_ptr[4 + 2] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 2] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 1];
                           if (dest & 0x00000100) dest_ptr[4 + 1] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 1] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                        {
                           dest = dest_ptr[4 + 0];
                           if (dest & 0x00000100) dest_ptr[4 + 0] = (dest & 0xFFFF0000) | current_pixel |
                                    pixel_combine;
                           else dest_ptr[4 + 0] = (dest << 16) | current_pixel | pixel_combine;;
                        };
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            }
         };
      }
      else
      {
         pixel_combine = base_pixel_combine;
         if (obj_attribute_0 & 0x100)
         {
            if ((obj_attribute_0 >> 13) & 0x01)
            {
               {
                  s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
                  s32 dx = params[3];
                  s32 dmx = params[7];
                  s32 dy = params[11];
                  s32 dmy = params[15];
                  s32 source_x, source_y;
                  s32 tile_x, tile_y;
                  u32 tile_map_offset;
                  s32 middle_x;
                  s32 middle_y;
                  s32 max_x = obj_width;
                  s32 max_y = obj_height;
                  s32 y_delta;
                  u32 obj_pitch = 8;
                  u32 obj_tile_pitch;
                  middle_x = (obj_width / 2);
                  middle_y = (obj_height / 2);
                  source_x = (middle_x << 8);
                  source_y = (middle_y << 8);
                  if (obj_attribute_0 & 0x200)
                  {
                     obj_width *= 2;
                     obj_height *= 2;
                     middle_x *= 2;
                     middle_y *= 2;
                  }
                  if ((s32)obj_x < (s32)start)
                  {
                     u32 x_delta = start - obj_x;
                     middle_x -= x_delta;
                     obj_width -= x_delta;
                     obj_x = start;
                     if ((s32)obj_width <= 0) continue;
                  }
                  if ((s32)(obj_x + obj_width) >= (s32)end)
                  {
                     obj_width = end - obj_x;
                     if ((s32)obj_width <= 0) continue;
                  }
                  dest_ptr = scanline + obj_x;
                  y_delta = vcount - (obj_y + middle_y); ;
                  if (dy == 0)
                  {
                     {
                        u32 vertical_offset;
                        source_y += (y_delta * dmy);
                        vertical_offset = (source_y >> 8);
                        if ((u32)vertical_offset < (u32)max_y)
                        {
                           tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                         vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8);
                           source_x += (y_delta * dmx) - (middle_x * dx);
                           for (i = 0; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x < (u32)max_x) break;
                              source_x += dx;
                              dest_ptr += 1;
                           }
                           for (; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x >= (u32)max_x) break;
                              tile_map_offset = (tile_x >> 3) * 64;
                              current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;;
                              source_x += dx;
                              dest_ptr += 1;
                           }
                        }
                     };
                  }
                  else
                  {
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                        obj_tile_pitch = 1024;
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        source_y += (y_delta * dmy) - (middle_x * dy);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                           tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                       tile_y & 0x07) * obj_pitch)]; ;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                     };
                  }
               };
            }
            else
            {
               {
                  s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
                  s32 dx = params[3];
                  s32 dmx = params[7];
                  s32 dy = params[11];
                  s32 dmy = params[15];
                  s32 source_x, source_y;
                  s32 tile_x, tile_y;
                  u32 tile_map_offset;
                  s32 middle_x;
                  s32 middle_y;
                  s32 max_x = obj_width;
                  s32 max_y = obj_height;
                  s32 y_delta;
                  u32 obj_pitch = 4;
                  u32 obj_tile_pitch;
                  middle_x = (obj_width / 2);
                  middle_y = (obj_height / 2);
                  source_x = (middle_x << 8);
                  source_y = (middle_y << 8);
                  if (obj_attribute_0 & 0x200)
                  {
                     obj_width *= 2;
                     obj_height *= 2;
                     middle_x *= 2;
                     middle_y *= 2;
                  }
                  if ((s32)obj_x < (s32)start)
                  {
                     u32 x_delta = start - obj_x;
                     middle_x -= x_delta;
                     obj_width -= x_delta;
                     obj_x = start;
                     if ((s32)obj_width <= 0) continue;
                  }
                  if ((s32)(obj_x + obj_width) >= (s32)end)
                  {
                     obj_width = end - obj_x;
                     if ((s32)obj_width <= 0) continue;
                  }
                  dest_ptr = scanline + obj_x;
                  y_delta = vcount - (obj_y + middle_y);
                  current_palette = (obj_attribute_2 >> 8) & 0xF0;
                  if (dy == 0)
                  {
                     {
                        u32 vertical_offset;
                        source_y += (y_delta * dmy);
                        vertical_offset = (source_y >> 8);
                        if ((u32)vertical_offset < (u32)max_y)
                        {
                           tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                         vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4);
                           source_x += (y_delta * dmx) - (middle_x * dx);
                           for (i = 0; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x < (u32)max_x) break;
                              source_x += dx;
                              dest_ptr += 1;
                           }
                           for (; i < obj_width; i++)
                           {
                              tile_x = (source_x >> 8);
                              if ((u32)tile_x >= (u32)max_x) break;
                              tile_map_offset = (tile_x >> 3) * 32;
                              current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                              if (tile_x & 0x01) current_pixel >>= 4;
                              else current_pixel &= 0x0F; ;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              source_x += dx;
                              dest_ptr += 1;
                           }
                        }
                     };
                  }
                  else
                  {
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                        obj_tile_pitch = 1024;
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        source_y += (y_delta * dmy) - (middle_x * dy);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           tile_y = (source_y >> 8);
                           if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                           tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                       tile_y & 0x07) * obj_pitch)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           source_x += dx;
                           source_y += dy;
                           dest_ptr += 1;
                        }
                     };
                  }
               };
            }
         }
         else
         {
            vertical_offset = vcount - obj_y;
            if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                     vertical_offset - 1;
            switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
            {
            case 0x0:
            {
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) ;
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0x0F;
                                    if (current_pixel)
                                    {
                                       current_pixel |= current_palette;
                                       dest_ptr[0] = current_pixel | pixel_combine;
                                    };
                                    current_pixels >>= 4;
                                    dest_ptr += 1;
                                 };
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = current_pixel | pixel_combine;
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                              };
                              tile_ptr += 32;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[1] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[2] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[3] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[4] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[5] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[6] = current_pixel | pixel_combine;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[7] = current_pixel | pixel_combine;
                              };
                           };
                           tile_ptr += 32;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[1] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[2] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[3] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[4] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[5] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[6] = current_pixel | pixel_combine;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[7] = current_pixel | pixel_combine;
                              };
                           };
                           tile_ptr += 32;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = current_pixel | pixel_combine;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = current_pixel | pixel_combine;
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            case 0x1:
            {
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) + (32 * ((
                                      obj_width - 8) / 8));
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 28;
                                    if (current_pixel)
                                    {
                                       current_pixel |= current_palette;
                                       dest_ptr[0] = current_pixel | pixel_combine;
                                    };
                                    current_pixels <<= 4;
                                    dest_ptr += 1;
                                 };
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = current_pixel | pixel_combine;
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                              };
                              tile_ptr -= 32;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[7] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[6] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[5] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[4] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[3] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[2] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[1] = current_pixel | pixel_combine;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                           };
                           tile_ptr -= 32;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 32;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[7] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 4) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[6] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 8) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[5] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 12) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[4] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 16) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[3] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 20) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[2] = current_pixel | pixel_combine;
                              };
                              current_pixel = (current_pixels >> 24) & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[1] = current_pixel | pixel_combine;
                              };
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = current_pixel | pixel_combine;
                              };
                           };
                           tile_ptr -= 32;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = current_pixel | pixel_combine;
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = current_pixel | pixel_combine;
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = current_pixel | pixel_combine;
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = current_pixel | pixel_combine;
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = current_pixel | pixel_combine;
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = current_pixel | pixel_combine;
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            case 0x2:
            {
               ;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) ;
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 if (partial_tile_offset >= 4)
                                    current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                                 else
                                 {
                                    current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                    if ((partial_tile_offset + partial_tile_run) > 4)
                                    {
                                       u32 old_run = partial_tile_run;
                                       partial_tile_run = 4 - partial_tile_offset;
                                       for (i = 0; i < partial_tile_run; i++)
                                       {
                                          current_pixel = current_pixels & 0xFF;
                                          if (current_pixel)
                                             dest_ptr[0] = current_pixel | pixel_combine;  ;
                                          current_pixels >>= 8;
                                          dest_ptr += 1;
                                       };
                                       partial_tile_run = old_run - partial_tile_run;
                                       current_pixels = *((u32*)(tile_ptr + 4));
                                    }
                                 }
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0] = current_pixel | pixel_combine;  ;
                                    current_pixels >>= 8;
                                    dest_ptr += 1;
                                 };;
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              if (partial_tile_offset >= 4)
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0] = current_pixel | pixel_combine;  ;
                                    current_pixels >>= 8;
                                    dest_ptr += 1;
                                 };
                              }
                              else
                              {
                                 partial_tile_run -= 4;
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0] = current_pixel | pixel_combine;  ;
                                    current_pixels >>= 8;
                                    dest_ptr += 1;
                                 };
                                 current_pixels = *((u32*)(tile_ptr + 4));
                                 if (current_pixels != 0)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                                    current_pixel = (current_pixels >> 8) & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                    current_pixel = (current_pixels >> 16) & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                       dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                                 };
                                 dest_ptr += 4;
                              };
                              tile_ptr += 64;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                           };
                           tile_ptr += 64;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           if (partial_tile_run >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                              tile_ptr += 4;
                              partial_tile_run -= 4;
                           }
                           current_pixels = *((u32*)(tile_ptr));
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr += (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                           };
                           tile_ptr += 64;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            case 0x3:
            {
               ;
               tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                             vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) + (64 * ((
                                      obj_width - 8) / 8));
               if (obj_x < (s32)start)
               {
                  dest_ptr = scanline + start;
                  pixel_run = obj_width - (start - obj_x);
                  if ((s32)pixel_run > 0)
                  {
                     if ((obj_x + obj_width) >= end)
                     {
                        pixel_run = end - start;
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if ((s32)pixel_run < (s32)partial_tile_run)
                           {
                              if ((s32)pixel_run > 0)
                              {
                                 partial_tile_run = pixel_run;
                                 if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                             partial_tile_offset - 4) * 8);
                                 else
                                 {
                                    current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                    if ((partial_tile_offset + partial_tile_run) > 4)
                                    {
                                       u32 old_run = partial_tile_run;
                                       partial_tile_run = 4 - partial_tile_offset;
                                       for (i = 0; i < partial_tile_run; i++)
                                       {
                                          current_pixel = current_pixels >> 24;
                                          if (current_pixel)
                                             dest_ptr[0] = current_pixel | pixel_combine;  ;
                                          current_pixels <<= 8;
                                          dest_ptr += 1;
                                       };
                                       partial_tile_run = old_run - partial_tile_run;
                                       current_pixels = *((u32*)(tile_ptr));
                                    }
                                 }
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                       dest_ptr[0] = current_pixel | pixel_combine;  ;
                                    current_pixels <<= 8;
                                    dest_ptr += 1;
                                 };;
                              }
                              continue;
                           }
                           else
                           {
                              pixel_run -= partial_tile_run;
                              if (partial_tile_offset >= 4)
                              {
                                 current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                       dest_ptr[0] = current_pixel | pixel_combine;  ;
                                    current_pixels <<= 8;
                                    dest_ptr += 1;
                                 };
                              }
                              else
                              {
                                 partial_tile_run -= 4;
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 for (i = 0; i < partial_tile_run; i++)
                                 {
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                       dest_ptr[0] = current_pixel | pixel_combine;  ;
                                    current_pixels <<= 8;
                                    dest_ptr += 1;
                                 };
                                 current_pixels = *((u32*)tile_ptr);
                                 if (current_pixels != 0)
                                 {
                                    current_pixel = current_pixels & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                                    current_pixel = (current_pixels >> 8) & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                    current_pixel = (current_pixels >> 16) & 0xFF;
                                    if (current_pixel)
                                       dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                    current_pixel = current_pixels >> 24;
                                    if (current_pixel)
                                       dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                                 };
                                 dest_ptr += 4;
                              };
                              tile_ptr -= 64;
                           }
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                           };
                           tile_ptr -= 64;
                           dest_ptr += 8;
                        };
                        partial_tile_run = pixel_run % 8;
                        if (partial_tile_run)
                        {
                           if (partial_tile_run >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                              tile_ptr -= 4;
                              partial_tile_run -= 4;
                           }
                           current_pixels = *((u32*)(tile_ptr + 4));
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = current_pixel | pixel_combine;  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                           };
                        }
                     }
                     else
                     {
                        partial_tile_offset = start - obj_x;
                        tile_ptr -= (partial_tile_offset / 8) * 64;
                        partial_tile_offset %= 8;
                        if (partial_tile_offset)
                        {
                           partial_tile_run = 8 - partial_tile_offset;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = current_pixel | pixel_combine;  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                              };
                              dest_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                        tile_run = pixel_run / 8;
                        for (i = 0; i < tile_run; i++)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                           };
                           tile_ptr -= 64;
                           dest_ptr += 8;
                        };
                     }
                  }
               }
               else if ((obj_x + obj_width) >= end)
               {
                  pixel_run = end - obj_x;
                  if ((s32)pixel_run > 0)
                  {
                     dest_ptr = scanline + obj_x;
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                           };
                           dest_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = current_pixel | pixel_combine;  ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                        };
                     }
                  }
               }
               else
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = obj_width / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 3] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 0] = current_pixel | pixel_combine;  ;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 3] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = current_pixel | pixel_combine;  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = current_pixel | pixel_combine;  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 0] = current_pixel | pixel_combine;  ;
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                  };
               }
            };
            break;
            }
         };
      };
   }
};
static void render_scanline_obj_copy_tile_1D(u32 priority, u32 start, u32 end,
      u16* scanline)
{
   u32 bldcnt = io_registers[REG_BLDCNT];
   u32 dispcnt = io_registers[REG_DISPCNT];
   u32 obj_enable = io_registers[REG_WINOUT] >> 8;
   const tile_layer_render_struct* layer_renderers = tile_mode_renderers[dispcnt &
         0x07];
   u32 copy_start, copy_end;
   u16 copy_buffer[240];
   u16* copy_ptr;
   s32 obj_num, i;
   s32 obj_x, obj_y;
   s32 obj_size;
   s32 obj_width, obj_height;
   u32 obj_attribute_0, obj_attribute_1, obj_attribute_2;
   s32 vcount = io_registers[REG_VCOUNT];
   u32 tile_run;
   u32 current_pixels;
   u32 current_pixel;
   u32 current_palette;
   u32 vertical_offset;
   u32 partial_tile_run, partial_tile_offset;
   u32 pixel_run;
   u16* oam_ptr;
   u16* dest_ptr;
   u8* tile_base = vram + 0x10000;
   u8* tile_ptr;
   u32 obj_count = obj_priority_count[priority][vcount];
   u8* obj_list = obj_priority_list[priority][vcount];
   for (obj_num = 0; obj_num < obj_count; obj_num++)
   {
      oam_ptr = oam_ram + (obj_list[obj_num] * 4);
      obj_attribute_0 = oam_ptr[0];
      obj_attribute_1 = oam_ptr[1];
      obj_attribute_2 = oam_ptr[2];
      obj_size = ((obj_attribute_0 >> 12) & 0x0C) | (obj_attribute_1 >> 14);
      obj_x = (s32)(obj_attribute_1 << 23) >> 23;
      obj_width = obj_width_table[obj_size];
      copy_start = obj_x;
      copy_end = obj_x + obj_width;
      if (obj_attribute_0 & 0x200) copy_end += obj_width;
      if (copy_start < start) copy_start = start;
      if (copy_end > end) copy_end = end;
      if ((copy_start < end) && (copy_end > start))
      {
         render_scanline_conditional_tile(copy_start, copy_end, copy_buffer, obj_enable,
                                          dispcnt, bldcnt, layer_renderers);
         copy_ptr = copy_buffer + copy_start;
      }
      else
         continue;  ;
      obj_y = obj_attribute_0 & 0xFF;
      if (obj_y > 160) obj_y -= 256;
      obj_height = obj_height_table[obj_size];
      if (obj_attribute_0 & 0x100)
      {
         if ((obj_attribute_0 >> 13) & 0x01)
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 8;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y); ;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * (max_x / 8) * 64) + ((vertical_offset % 8) * 8);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 64;
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                           if (current_pixel)
                              dest_ptr[0] = copy_ptr[0];  ;;
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = (max_x / 8) * 64;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                    tile_y & 0x07) * obj_pitch)]; ;
                        if (current_pixel)
                           dest_ptr[0] = copy_ptr[0];  ;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                  };
               }
            };
         }
         else
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 4;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y);
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * (max_x / 8) * 32) + ((vertical_offset % 8) * 4);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 32;
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = (max_x / 8) * 32;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                    tile_y & 0x07) * obj_pitch)];
                        if (tile_x & 0x01) current_pixel >>= 4;
                        else current_pixel &= 0x0F; ;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                  };
               }
            };
         }
      }
      else
      {
         vertical_offset = vcount - obj_y;
         if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                  vertical_offset - 1;
         switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
         {
         case 0x0:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = copy_ptr[0];
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = copy_ptr[0];
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                        tile_ptr += 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = copy_ptr[1];
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = copy_ptr[2];
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = copy_ptr[3];
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = copy_ptr[4];
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = copy_ptr[5];
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = copy_ptr[6];
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = copy_ptr[7];
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        current_pixels >>= 4;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = copy_ptr[0];
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = copy_ptr[1];
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = copy_ptr[2];
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = copy_ptr[3];
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = copy_ptr[4];
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = copy_ptr[5];
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = copy_ptr[6];
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = copy_ptr[7];
                     };
                  };
                  tile_ptr += 32;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         case 0x1:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) +
                       (32 * ((obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = copy_ptr[0];
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = copy_ptr[0];
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                        tile_ptr -= 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = copy_ptr[7];
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = copy_ptr[6];
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = copy_ptr[5];
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = copy_ptr[4];
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = copy_ptr[3];
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = copy_ptr[2];
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = copy_ptr[1];
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        current_pixels <<= 4;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = copy_ptr[7];
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = copy_ptr[6];
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = copy_ptr[5];
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = copy_ptr[4];
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = copy_ptr[3];
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = copy_ptr[2];
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = copy_ptr[1];
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = copy_ptr[0];
                     };
                  };
                  tile_ptr -= 32;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         case 0x2:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4)
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels & 0xFF;
                                       if (current_pixel)
                                          dest_ptr[0] = copy_ptr[0];  ;
                                       current_pixels >>= 8;
                                       dest_ptr += 1;
                                       copy_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr + 4));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                              };
                              dest_ptr += 4;
                              copy_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = copy_ptr[0];  ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                        };
                        tile_ptr += 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        };
                        dest_ptr += 4;
                        copy_ptr += 4;
                        tile_ptr += 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = copy_ptr[0];  ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                  };
                  tile_ptr += 64;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         case 0x3:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) +
                       (64 * ((obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                          partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels >> 24;
                                       if (current_pixel)
                                          dest_ptr[0] = copy_ptr[0];  ;
                                       current_pixels <<= 8;
                                       dest_ptr += 1;
                                       copy_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                              };
                              dest_ptr += 4;
                              copy_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = copy_ptr[0];  ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                        };
                        tile_ptr -= 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        };
                        dest_ptr += 4;
                        copy_ptr += 4;
                        tile_ptr -= 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr + 4));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = copy_ptr[0];  ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                  };
                  tile_ptr -= 64;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         }
      };
   }
};
static void render_scanline_obj_copy_tile_2D(u32 priority, u32 start, u32 end,
      u16* scanline)
{
   u32 bldcnt = io_registers[REG_BLDCNT];
   u32 dispcnt = io_registers[REG_DISPCNT];
   u32 obj_enable = io_registers[REG_WINOUT] >> 8;
   const tile_layer_render_struct* layer_renderers = tile_mode_renderers[dispcnt &
         0x07];
   u32 copy_start, copy_end;
   u16 copy_buffer[240];
   u16* copy_ptr;
   s32 obj_num, i;
   s32 obj_x, obj_y;
   s32 obj_size;
   s32 obj_width, obj_height;
   u32 obj_attribute_0, obj_attribute_1, obj_attribute_2;
   s32 vcount = io_registers[REG_VCOUNT];
   u32 tile_run;
   u32 current_pixels;
   u32 current_pixel;
   u32 current_palette;
   u32 vertical_offset;
   u32 partial_tile_run, partial_tile_offset;
   u32 pixel_run;
   u16* oam_ptr;
   u16* dest_ptr;
   u8* tile_base = vram + 0x10000;
   u8* tile_ptr;
   u32 obj_count = obj_priority_count[priority][vcount];
   u8* obj_list = obj_priority_list[priority][vcount];
   for (obj_num = 0; obj_num < obj_count; obj_num++)
   {
      oam_ptr = oam_ram + (obj_list[obj_num] * 4);
      obj_attribute_0 = oam_ptr[0];
      obj_attribute_1 = oam_ptr[1];
      obj_attribute_2 = oam_ptr[2];
      obj_size = ((obj_attribute_0 >> 12) & 0x0C) | (obj_attribute_1 >> 14);
      obj_x = (s32)(obj_attribute_1 << 23) >> 23;
      obj_width = obj_width_table[obj_size];
      copy_start = obj_x;
      copy_end = obj_x + obj_width;
      if (obj_attribute_0 & 0x200) copy_end += obj_width;
      if (copy_start < start) copy_start = start;
      if (copy_end > end) copy_end = end;
      if ((copy_start < end) && (copy_end > start))
      {
         render_scanline_conditional_tile(copy_start, copy_end, copy_buffer, obj_enable,
                                          dispcnt, bldcnt, layer_renderers);
         copy_ptr = copy_buffer + copy_start;
      }
      else
         continue;  ;
      obj_y = obj_attribute_0 & 0xFF;
      if (obj_y > 160) obj_y -= 256;
      obj_height = obj_height_table[obj_size];
      if (obj_attribute_0 & 0x100)
      {
         if ((obj_attribute_0 >> 13) & 0x01)
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 8;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y); ;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 64;
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                           if (current_pixel)
                              dest_ptr[0] = copy_ptr[0];  ;;
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = 1024;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                    tile_y & 0x07) * obj_pitch)]; ;
                        if (current_pixel)
                           dest_ptr[0] = copy_ptr[0];  ;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                  };
               }
            };
         }
         else
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 4;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y);
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 32;
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = 1024;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                    tile_y & 0x07) * obj_pitch)];
                        if (tile_x & 0x01) current_pixel >>= 4;
                        else current_pixel &= 0x0F; ;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                  };
               }
            };
         }
      }
      else
      {
         vertical_offset = vcount - obj_y;
         if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                  vertical_offset - 1;
         switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
         {
         case 0x0:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = copy_ptr[0];
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = copy_ptr[0];
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                        tile_ptr += 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = copy_ptr[1];
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = copy_ptr[2];
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = copy_ptr[3];
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = copy_ptr[4];
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = copy_ptr[5];
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = copy_ptr[6];
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = copy_ptr[7];
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        current_pixels >>= 4;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = copy_ptr[0];
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = copy_ptr[1];
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = copy_ptr[2];
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = copy_ptr[3];
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = copy_ptr[4];
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = copy_ptr[5];
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = copy_ptr[6];
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = copy_ptr[7];
                     };
                  };
                  tile_ptr += 32;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         case 0x1:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) + (32 * ((
                                   obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = copy_ptr[0];
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = copy_ptr[0];
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                        tile_ptr -= 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = copy_ptr[7];
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = copy_ptr[6];
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = copy_ptr[5];
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = copy_ptr[4];
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = copy_ptr[3];
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = copy_ptr[2];
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = copy_ptr[1];
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        current_pixels <<= 4;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = copy_ptr[7];
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = copy_ptr[6];
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = copy_ptr[5];
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = copy_ptr[4];
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = copy_ptr[3];
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = copy_ptr[2];
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = copy_ptr[1];
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = copy_ptr[0];
                     };
                  };
                  tile_ptr -= 32;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         case 0x2:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4)
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels & 0xFF;
                                       if (current_pixel)
                                          dest_ptr[0] = copy_ptr[0];  ;
                                       current_pixels >>= 8;
                                       dest_ptr += 1;
                                       copy_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr + 4));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                              };
                              dest_ptr += 4;
                              copy_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = copy_ptr[0];  ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                        };
                        tile_ptr += 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        };
                        dest_ptr += 4;
                        copy_ptr += 4;
                        tile_ptr += 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = copy_ptr[0];  ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                  };
                  tile_ptr += 64;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         case 0x3:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) + (64 * ((
                                   obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                          partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels >> 24;
                                       if (current_pixel)
                                          dest_ptr[0] = copy_ptr[0];  ;
                                       current_pixels <<= 8;
                                       dest_ptr += 1;
                                       copy_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                              };
                              dest_ptr += 4;
                              copy_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = copy_ptr[0];  ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                        };
                        tile_ptr -= 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        };
                        dest_ptr += 4;
                        copy_ptr += 4;
                        tile_ptr -= 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr + 4));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = copy_ptr[0];  ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                  };
                  tile_ptr -= 64;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         }
      };
   }
};
static void render_scanline_obj_copy_bitmap_1D(u32 priority, u32 start, u32 end,
      u16* scanline)
{
   u32 bldcnt = io_registers[REG_BLDCNT];
   u32 dispcnt = io_registers[REG_DISPCNT];
   u32 obj_enable = io_registers[REG_WINOUT] >> 8;
   const bitmap_layer_render_struct* layer_renderers = bitmap_mode_renderers + ((
            dispcnt & 0x07) - 3);
   u32 copy_start, copy_end;
   u16 copy_buffer[240];
   u16* copy_ptr;
   s32 obj_num, i;
   s32 obj_x, obj_y;
   s32 obj_size;
   s32 obj_width, obj_height;
   u32 obj_attribute_0, obj_attribute_1, obj_attribute_2;
   s32 vcount = io_registers[REG_VCOUNT];
   u32 tile_run;
   u32 current_pixels;
   u32 current_pixel;
   u32 current_palette;
   u32 vertical_offset;
   u32 partial_tile_run, partial_tile_offset;
   u32 pixel_run;
   u16* oam_ptr;
   u16* dest_ptr;
   u8* tile_base = vram + 0x10000;
   u8* tile_ptr;
   u32 obj_count = obj_priority_count[priority][vcount];
   u8* obj_list = obj_priority_list[priority][vcount];
   for (obj_num = 0; obj_num < obj_count; obj_num++)
   {
      oam_ptr = oam_ram + (obj_list[obj_num] * 4);
      obj_attribute_0 = oam_ptr[0];
      obj_attribute_1 = oam_ptr[1];
      obj_attribute_2 = oam_ptr[2];
      obj_size = ((obj_attribute_0 >> 12) & 0x0C) | (obj_attribute_1 >> 14);
      obj_x = (s32)(obj_attribute_1 << 23) >> 23;
      obj_width = obj_width_table[obj_size];
      copy_start = obj_x;
      copy_end = obj_x + obj_width;
      if (obj_attribute_0 & 0x200) copy_end += obj_width;
      if (copy_start < start) copy_start = start;
      if (copy_end > end) copy_end = end;
      if ((copy_start < end) && (copy_end > start))
      {
         render_scanline_conditional_bitmap(copy_start, copy_end, copy_buffer,
                                            obj_enable, dispcnt, bldcnt, layer_renderers);
         copy_ptr = copy_buffer + copy_start;
      }
      else
         continue;  ;
      obj_y = obj_attribute_0 & 0xFF;
      if (obj_y > 160) obj_y -= 256;
      obj_height = obj_height_table[obj_size];
      if (obj_attribute_0 & 0x100)
      {
         if ((obj_attribute_0 >> 13) & 0x01)
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 8;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y); ;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * (max_x / 8) * 64) + ((vertical_offset % 8) * 8);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 64;
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                           if (current_pixel)
                              dest_ptr[0] = copy_ptr[0];  ;;
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = (max_x / 8) * 64;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                    tile_y & 0x07) * obj_pitch)]; ;
                        if (current_pixel)
                           dest_ptr[0] = copy_ptr[0];  ;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                  };
               }
            };
         }
         else
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 4;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y);
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * (max_x / 8) * 32) + ((vertical_offset % 8) * 4);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 32;
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = (max_x / 8) * 32;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                    tile_y & 0x07) * obj_pitch)];
                        if (tile_x & 0x01) current_pixel >>= 4;
                        else current_pixel &= 0x0F; ;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                  };
               }
            };
         }
      }
      else
      {
         vertical_offset = vcount - obj_y;
         if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                  vertical_offset - 1;
         switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
         {
         case 0x0:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = copy_ptr[0];
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = copy_ptr[0];
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                        tile_ptr += 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = copy_ptr[1];
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = copy_ptr[2];
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = copy_ptr[3];
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = copy_ptr[4];
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = copy_ptr[5];
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = copy_ptr[6];
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = copy_ptr[7];
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        current_pixels >>= 4;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = copy_ptr[0];
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = copy_ptr[1];
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = copy_ptr[2];
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = copy_ptr[3];
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = copy_ptr[4];
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = copy_ptr[5];
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = copy_ptr[6];
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = copy_ptr[7];
                     };
                  };
                  tile_ptr += 32;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         case 0x1:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 32) + ((vertical_offset % 8) * 4) +
                       (32 * ((obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = copy_ptr[0];
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = copy_ptr[0];
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                        tile_ptr -= 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = copy_ptr[7];
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = copy_ptr[6];
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = copy_ptr[5];
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = copy_ptr[4];
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = copy_ptr[3];
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = copy_ptr[2];
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = copy_ptr[1];
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        current_pixels <<= 4;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = copy_ptr[7];
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = copy_ptr[6];
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = copy_ptr[5];
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = copy_ptr[4];
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = copy_ptr[3];
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = copy_ptr[2];
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = copy_ptr[1];
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = copy_ptr[0];
                     };
                  };
                  tile_ptr -= 32;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         case 0x2:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4)
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels & 0xFF;
                                       if (current_pixel)
                                          dest_ptr[0] = copy_ptr[0];  ;
                                       current_pixels >>= 8;
                                       dest_ptr += 1;
                                       copy_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr + 4));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                              };
                              dest_ptr += 4;
                              copy_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = copy_ptr[0];  ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                        };
                        tile_ptr += 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        };
                        dest_ptr += 4;
                        copy_ptr += 4;
                        tile_ptr += 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = copy_ptr[0];  ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                  };
                  tile_ptr += 64;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         case 0x3:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * (obj_width / 8) * 64) + ((vertical_offset % 8) * 8) +
                       (64 * ((obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                          partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels >> 24;
                                       if (current_pixel)
                                          dest_ptr[0] = copy_ptr[0];  ;
                                       current_pixels <<= 8;
                                       dest_ptr += 1;
                                       copy_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                              };
                              dest_ptr += 4;
                              copy_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = copy_ptr[0];  ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                        };
                        tile_ptr -= 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        };
                        dest_ptr += 4;
                        copy_ptr += 4;
                        tile_ptr -= 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr + 4));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = copy_ptr[0];  ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                  };
                  tile_ptr -= 64;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         }
      };
   }
};
static void render_scanline_obj_copy_bitmap_2D(u32 priority, u32 start, u32 end,
      u16* scanline)
{
   u32 bldcnt = io_registers[REG_BLDCNT];
   u32 dispcnt = io_registers[REG_DISPCNT];
   u32 obj_enable = io_registers[REG_WINOUT] >> 8;
   const bitmap_layer_render_struct* layer_renderers = bitmap_mode_renderers + ((
            dispcnt & 0x07) - 3);
   u32 copy_start, copy_end;
   u16 copy_buffer[240];
   u16* copy_ptr;
   s32 obj_num, i;
   s32 obj_x, obj_y;
   s32 obj_size;
   s32 obj_width, obj_height;
   u32 obj_attribute_0, obj_attribute_1, obj_attribute_2;
   s32 vcount = io_registers[REG_VCOUNT];
   u32 tile_run;
   u32 current_pixels;
   u32 current_pixel;
   u32 current_palette;
   u32 vertical_offset;
   u32 partial_tile_run, partial_tile_offset;
   u32 pixel_run;
   u16* oam_ptr;
   u16* dest_ptr;
   u8* tile_base = vram + 0x10000;
   u8* tile_ptr;
   u32 obj_count = obj_priority_count[priority][vcount];
   u8* obj_list = obj_priority_list[priority][vcount];
   for (obj_num = 0; obj_num < obj_count; obj_num++)
   {
      oam_ptr = oam_ram + (obj_list[obj_num] * 4);
      obj_attribute_0 = oam_ptr[0];
      obj_attribute_1 = oam_ptr[1];
      obj_attribute_2 = oam_ptr[2];
      obj_size = ((obj_attribute_0 >> 12) & 0x0C) | (obj_attribute_1 >> 14);
      obj_x = (s32)(obj_attribute_1 << 23) >> 23;
      obj_width = obj_width_table[obj_size];
      copy_start = obj_x;
      copy_end = obj_x + obj_width;
      if (obj_attribute_0 & 0x200) copy_end += obj_width;
      if (copy_start < start) copy_start = start;
      if (copy_end > end) copy_end = end;
      if ((copy_start < end) && (copy_end > start))
      {
         render_scanline_conditional_bitmap(copy_start, copy_end, copy_buffer,
                                            obj_enable, dispcnt, bldcnt, layer_renderers);
         copy_ptr = copy_buffer + copy_start;
      }
      else
         continue;  ;
      obj_y = obj_attribute_0 & 0xFF;
      if (obj_y > 160) obj_y -= 256;
      obj_height = obj_height_table[obj_size];
      if (obj_attribute_0 & 0x100)
      {
         if ((obj_attribute_0 >> 13) & 0x01)
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 8;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y); ;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 64;
                           current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07)]; ;
                           if (current_pixel)
                              dest_ptr[0] = copy_ptr[0];  ;;
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = 1024;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 64) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + (tile_x & 0x07) + ((
                                                    tile_y & 0x07) * obj_pitch)]; ;
                        if (current_pixel)
                           dest_ptr[0] = copy_ptr[0];  ;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                  };
               }
            };
         }
         else
         {
            {
               s16* params = (s16*)oam_ram + (((obj_attribute_1 >> 9) & 0x1F) * 16);
               s32 dx = params[3];
               s32 dmx = params[7];
               s32 dy = params[11];
               s32 dmy = params[15];
               s32 source_x, source_y;
               s32 tile_x, tile_y;
               u32 tile_map_offset;
               s32 middle_x;
               s32 middle_y;
               s32 max_x = obj_width;
               s32 max_y = obj_height;
               s32 y_delta;
               u32 obj_pitch = 4;
               u32 obj_tile_pitch;
               middle_x = (obj_width / 2);
               middle_y = (obj_height / 2);
               source_x = (middle_x << 8);
               source_y = (middle_y << 8);
               if (obj_attribute_0 & 0x200)
               {
                  obj_width *= 2;
                  obj_height *= 2;
                  middle_x *= 2;
                  middle_y *= 2;
               }
               if ((s32)obj_x < (s32)start)
               {
                  u32 x_delta = start - obj_x;
                  middle_x -= x_delta;
                  obj_width -= x_delta;
                  obj_x = start;
                  if ((s32)obj_width <= 0) continue;
               }
               if ((s32)(obj_x + obj_width) >= (s32)end)
               {
                  obj_width = end - obj_x;
                  if ((s32)obj_width <= 0) continue;
               }
               dest_ptr = scanline + obj_x;
               y_delta = vcount - (obj_y + middle_y);
               current_palette = (obj_attribute_2 >> 8) & 0xF0;
               if (dy == 0)
               {
                  {
                     u32 vertical_offset;
                     source_y += (y_delta * dmy);
                     vertical_offset = (source_y >> 8);
                     if ((u32)vertical_offset < (u32)max_y)
                     {
                        tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                                      vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4);
                        source_x += (y_delta * dmx) - (middle_x * dx);
                        for (i = 0; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x < (u32)max_x) break;
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                        for (; i < obj_width; i++)
                        {
                           tile_x = (source_x >> 8);
                           if ((u32)tile_x >= (u32)max_x) break;
                           tile_map_offset = (tile_x >> 3) * 32;
                           current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03)];
                           if (tile_x & 0x01) current_pixel >>= 4;
                           else current_pixel &= 0x0F; ;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           source_x += dx;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        }
                     }
                  };
               }
               else
               {
                  {
                     tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32);
                     obj_tile_pitch = 1024;
                     source_x += (y_delta * dmx) - (middle_x * dx);
                     source_y += (y_delta * dmy) - (middle_x * dy);
                     for (i = 0; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x < (u32)max_x) && ((u32)tile_y < (u32)max_y)) break;
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                     for (; i < obj_width; i++)
                     {
                        tile_x = (source_x >> 8);
                        tile_y = (source_y >> 8);
                        if (((u32)tile_x >= (u32)max_x) || ((u32)tile_y >= (u32)max_y)) break;
                        tile_map_offset = ((tile_x >> 3) * 32) + ((tile_y >> 3) * obj_tile_pitch);
                        current_pixel = tile_ptr[tile_map_offset + ((tile_x >> 1) & 0x03) + ((
                                                    tile_y & 0x07) * obj_pitch)];
                        if (tile_x & 0x01) current_pixel >>= 4;
                        else current_pixel &= 0x0F; ;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        source_x += dx;
                        source_y += dy;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     }
                  };
               }
            };
         }
      }
      else
      {
         vertical_offset = vcount - obj_y;
         if ((obj_attribute_1 >> 13) & 0x01) vertical_offset = obj_height -
                  vertical_offset - 1;
         switch (((obj_attribute_0 >> 12) & 0x02) | ((obj_attribute_1 >> 12) & 0x01))
         {
         case 0x0:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0x0F;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = copy_ptr[0];
                                 };
                                 current_pixels >>= 4;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0x0F;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = copy_ptr[0];
                              };
                              current_pixels >>= 4;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           tile_ptr += 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels >>= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                        tile_ptr += 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                        };
                        tile_ptr += 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = copy_ptr[1];
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = copy_ptr[2];
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = copy_ptr[3];
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = copy_ptr[4];
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = copy_ptr[5];
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = copy_ptr[6];
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = copy_ptr[7];
                        };
                     };
                     tile_ptr += 32;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        current_pixels >>= 4;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = copy_ptr[0];
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = copy_ptr[1];
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = copy_ptr[2];
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = copy_ptr[3];
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = copy_ptr[4];
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = copy_ptr[5];
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = copy_ptr[6];
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = copy_ptr[7];
                     };
                  };
                  tile_ptr += 32;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         case 0x1:
         {
            current_palette = (obj_attribute_2 >> 8) & 0xF0;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 4) + (32 * ((
                                   obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 28;
                                 if (current_pixel)
                                 {
                                    current_pixel |= current_palette;
                                    dest_ptr[0] = copy_ptr[0];
                                 };
                                 current_pixels <<= 4;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 28;
                              if (current_pixel)
                              {
                                 current_pixel |= current_palette;
                                 dest_ptr[0] = copy_ptr[0];
                              };
                              current_pixels <<= 4;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           tile_ptr -= 32;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 32;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        current_pixels = *((u32*)tile_ptr) << (partial_tile_offset * 4);
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                           current_pixels <<= 4;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                        tile_ptr -= 32;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[7] = copy_ptr[7];
                           };
                           current_pixel = (current_pixels >> 4) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[6] = copy_ptr[6];
                           };
                           current_pixel = (current_pixels >> 8) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[5] = copy_ptr[5];
                           };
                           current_pixel = (current_pixels >> 12) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[4] = copy_ptr[4];
                           };
                           current_pixel = (current_pixels >> 16) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[3] = copy_ptr[3];
                           };
                           current_pixel = (current_pixels >> 20) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[2] = copy_ptr[2];
                           };
                           current_pixel = (current_pixels >> 24) & 0x0F;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[1] = copy_ptr[1];
                           };
                           current_pixel = current_pixels >> 28;
                           if (current_pixel)
                           {
                              current_pixel |= current_palette;
                              dest_ptr[0] = copy_ptr[0];
                           };
                        };
                        tile_ptr -= 32;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[7] = copy_ptr[7];
                        };
                        current_pixel = (current_pixels >> 4) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[6] = copy_ptr[6];
                        };
                        current_pixel = (current_pixels >> 8) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[5] = copy_ptr[5];
                        };
                        current_pixel = (current_pixels >> 12) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[4] = copy_ptr[4];
                        };
                        current_pixel = (current_pixels >> 16) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[3] = copy_ptr[3];
                        };
                        current_pixel = (current_pixels >> 20) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[2] = copy_ptr[2];
                        };
                        current_pixel = (current_pixels >> 24) & 0x0F;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[1] = copy_ptr[1];
                        };
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                     };
                     tile_ptr -= 32;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 28;
                        if (current_pixel)
                        {
                           current_pixel |= current_palette;
                           dest_ptr[0] = copy_ptr[0];
                        };
                        current_pixels <<= 4;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[7] = copy_ptr[7];
                     };
                     current_pixel = (current_pixels >> 4) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[6] = copy_ptr[6];
                     };
                     current_pixel = (current_pixels >> 8) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[5] = copy_ptr[5];
                     };
                     current_pixel = (current_pixels >> 12) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[4] = copy_ptr[4];
                     };
                     current_pixel = (current_pixels >> 16) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[3] = copy_ptr[3];
                     };
                     current_pixel = (current_pixels >> 20) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[2] = copy_ptr[2];
                     };
                     current_pixel = (current_pixels >> 24) & 0x0F;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[1] = copy_ptr[1];
                     };
                     current_pixel = current_pixels >> 28;
                     if (current_pixel)
                     {
                        current_pixel |= current_palette;
                        dest_ptr[0] = copy_ptr[0];
                     };
                  };
                  tile_ptr -= 32;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         case 0x2:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) ;
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4)
                                 current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels & 0xFF;
                                       if (current_pixel)
                                          dest_ptr[0] = copy_ptr[0];  ;
                                       current_pixels >>= 8;
                                       dest_ptr += 1;
                                       copy_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr + 4));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels >>= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                              current_pixels = *((u32*)(tile_ptr + 4));
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                              };
                              dest_ptr += 4;
                              copy_ptr += 4;
                           };
                           tile_ptr += 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                           tile_ptr += 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0] = copy_ptr[0];  ;
                           current_pixels >>= 8;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr += (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4)) >> ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)tile_ptr) >> (partial_tile_offset * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels >>= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                        };
                        tile_ptr += 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        };
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                        };
                        tile_ptr += 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                     };
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                     };
                     tile_ptr += 64;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        };
                        dest_ptr += 4;
                        copy_ptr += 4;
                        tile_ptr += 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0] = copy_ptr[0];  ;
                        current_pixels >>= 8;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                  };
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                  };
                  tile_ptr += 64;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         case 0x3:
         {
            ;
            tile_ptr = tile_base + ((obj_attribute_2 & 0x3FF) * 32) + ((
                          vertical_offset / 8) * 1024) + ((vertical_offset % 8) * 8) + (64 * ((
                                   obj_width - 8) / 8));
            if (obj_x < (s32)start)
            {
               dest_ptr = scanline + start;
               pixel_run = obj_width - (start - obj_x);
               if ((s32)pixel_run > 0)
               {
                  if ((obj_x + obj_width) >= end)
                  {
                     pixel_run = end - start;
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if ((s32)pixel_run < (s32)partial_tile_run)
                        {
                           if ((s32)pixel_run > 0)
                           {
                              partial_tile_run = pixel_run;
                              if (partial_tile_offset >= 4) current_pixels = *((u32*)tile_ptr) << ((
                                          partial_tile_offset - 4) * 8);
                              else
                              {
                                 current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                                 if ((partial_tile_offset + partial_tile_run) > 4)
                                 {
                                    u32 old_run = partial_tile_run;
                                    partial_tile_run = 4 - partial_tile_offset;
                                    for (i = 0; i < partial_tile_run; i++)
                                    {
                                       current_pixel = current_pixels >> 24;
                                       if (current_pixel)
                                          dest_ptr[0] = copy_ptr[0];  ;
                                       current_pixels <<= 8;
                                       dest_ptr += 1;
                                       copy_ptr += 1;
                                    };
                                    partial_tile_run = old_run - partial_tile_run;
                                    current_pixels = *((u32*)(tile_ptr));
                                 }
                              }
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };;
                           }
                           continue;
                        }
                        else
                        {
                           pixel_run -= partial_tile_run;
                           if (partial_tile_offset >= 4)
                           {
                              current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                           }
                           else
                           {
                              partial_tile_run -= 4;
                              current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                              for (i = 0; i < partial_tile_run; i++)
                              {
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0] = copy_ptr[0];  ;
                                 current_pixels <<= 8;
                                 dest_ptr += 1;
                                 copy_ptr += 1;
                              };
                              current_pixels = *((u32*)tile_ptr);
                              if (current_pixels != 0)
                              {
                                 current_pixel = current_pixels & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                                 current_pixel = (current_pixels >> 8) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                                 current_pixel = (current_pixels >> 16) & 0xFF;
                                 if (current_pixel)
                                    dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                                 current_pixel = current_pixels >> 24;
                                 if (current_pixel)
                                    dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                              };
                              dest_ptr += 4;
                              copy_ptr += 4;
                           };
                           tile_ptr -= 64;
                        }
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                     partial_tile_run = pixel_run % 8;
                     if (partial_tile_run)
                     {
                        if (partial_tile_run >= 4)
                        {
                           current_pixels = *((u32*)(tile_ptr + 4));
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                           tile_ptr -= 4;
                           partial_tile_run -= 4;
                        }
                        current_pixels = *((u32*)(tile_ptr + 4));
                        for (i = 0; i < partial_tile_run; i++)
                        {
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0] = copy_ptr[0];  ;
                           current_pixels <<= 8;
                           dest_ptr += 1;
                           copy_ptr += 1;
                        };
                     }
                  }
                  else
                  {
                     partial_tile_offset = start - obj_x;
                     tile_ptr -= (partial_tile_offset / 8) * 64;
                     partial_tile_offset %= 8;
                     if (partial_tile_offset)
                     {
                        partial_tile_run = 8 - partial_tile_offset;
                        if (partial_tile_offset >= 4)
                        {
                           current_pixels = *((u32*)tile_ptr) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                        }
                        else
                        {
                           partial_tile_run -= 4;
                           current_pixels = *((u32*)(tile_ptr + 4)) << ((partial_tile_offset - 4) * 8);
                           for (i = 0; i < partial_tile_run; i++)
                           {
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0] = copy_ptr[0];  ;
                              current_pixels <<= 8;
                              dest_ptr += 1;
                              copy_ptr += 1;
                           };
                           current_pixels = *((u32*)tile_ptr);
                           if (current_pixels != 0)
                           {
                              current_pixel = current_pixels & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                              current_pixel = (current_pixels >> 8) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                              current_pixel = (current_pixels >> 16) & 0xFF;
                              if (current_pixel)
                                 dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                              current_pixel = current_pixels >> 24;
                              if (current_pixel)
                                 dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                           };
                           dest_ptr += 4;
                           copy_ptr += 4;
                        };
                        tile_ptr -= 64;
                     }
                     tile_run = pixel_run / 8;
                     for (i = 0; i < tile_run; i++)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        };
                        current_pixels = *((u32*)tile_ptr);
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                        };
                        tile_ptr -= 64;
                        dest_ptr += 8;
                        copy_ptr += 8;
                     };
                  }
               }
            }
            else if ((obj_x + obj_width) >= end)
            {
               pixel_run = end - obj_x;
               if ((s32)pixel_run > 0)
               {
                  dest_ptr = scanline + obj_x;
                  tile_run = pixel_run / 8;
                  for (i = 0; i < tile_run; i++)
                  {
                     current_pixels = *((u32*)(tile_ptr + 4));
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                     };
                     current_pixels = *((u32*)tile_ptr);
                     if (current_pixels != 0)
                     {
                        current_pixel = current_pixels & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                        current_pixel = (current_pixels >> 8) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                        current_pixel = (current_pixels >> 16) & 0xFF;
                        if (current_pixel)
                           dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                     };
                     tile_ptr -= 64;
                     dest_ptr += 8;
                     copy_ptr += 8;
                  };
                  partial_tile_run = pixel_run % 8;
                  if (partial_tile_run)
                  {
                     if (partial_tile_run >= 4)
                     {
                        current_pixels = *((u32*)(tile_ptr + 4));
                        if (current_pixels != 0)
                        {
                           current_pixel = current_pixels & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                           current_pixel = (current_pixels >> 8) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                           current_pixel = (current_pixels >> 16) & 0xFF;
                           if (current_pixel)
                              dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                           current_pixel = current_pixels >> 24;
                           if (current_pixel)
                              dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                        };
                        dest_ptr += 4;
                        copy_ptr += 4;
                        tile_ptr -= 4;
                        partial_tile_run -= 4;
                     }
                     current_pixels = *((u32*)(tile_ptr + 4));
                     for (i = 0; i < partial_tile_run; i++)
                     {
                        current_pixel = current_pixels >> 24;
                        if (current_pixel)
                           dest_ptr[0] = copy_ptr[0];  ;
                        current_pixels <<= 8;
                        dest_ptr += 1;
                        copy_ptr += 1;
                     };
                  }
               }
            }
            else
            {
               dest_ptr = scanline + obj_x;
               tile_run = obj_width / 8;
               for (i = 0; i < tile_run; i++)
               {
                  current_pixels = *((u32*)(tile_ptr + 4));
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 3] = copy_ptr[0 + 3];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 2] = copy_ptr[0 + 2];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[0 + 1] = copy_ptr[0 + 1];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[0 + 0] = copy_ptr[0 + 0];  ;
                  };
                  current_pixels = *((u32*)tile_ptr);
                  if (current_pixels != 0)
                  {
                     current_pixel = current_pixels & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 3] = copy_ptr[4 + 3];  ;
                     current_pixel = (current_pixels >> 8) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 2] = copy_ptr[4 + 2];  ;
                     current_pixel = (current_pixels >> 16) & 0xFF;
                     if (current_pixel)
                        dest_ptr[4 + 1] = copy_ptr[4 + 1];  ;
                     current_pixel = current_pixels >> 24;
                     if (current_pixel)
                        dest_ptr[4 + 0] = copy_ptr[4 + 0];  ;
                  };
                  tile_ptr -= 64;
                  dest_ptr += 8;
                  copy_ptr += 8;
               };
            }
         };
         break;
         }
      };
   }
};



static void order_obj(u32 video_mode)
{
   s32 obj_num, priority, row;
   s32 obj_x, obj_y;
   s32 obj_size, obj_mode;
   s32 obj_width, obj_height;
   u32 obj_priority;
   u32 obj_attribute_0, obj_attribute_1, obj_attribute_2;
   u32 current_count;
   u16* oam_ptr = oam_ram + 508;
   
   for (priority = 0; priority < 5; priority++)
   {
      for (row = 0; row < 160; row++)
         obj_priority_count[priority][row] = 0;
   }
   
   for (row = 0; row < 160; row++)
      obj_alpha_count[row] = 0;
      
   for (obj_num = 127; obj_num >= 0; obj_num--, oam_ptr -= 4)
   {
      obj_attribute_0 = oam_ptr[0];
      obj_attribute_2 = oam_ptr[2];
      obj_size = obj_attribute_0 & 0xC000;
      obj_priority = (obj_attribute_2 >> 10) & 0x03;
      obj_mode = (obj_attribute_0 >> 10) & 0x03;
      
      if (((obj_attribute_0 & 0x0300) != 0x0200) && (obj_size != 0xC000) &&
            (obj_mode != 3) && ((video_mode < 3) ||
                                ((obj_attribute_2 & 0x3FF) >= 512)))
      {
         obj_y = obj_attribute_0 & 0xFF;
         if (obj_y > 160)
            obj_y -= 256;
            
         obj_attribute_1 = oam_ptr[1];
         obj_size = ((obj_size >> 12) & 0x0C) | (obj_attribute_1 >> 14);
         obj_height = obj_height_table[obj_size];
         obj_width = obj_width_table[obj_size];
         
         if (obj_attribute_0 & 0x200)
         {
            obj_height *= 2;
            obj_width *= 2;
         }
         
         if (((obj_y + obj_height) > 0) && (obj_y < 160))
         {
            obj_x = (s32)(obj_attribute_1 << 23) >> 23;
            
            if (((obj_x + obj_width) > 0) && (obj_x < 240))
            {
               if (obj_y < 0)
               {
                  obj_height += obj_y;
                  obj_y = 0;
               }
               
               if ((obj_y + obj_height) >= 160)
                  obj_height = 160 - obj_y;
                  
               if (obj_mode == 1)
               {
                  for (row = obj_y; row < obj_y + obj_height; row++)
                  {
                     current_count = obj_priority_count[obj_priority][row];
                     obj_priority_list[obj_priority][row][current_count] = obj_num;
                     obj_priority_count[obj_priority][row] = current_count + 1;
                     obj_alpha_count[row]++;
                  }
               }
               else
               {
                  if (obj_mode == 2)
                     obj_priority = 4;
                     
                  for (row = obj_y; row < obj_y + obj_height; row++)
                  {
                     current_count = obj_priority_count[obj_priority][row];
                     obj_priority_list[obj_priority][row][current_count] = obj_num;
                     obj_priority_count[obj_priority][row] = current_count + 1;
                  }
               }
            }
         }
      }
   }
}

u32 layer_order[16];
u32 layer_count;

static void order_layers(u32 layer_flags)
{
   s32 priority, layer_number;
   layer_count = 0;
   
   for (priority = 3; priority >= 0; priority--)
   {
      for (layer_number = 3; layer_number >= 0; layer_number--)
      {
         if (((layer_flags >> layer_number) & 1) &&
               ((io_registers[REG_BG0CNT + layer_number] & 0x03) == priority))
         {
            layer_order[layer_count] = layer_number;
            layer_count++;
         }
      }
      
      if ((obj_priority_count[priority][io_registers[REG_VCOUNT]] > 0)
            && (layer_flags & 0x10))
      {
         layer_order[layer_count] = priority | 0x04;
         layer_count++;
      }
   }
}

static void fill_line_normal(u16 color, u16* dest_ptr, u32 start, u32 end)
{
   color = palette_ram_converted[color];
   u32 i;
   for (i = start; i < end; i++) dest_ptr[i] = color;;
};
static void fill_line_alpha(u16 color, u32* dest_ptr, u32 start, u32 end)
{
   ;
   u32 i;
   for (i = start; i < end; i++) dest_ptr[i] = color;;
};
static void fill_line_color16(u16 color, u16* dest_ptr, u32 start, u32 end)
{
   ;
   u32 i;
   for (i = start; i < end; i++) dest_ptr[i] = color;;
};
static void fill_line_color32(u16 color, u32* dest_ptr, u32 start, u32 end)
{
   ;
   u32 i;
   for (i = start; i < end; i++) dest_ptr[i] = color;;
};

void expand_blend(u32* screen_src_ptr, u16* screen_dest_ptr,
                  u32 start, u32 end);



void expand_blend(u32* screen_src_ptr, u16* screen_dest_ptr,
                  u32 start, u32 end)
{
   u32 pixel_pair;
   u32 pixel_top, pixel_bottom;
   u32 bldalpha = io_registers[REG_BLDALPHA];
   u32 blend_a = bldalpha & 0x1F;
   u32 blend_b = (bldalpha >> 8) & 0x1F;
   u32 i;
   
   if (blend_a > 16)
      blend_a = 16;
      
   if (blend_b > 16)
      blend_b = 16;
      
      
      
   if ((blend_a + blend_b) > 16)
   {
      screen_src_ptr += start;
      screen_dest_ptr += start;
      end -= start;
      for (i = 0; i < end; i++)
      {
         pixel_pair = *screen_src_ptr;
         if (((pixel_pair & 0x04000200) == 0x04000200))
         {
            pixel_top = palette_ram_converted[pixel_pair & 0x1FF];
            pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
            pixel_bottom = palette_ram_converted[(pixel_pair >> 16) & 0x1FF];
            pixel_bottom = (pixel_bottom | (pixel_bottom << 16)) & 0x07E0F81F;
            pixel_top = ((pixel_top * blend_a) + (pixel_bottom * blend_b)) >> 4;
            if (pixel_top & 0x08010020)
            {
               if (pixel_top & 0x08000000) pixel_top |= 0x07E00000;
               if (pixel_top & 0x00010000) pixel_top |= 0x0000F800;
               if (pixel_top & 0x00000020) pixel_top |= 0x0000001F;
            };
            pixel_top &= 0x07E0F81F;
            pixel_top = (pixel_top >> 16) | pixel_top;
            *screen_dest_ptr = pixel_top;
         }
         else
            *screen_dest_ptr = palette_ram_converted[pixel_pair & 0x1FF];
         screen_src_ptr++;
         screen_dest_ptr++;
      };
   }
   else
   {
      screen_src_ptr += start;
      screen_dest_ptr += start;
      end -= start;
      for (i = 0; i < end; i++)
      {
         pixel_pair = *screen_src_ptr;
         if (((pixel_pair & 0x04000200) == 0x04000200))
         {
            pixel_top = palette_ram_converted[pixel_pair & 0x1FF];
            pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
            pixel_bottom = palette_ram_converted[(pixel_pair >> 16) & 0x1FF];
            pixel_bottom = (pixel_bottom | (pixel_bottom << 16)) & 0x07E0F81F;
            pixel_top = ((pixel_top * blend_a) + (pixel_bottom * blend_b)) >> 4;
            pixel_top &= 0x07E0F81F;
            pixel_top = (pixel_top >> 16) | pixel_top;
            *screen_dest_ptr = pixel_top;
         }
         else
            *screen_dest_ptr = palette_ram_converted[pixel_pair & 0x1FF];
         screen_src_ptr++;
         screen_dest_ptr++;
      };
   }
}





static void expand_darken(u16* screen_src_ptr, u16* screen_dest_ptr,
                          u32 start, u32 end)
{
   u32 pixel_top;
   s32 blend = 16 - (io_registers[REG_BLDY] & 0x1F);
   u32 i;
   
   if (blend < 0)
      blend = 0;
      
   screen_src_ptr += start;
   screen_dest_ptr += start;
   end -= start;
   for (i = 0; i < end; i++)
   {
      pixel_top = *screen_src_ptr;
      if (((pixel_top & 0x00000200) == 0x00000200))
      {
         pixel_top = palette_ram_converted[pixel_top & 0x1FF];
         pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
         pixel_top = (pixel_top * blend) >> 4;;
         pixel_top &= 0x07E0F81F;
         pixel_top = (pixel_top >> 16) | pixel_top;
         *screen_dest_ptr = pixel_top;
      }
      else
         *screen_dest_ptr = palette_ram_converted[pixel_top & 0x1FF];
      screen_src_ptr++;
      screen_dest_ptr++;
   };
}




static void expand_brighten(u16* screen_src_ptr, u16* screen_dest_ptr,
                            u32 start, u32 end)
{
   u32 pixel_top;
   u32 blend = io_registers[REG_BLDY] & 0x1F;
   u32 upper;
   u32 i;
   
   if (blend > 16)
      blend = 16;
      
   upper = ((0x07E0F81F * blend) >> 4) & 0x07E0F81F;
   blend = 16 - blend;
   
   screen_src_ptr += start;
   screen_dest_ptr += start;
   end -= start;
   for (i = 0; i < end; i++)
   {
      pixel_top = *screen_src_ptr;
      if (((pixel_top & 0x00000200) == 0x00000200))
      {
         pixel_top = palette_ram_converted[pixel_top & 0x1FF];
         pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
         pixel_top = upper + ((pixel_top * blend) >> 4);;
         pixel_top &= 0x07E0F81F;
         pixel_top = (pixel_top >> 16) | pixel_top;
         *screen_dest_ptr = pixel_top;
      }
      else
         *screen_dest_ptr = palette_ram_converted[pixel_top & 0x1FF];
      screen_src_ptr++;
      screen_dest_ptr++;
   };
   
}





static void expand_darken_partial_alpha(u32* screen_src_ptr,
                                        u16* screen_dest_ptr,
                                        u32 start, u32 end)
{
   s32 blend = 16 - (io_registers[REG_BLDY] & 0x1F);
   u32 pixel_pair;
   u32 pixel_top, pixel_bottom;
   u32 bldalpha = io_registers[REG_BLDALPHA];
   u32 blend_a = bldalpha & 0x1F;
   u32 blend_b = (bldalpha >> 8) & 0x1F;
   u32 i;
   
   if (blend < 0)
      blend = 0;
      
   if (blend_a > 16)
      blend_a = 16;
      
   if (blend_b > 16)
      blend_b = 16;
      
   if ((blend_a + blend_b) > 16)
   {
      screen_src_ptr += start;
      screen_dest_ptr += start;
      end -= start;
      for (i = 0; i < end; i++)
      {
         pixel_pair = *screen_src_ptr;
         if (((pixel_pair & 0x00000200) == 0x00000200))
         {
            if (((pixel_pair & 0x04000200) == 0x04000200))
            {
               pixel_top = palette_ram_converted[pixel_pair & 0x1FF];
               pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
               pixel_bottom = palette_ram_converted[(pixel_pair >> 16) & 0x1FF];
               pixel_bottom = (pixel_bottom | (pixel_bottom << 16)) & 0x07E0F81F;
               pixel_top = ((pixel_top * blend_a) + (pixel_bottom * blend_b)) >> 4;
               if (pixel_top & 0x08010020)
               {
                  if (pixel_top & 0x08000000) pixel_top |= 0x07E00000;
                  if (pixel_top & 0x00010000) pixel_top |= 0x0000F800;
                  if (pixel_top & 0x00000020) pixel_top |= 0x0000001F;
               };
               pixel_top &= 0x07E0F81F;
               pixel_top = (pixel_top >> 16) | pixel_top;
               *screen_dest_ptr = pixel_top;
            }
            else
            {
               pixel_top = palette_ram_converted[pixel_pair & 0x1FF];
               pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
               pixel_top = (pixel_top * blend) >> 4;;
               pixel_top &= 0x07E0F81F;
               pixel_top = (pixel_top >> 16) | pixel_top;
               *screen_dest_ptr = pixel_top;
            }
         }
         else
            *screen_dest_ptr = palette_ram_converted[pixel_pair & 0x1FF];
         screen_src_ptr++;
         screen_dest_ptr++;
      };
   }
   else
   {
      screen_src_ptr += start;
      screen_dest_ptr += start;
      end -= start;
      for (i = 0; i < end; i++)
      {
         pixel_pair = *screen_src_ptr;
         if (((pixel_pair & 0x00000200) == 0x00000200))
         {
            if (((pixel_pair & 0x04000200) == 0x04000200))
            {
               pixel_top = palette_ram_converted[pixel_pair & 0x1FF];
               pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
               pixel_bottom = palette_ram_converted[(pixel_pair >> 16) & 0x1FF];
               pixel_bottom = (pixel_bottom | (pixel_bottom << 16)) & 0x07E0F81F;
               pixel_top = ((pixel_top * blend_a) + (pixel_bottom * blend_b)) >> 4;
               pixel_top &= 0x07E0F81F;
               pixel_top = (pixel_top >> 16) | pixel_top;
               *screen_dest_ptr = pixel_top;
            }
            else
            {
               pixel_top = palette_ram_converted[pixel_pair & 0x1FF];
               pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
               pixel_top = (pixel_top * blend) >> 4;;
               pixel_top &= 0x07E0F81F;
               pixel_top = (pixel_top >> 16) | pixel_top;
               *screen_dest_ptr = pixel_top;
            }
         }
         else
            *screen_dest_ptr = palette_ram_converted[pixel_pair & 0x1FF];
         screen_src_ptr++;
         screen_dest_ptr++;
      };
   };
}


static void expand_brighten_partial_alpha(u32* screen_src_ptr,
      u16* screen_dest_ptr,
      u32 start, u32 end)
{
   s32 blend = io_registers[REG_BLDY] & 0x1F;
   u32 pixel_pair;
   u32 pixel_top, pixel_bottom;
   u32 bldalpha = io_registers[REG_BLDALPHA];
   u32 blend_a = bldalpha & 0x1F;
   u32 blend_b = (bldalpha >> 8) & 0x1F;
   u32 upper;
   u32 i;
   
   if (blend > 16)
      blend = 16;
      
   upper = ((0x07E0F81F * blend) >> 4) & 0x07E0F81F;
   blend = 16 - blend;
   
   if (blend_a > 16)
      blend_a = 16;
      
   if (blend_b > 16)
      blend_b = 16;
      
   if ((blend_a + blend_b) > 16)
   {
      screen_src_ptr += start;
      screen_dest_ptr += start;
      end -= start;
      for (i = 0; i < end; i++)
      {
         pixel_pair = *screen_src_ptr;
         if (((pixel_pair & 0x00000200) == 0x00000200))
         {
            if (((pixel_pair & 0x04000200) == 0x04000200))
            {
               pixel_top = palette_ram_converted[pixel_pair & 0x1FF];
               pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
               pixel_bottom = palette_ram_converted[(pixel_pair >> 16) & 0x1FF];
               pixel_bottom = (pixel_bottom | (pixel_bottom << 16)) & 0x07E0F81F;
               pixel_top = ((pixel_top * blend_a) + (pixel_bottom * blend_b)) >> 4;
               if (pixel_top & 0x08010020)
               {
                  if (pixel_top & 0x08000000) pixel_top |= 0x07E00000;
                  if (pixel_top & 0x00010000) pixel_top |= 0x0000F800;
                  if (pixel_top & 0x00000020) pixel_top |= 0x0000001F;
               };
               pixel_top &= 0x07E0F81F;
               pixel_top = (pixel_top >> 16) | pixel_top;
               *screen_dest_ptr = pixel_top;
            }
            else
            {
               pixel_top = palette_ram_converted[pixel_pair & 0x1FF];
               pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
               pixel_top = upper + ((pixel_top * blend) >> 4);;
               pixel_top &= 0x07E0F81F;
               pixel_top = (pixel_top >> 16) | pixel_top;
               *screen_dest_ptr = pixel_top;
            }
         }
         else
            *screen_dest_ptr = palette_ram_converted[pixel_pair & 0x1FF];
         screen_src_ptr++;
         screen_dest_ptr++;
      };
   }
   else
   {
      screen_src_ptr += start;
      screen_dest_ptr += start;
      end -= start;
      for (i = 0; i < end; i++)
      {
         pixel_pair = *screen_src_ptr;
         if (((pixel_pair & 0x00000200) == 0x00000200))
         {
            if (((pixel_pair & 0x04000200) == 0x04000200))
            {
               pixel_top = palette_ram_converted[pixel_pair & 0x1FF];
               pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
               pixel_bottom = palette_ram_converted[(pixel_pair >> 16) & 0x1FF];
               pixel_bottom = (pixel_bottom | (pixel_bottom << 16)) & 0x07E0F81F;
               pixel_top = ((pixel_top * blend_a) + (pixel_bottom * blend_b)) >> 4;
               pixel_top &= 0x07E0F81F;
               pixel_top = (pixel_top >> 16) | pixel_top;
               *screen_dest_ptr = pixel_top;
            }
            else
            {
               pixel_top = palette_ram_converted[pixel_pair & 0x1FF];
               pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
               pixel_top = upper + ((pixel_top * blend) >> 4);;
               pixel_top &= 0x07E0F81F;
               pixel_top = (pixel_top >> 16) | pixel_top;
               *screen_dest_ptr = pixel_top;
            }
         }
         else
            *screen_dest_ptr = palette_ram_converted[pixel_pair & 0x1FF];
         screen_src_ptr++;
         screen_dest_ptr++;
      };
   };
}

static void render_scanline_tile(u16* scanline, u32 dispcnt)
{
   u32 current_layer;
   u32 layer_order_pos;
   u32 bldcnt = io_registers[REG_BLDCNT];
   const tile_layer_render_struct* layer_renderers = tile_mode_renderers[dispcnt &
         0x07];
         
   {
      if (layer_count)
      {
         if (obj_alpha_count[io_registers[REG_VCOUNT]] > 0)
         {
            u32 screen_buffer[240];
            switch ((bldcnt >> 6) & 0x03)
            {
            case 0x01:
            {
               if ((((io_registers[REG_BLDALPHA] & 0x1F1F) != 0x001F)
                     && ((io_registers[REG_BLDCNT] & 0x3F) != 0)
                     && ((io_registers[REG_BLDCNT] & 0x3F00) != 0)))
               {
                  {
                     current_layer = layer_order[0];
                     if (current_layer & 0x04)
                     {
                        fill_line_alpha(0, screen_buffer, 0, 240);
                        current_layer &= ~0x04;
                        if (dispcnt & 0x40) render_scanline_obj_alpha_obj_1D(current_layer, 0, 240,
                                 screen_buffer);
                        else render_scanline_obj_alpha_obj_2D(current_layer, 0, 240, screen_buffer);
                     }
                     else
                        layer_renderers[current_layer].alpha_render_base(current_layer, 0, 240,
                              screen_buffer);
                     for (layer_order_pos = 1; layer_order_pos < layer_count; layer_order_pos++)
                     {
                        current_layer = layer_order[layer_order_pos];
                        if (current_layer & 0x04)
                        {
                           current_layer &= ~0x04;
                           if (dispcnt & 0x40) render_scanline_obj_alpha_obj_1D(current_layer, 0, 240,
                                    screen_buffer);
                           else render_scanline_obj_alpha_obj_2D(current_layer, 0, 240, screen_buffer);
                        }
                        else
                           layer_renderers[current_layer]. alpha_render_transparent(current_layer, 0, 240,
                                 screen_buffer);
                     }
                  };
                  expand_blend(screen_buffer, scanline, 0, 240);
                  return;
               }
               break;
            }
            case 0x02:
            {
               if ((((io_registers[REG_BLDY] & 0x1F) != 0)
                     && ((io_registers[REG_BLDCNT] & 0x3F) != 0)))
               {
                  {
                     current_layer = layer_order[0];
                     if (current_layer & 0x04)
                     {
                        fill_line_color32(0, screen_buffer, 0, 240);
                        current_layer &= ~0x04;
                        if (dispcnt & 0x40) render_scanline_obj_partial_alpha_1D(current_layer, 0, 240,
                                 screen_buffer);
                        else render_scanline_obj_partial_alpha_2D(current_layer, 0, 240,
                                 screen_buffer);
                     }
                     else
                        layer_renderers[current_layer].color32_render_base(current_layer, 0, 240,
                              screen_buffer);
                     for (layer_order_pos = 1; layer_order_pos < layer_count; layer_order_pos++)
                     {
                        current_layer = layer_order[layer_order_pos];
                        if (current_layer & 0x04)
                        {
                           current_layer &= ~0x04;
                           if (dispcnt & 0x40) render_scanline_obj_partial_alpha_1D(current_layer, 0, 240,
                                    screen_buffer);
                           else render_scanline_obj_partial_alpha_2D(current_layer, 0, 240,
                                    screen_buffer);
                        }
                        else
                           layer_renderers[current_layer]. color32_render_transparent(current_layer, 0,
                                 240, screen_buffer);
                     }
                  };
                  expand_brighten_partial_alpha(screen_buffer, scanline, 0, 240);
                  return;
               }
               break;
            }
            case 0x03:
            {
               if ((((io_registers[REG_BLDY] & 0x1F) != 0)
                     && ((io_registers[REG_BLDCNT] & 0x3F) != 0)))
               {
                  {
                     current_layer = layer_order[0];
                     if (current_layer & 0x04)
                     {
                        fill_line_color32(0, screen_buffer, 0, 240);
                        current_layer &= ~0x04;
                        if (dispcnt & 0x40) render_scanline_obj_partial_alpha_1D(current_layer, 0, 240,
                                 screen_buffer);
                        else render_scanline_obj_partial_alpha_2D(current_layer, 0, 240,
                                 screen_buffer);
                     }
                     else
                        layer_renderers[current_layer].color32_render_base(current_layer, 0, 240,
                              screen_buffer);
                     for (layer_order_pos = 1; layer_order_pos < layer_count; layer_order_pos++)
                     {
                        current_layer = layer_order[layer_order_pos];
                        if (current_layer & 0x04)
                        {
                           current_layer &= ~0x04;
                           if (dispcnt & 0x40) render_scanline_obj_partial_alpha_1D(current_layer, 0, 240,
                                    screen_buffer);
                           else render_scanline_obj_partial_alpha_2D(current_layer, 0, 240,
                                    screen_buffer);
                        }
                        else
                           layer_renderers[current_layer]. color32_render_transparent(current_layer, 0,
                                 240, screen_buffer);
                     }
                  };
                  expand_darken_partial_alpha(screen_buffer, scanline, 0, 240);
                  return;
               }
               break;
            }
            }
            {
               current_layer = layer_order[0];
               if (current_layer & 0x04)
               {
                  fill_line_color32(0, screen_buffer, 0, 240);
                  current_layer &= ~0x04;
                  if (dispcnt & 0x40) render_scanline_obj_partial_alpha_1D(current_layer, 0, 240,
                           screen_buffer);
                  else render_scanline_obj_partial_alpha_2D(current_layer, 0, 240,
                           screen_buffer);
               }
               else
                  layer_renderers[current_layer].color32_render_base(current_layer, 0, 240,
                        screen_buffer);
               for (layer_order_pos = 1; layer_order_pos < layer_count; layer_order_pos++)
               {
                  current_layer = layer_order[layer_order_pos];
                  if (current_layer & 0x04)
                  {
                     current_layer &= ~0x04;
                     if (dispcnt & 0x40) render_scanline_obj_partial_alpha_1D(current_layer, 0, 240,
                              screen_buffer);
                     else render_scanline_obj_partial_alpha_2D(current_layer, 0, 240,
                              screen_buffer);
                  }
                  else
                     layer_renderers[current_layer]. color32_render_transparent(current_layer, 0,
                           240, screen_buffer);
               }
            };
            expand_blend(screen_buffer, scanline, 0, 240);
         }
         else
         {
            switch ((bldcnt >> 6) & 0x03)
            {
            case 0x01:
            {
               if ((((io_registers[REG_BLDALPHA] & 0x1F1F) != 0x001F)
                     && ((io_registers[REG_BLDCNT] & 0x3F) != 0)
                     && ((io_registers[REG_BLDCNT] & 0x3F00) != 0)))
               {
                  u32 screen_buffer[240];
                  {
                     current_layer = layer_order[0];
                     if (current_layer & 0x04)
                     {
                        fill_line_alpha(0, screen_buffer, 0, 240);
                        current_layer &= ~0x04;
                        if (dispcnt & 0x40) render_scanline_obj_alpha_obj_1D(current_layer, 0, 240,
                                 screen_buffer);
                        else render_scanline_obj_alpha_obj_2D(current_layer, 0, 240, screen_buffer);
                     }
                     else
                        layer_renderers[current_layer].alpha_render_base(current_layer, 0, 240,
                              screen_buffer);
                     for (layer_order_pos = 1; layer_order_pos < layer_count; layer_order_pos++)
                     {
                        current_layer = layer_order[layer_order_pos];
                        if (current_layer & 0x04)
                        {
                           current_layer &= ~0x04;
                           if (dispcnt & 0x40) render_scanline_obj_alpha_obj_1D(current_layer, 0, 240,
                                    screen_buffer);
                           else render_scanline_obj_alpha_obj_2D(current_layer, 0, 240, screen_buffer);
                        }
                        else
                           layer_renderers[current_layer]. alpha_render_transparent(current_layer, 0, 240,
                                 screen_buffer);
                     }
                  };
                  expand_blend(screen_buffer, scanline, 0, 240);
                  return;
               }
               break;
            }
            case 0x02:
            {
               if ((((io_registers[REG_BLDY] & 0x1F) != 0)
                     && ((io_registers[REG_BLDCNT] & 0x3F) != 0)))
               {
                  {
                     current_layer = layer_order[0];
                     if (current_layer & 0x04)
                     {
                        fill_line_color16(0, scanline, 0, 240);
                        current_layer &= ~0x04;
                        if (dispcnt & 0x40) render_scanline_obj_color16_1D(current_layer, 0, 240,
                                 scanline);
                        else render_scanline_obj_color16_2D(current_layer, 0, 240, scanline);
                     }
                     else
                        layer_renderers[current_layer].color16_render_base(current_layer, 0, 240,
                              scanline);
                     for (layer_order_pos = 1; layer_order_pos < layer_count; layer_order_pos++)
                     {
                        current_layer = layer_order[layer_order_pos];
                        if (current_layer & 0x04)
                        {
                           current_layer &= ~0x04;
                           if (dispcnt & 0x40) render_scanline_obj_color16_1D(current_layer, 0, 240,
                                    scanline);
                           else render_scanline_obj_color16_2D(current_layer, 0, 240, scanline);
                        }
                        else
                           layer_renderers[current_layer]. color16_render_transparent(current_layer, 0,
                                 240, scanline);
                     }
                  };
                  expand_brighten(scanline, scanline, 0, 240);
                  return;
               }
               break;
            }
            case 0x03:
            {
               if ((((io_registers[REG_BLDY] & 0x1F) != 0)
                     && ((io_registers[REG_BLDCNT] & 0x3F) != 0)))
               {
                  {
                     current_layer = layer_order[0];
                     if (current_layer & 0x04)
                     {
                        fill_line_color16(0, scanline, 0, 240);
                        current_layer &= ~0x04;
                        if (dispcnt & 0x40) render_scanline_obj_color16_1D(current_layer, 0, 240,
                                 scanline);
                        else render_scanline_obj_color16_2D(current_layer, 0, 240, scanline);
                     }
                     else
                        layer_renderers[current_layer].color16_render_base(current_layer, 0, 240,
                              scanline);
                     for (layer_order_pos = 1; layer_order_pos < layer_count; layer_order_pos++)
                     {
                        current_layer = layer_order[layer_order_pos];
                        if (current_layer & 0x04)
                        {
                           current_layer &= ~0x04;
                           if (dispcnt & 0x40) render_scanline_obj_color16_1D(current_layer, 0, 240,
                                    scanline);
                           else render_scanline_obj_color16_2D(current_layer, 0, 240, scanline);
                        }
                        else
                           layer_renderers[current_layer]. color16_render_transparent(current_layer, 0,
                                 240, scanline);
                     }
                  };
                  expand_darken(scanline, scanline, 0, 240);
                  return;
               }
               break;
            }
            }
            {
               current_layer = layer_order[0];
               if (current_layer & 0x04)
               {
                  fill_line_normal(0, scanline, 0, 240);
                  current_layer &= ~0x04;
                  if (dispcnt & 0x40) render_scanline_obj_normal_1D(current_layer, 0, 240,
                           scanline);
                  else render_scanline_obj_normal_2D(current_layer, 0, 240, scanline);
               }
               else
                  layer_renderers[current_layer].normal_render_base(current_layer, 0, 240,
                        scanline);
               for (layer_order_pos = 1; layer_order_pos < layer_count; layer_order_pos++)
               {
                  current_layer = layer_order[layer_order_pos];
                  if (current_layer & 0x04)
                  {
                     current_layer &= ~0x04;
                     if (dispcnt & 0x40) render_scanline_obj_normal_1D(current_layer, 0, 240,
                              scanline);
                     else render_scanline_obj_normal_2D(current_layer, 0, 240, scanline);
                  }
                  else
                     layer_renderers[current_layer]. normal_render_transparent(current_layer, 0, 240,
                           scanline);
               }
            }; ;
         }
      }
      else
      {
         u32 pixel_top = palette_ram_converted[0];
         switch ((bldcnt >> 6) & 0x03)
         {
         case 0x02:
         {
            if (((io_registers[REG_BLDCNT] >> 5) & 0x01))
            {
               u32 blend = io_registers[REG_BLDY] & 0x1F;
               u32 upper;
               if (blend > 16) blend = 16;
               upper = ((0x07E0F81F * blend) >> 4) & 0x07E0F81F;
               blend = 16 - blend;
               pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
               pixel_top = upper + ((pixel_top * blend) >> 4);;
               pixel_top &= 0x07E0F81F;
               pixel_top = (pixel_top >> 16) | pixel_top;
            }
            break;
         }
         case 0x03:
         {
            if (((io_registers[REG_BLDCNT] >> 5) & 0x01))
            {
               s32 blend = 16 - (io_registers[REG_BLDY] & 0x1F);
               if (blend < 0) blend = 0;
               pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
               pixel_top = (pixel_top * blend) >> 4;;
               pixel_top &= 0x07E0F81F;
               pixel_top = (pixel_top >> 16) | pixel_top;
            }
            break;
         }
         }
         fill_line_color16(pixel_top, scanline, 0, 240);
      }
   }
   ;
}

static void render_scanline_bitmap(u16* scanline, u32 dispcnt)
{
   const bitmap_layer_render_struct* layer_renderers = bitmap_mode_renderers + ((
            dispcnt & 0x07) - 3);
   u32 current_layer;
   u32 layer_order_pos;
   
   fill_line_normal(0, scanline, 0, 240);
   
   for (layer_order_pos = 0; layer_order_pos < layer_count; layer_order_pos++)
   {
      current_layer = layer_order[layer_order_pos];
      if (current_layer & 0x04)
      {
         current_layer &= ~0x04;
         if (dispcnt & 0x40) render_scanline_obj_normal_1D(current_layer, 0, 240,
                  scanline);
         else render_scanline_obj_normal_2D(current_layer, 0, 240, scanline);
      }
      else
         layer_renderers->normal_render(0, 240, scanline);
   }
}

static void render_scanline_conditional_tile(u32 start, u32 end, u16* scanline,
      u32 enable_flags, u32 dispcnt, u32 bldcnt, const tile_layer_render_struct
      *layer_renderers)
{
   u32 current_layer;
   u32 layer_order_pos = 0;
   
   {
      if ((layer_count && (enable_flags & 0x1F)))
      {
         if (obj_alpha_count[io_registers[REG_VCOUNT]] > 0)
         {
            u32 screen_buffer[240];
            switch ((bldcnt >> 6) & 0x03)
            {
            case 0x01:
            {
               if (((enable_flags & 0x20)
                     && (((io_registers[REG_BLDALPHA] & 0x1F1F) != 0x001F)
                         && ((io_registers[REG_BLDCNT] & 0x3F) != 0)
                         && ((io_registers[REG_BLDCNT] & 0x3F00) != 0))))
               {
                  {
                     __label__ skip;
                     current_layer = layer_order[layer_order_pos];
                     if (!(enable_flags & 0x10))
                     {
                        while ((current_layer & 0x04) || !((1 << current_layer) & enable_flags))
                        {
                           layer_order_pos++;
                           current_layer = layer_order[layer_order_pos];
                           if (layer_order_pos == layer_count)
                           {
                              fill_line_alpha(0, screen_buffer, start, end);
                              goto skip;
                           }
                        }
                        layer_renderers[current_layer].alpha_render_base(current_layer, start, end,
                              screen_buffer);
                        layer_order_pos++;
                        for (; layer_order_pos < layer_count; layer_order_pos++)
                        {
                           current_layer = layer_order[layer_order_pos];
                           if (!(current_layer & 0x04) && ((1 << current_layer) & enable_flags))
                              layer_renderers[current_layer]. alpha_render_transparent(current_layer, start,
                                    end, screen_buffer);
                        }
                     }
                     else
                     {
                        while (!((current_layer & 0x04) || ((1 << current_layer) & enable_flags)))
                        {
                           layer_order_pos++;
                           current_layer = layer_order[layer_order_pos];
                           if (layer_order_pos == layer_count)
                           {
                              fill_line_alpha(0, screen_buffer, start, end);
                              goto skip;
                           }
                        }
                        if (current_layer & 0x04)
                        {
                           fill_line_alpha(0, screen_buffer, start, end);
                           current_layer &= ~0x04;
                           if (dispcnt & 0x40) render_scanline_obj_alpha_obj_1D(current_layer, start, end,
                                    screen_buffer);
                           else render_scanline_obj_alpha_obj_2D(current_layer, start, end,
                                                                    screen_buffer);
                        }
                        else
                           layer_renderers[current_layer]. alpha_render_base(current_layer, start, end,
                                 screen_buffer);
                        layer_order_pos++;
                        for (; layer_order_pos < layer_count; layer_order_pos++)
                        {
                           current_layer = layer_order[layer_order_pos];
                           if (current_layer & 0x04)
                           {
                              current_layer &= ~0x04;
                              if (dispcnt & 0x40) render_scanline_obj_alpha_obj_1D(current_layer, start, end,
                                       screen_buffer);
                              else render_scanline_obj_alpha_obj_2D(current_layer, start, end,
                                                                       screen_buffer);
                           }
                           else
                           {
                              if (enable_flags & (1 << current_layer))
                                 layer_renderers[current_layer]. alpha_render_transparent(current_layer, start,
                                       end, screen_buffer);
                           }
                        }
                     }
skip:
                     ;
                  };
                  expand_blend(screen_buffer, scanline, start, end);
                  return;
               }
               break;
            }
            case 0x02:
            {
               if (((enable_flags & 0x20) && (((io_registers[REG_BLDY] & 0x1F) != 0)
                                              && ((io_registers[REG_BLDCNT] & 0x3F) != 0))))
               {
                  {
                     __label__ skip;
                     current_layer = layer_order[layer_order_pos];
                     if (!(enable_flags & 0x10))
                     {
                        while ((current_layer & 0x04) || !((1 << current_layer) & enable_flags))
                        {
                           layer_order_pos++;
                           current_layer = layer_order[layer_order_pos];
                           if (layer_order_pos == layer_count)
                           {
                              fill_line_color32(0, screen_buffer, start, end);
                              goto skip;
                           }
                        }
                        layer_renderers[current_layer].color32_render_base(current_layer, start, end,
                              screen_buffer);
                        layer_order_pos++;
                        for (; layer_order_pos < layer_count; layer_order_pos++)
                        {
                           current_layer = layer_order[layer_order_pos];
                           if (!(current_layer & 0x04) && ((1 << current_layer) & enable_flags))
                              layer_renderers[current_layer]. color32_render_transparent(current_layer, start,
                                    end, screen_buffer);
                        }
                     }
                     else
                     {
                        while (!((current_layer & 0x04) || ((1 << current_layer) & enable_flags)))
                        {
                           layer_order_pos++;
                           current_layer = layer_order[layer_order_pos];
                           if (layer_order_pos == layer_count)
                           {
                              fill_line_color32(0, screen_buffer, start, end);
                              goto skip;
                           }
                        }
                        if (current_layer & 0x04)
                        {
                           fill_line_color32(0, screen_buffer, start, end);
                           current_layer &= ~0x04;
                           if (dispcnt & 0x40) render_scanline_obj_partial_alpha_1D(current_layer, start,
                                    end, screen_buffer);
                           else render_scanline_obj_partial_alpha_2D(current_layer, start, end,
                                    screen_buffer);
                        }
                        else
                           layer_renderers[current_layer]. color32_render_base(current_layer, start, end,
                                 screen_buffer);
                        layer_order_pos++;
                        for (; layer_order_pos < layer_count; layer_order_pos++)
                        {
                           current_layer = layer_order[layer_order_pos];
                           if (current_layer & 0x04)
                           {
                              current_layer &= ~0x04;
                              if (dispcnt & 0x40) render_scanline_obj_partial_alpha_1D(current_layer, start,
                                       end, screen_buffer);
                              else render_scanline_obj_partial_alpha_2D(current_layer, start, end,
                                       screen_buffer);
                           }
                           else
                           {
                              if (enable_flags & (1 << current_layer))
                                 layer_renderers[current_layer]. color32_render_transparent(current_layer, start,
                                       end, screen_buffer);
                           }
                        }
                     }
skip:
                     ;
                  };
                  expand_brighten_partial_alpha(screen_buffer, scanline, start, end);
                  return;
               }
               break;
            }
            case 0x03:
            {
               if (((enable_flags & 0x20) && (((io_registers[REG_BLDY] & 0x1F) != 0)
                                              && ((io_registers[REG_BLDCNT] & 0x3F) != 0))))
               {
                  {
                     __label__ skip;
                     current_layer = layer_order[layer_order_pos];
                     if (!(enable_flags & 0x10))
                     {
                        while ((current_layer & 0x04) || !((1 << current_layer) & enable_flags))
                        {
                           layer_order_pos++;
                           current_layer = layer_order[layer_order_pos];
                           if (layer_order_pos == layer_count)
                           {
                              fill_line_color32(0, screen_buffer, start, end);
                              goto skip;
                           }
                        }
                        layer_renderers[current_layer].color32_render_base(current_layer, start, end,
                              screen_buffer);
                        layer_order_pos++;
                        for (; layer_order_pos < layer_count; layer_order_pos++)
                        {
                           current_layer = layer_order[layer_order_pos];
                           if (!(current_layer & 0x04) && ((1 << current_layer) & enable_flags))
                              layer_renderers[current_layer]. color32_render_transparent(current_layer, start,
                                    end, screen_buffer);
                        }
                     }
                     else
                     {
                        while (!((current_layer & 0x04) || ((1 << current_layer) & enable_flags)))
                        {
                           layer_order_pos++;
                           current_layer = layer_order[layer_order_pos];
                           if (layer_order_pos == layer_count)
                           {
                              fill_line_color32(0, screen_buffer, start, end);
                              goto skip;
                           }
                        }
                        if (current_layer & 0x04)
                        {
                           fill_line_color32(0, screen_buffer, start, end);
                           current_layer &= ~0x04;
                           if (dispcnt & 0x40) render_scanline_obj_partial_alpha_1D(current_layer, start,
                                    end, screen_buffer);
                           else render_scanline_obj_partial_alpha_2D(current_layer, start, end,
                                    screen_buffer);
                        }
                        else
                           layer_renderers[current_layer]. color32_render_base(current_layer, start, end,
                                 screen_buffer);
                        layer_order_pos++;
                        for (; layer_order_pos < layer_count; layer_order_pos++)
                        {
                           current_layer = layer_order[layer_order_pos];
                           if (current_layer & 0x04)
                           {
                              current_layer &= ~0x04;
                              if (dispcnt & 0x40) render_scanline_obj_partial_alpha_1D(current_layer, start,
                                       end, screen_buffer);
                              else render_scanline_obj_partial_alpha_2D(current_layer, start, end,
                                       screen_buffer);
                           }
                           else
                           {
                              if (enable_flags & (1 << current_layer))
                                 layer_renderers[current_layer]. color32_render_transparent(current_layer, start,
                                       end, screen_buffer);
                           }
                        }
                     }
skip:
                     ;
                  };
                  expand_darken_partial_alpha(screen_buffer, scanline, start, end);
                  return;
               }
               break;
            }
            }
            {
               __label__ skip;
               current_layer = layer_order[layer_order_pos];
               if (!(enable_flags & 0x10))
               {
                  while ((current_layer & 0x04) || !((1 << current_layer) & enable_flags))
                  {
                     layer_order_pos++;
                     current_layer = layer_order[layer_order_pos];
                     if (layer_order_pos == layer_count)
                     {
                        fill_line_color32(0, screen_buffer, start, end);
                        goto skip;
                     }
                  }
                  layer_renderers[current_layer].color32_render_base(current_layer, start, end,
                        screen_buffer);
                  layer_order_pos++;
                  for (; layer_order_pos < layer_count; layer_order_pos++)
                  {
                     current_layer = layer_order[layer_order_pos];
                     if (!(current_layer & 0x04) && ((1 << current_layer) & enable_flags))
                        layer_renderers[current_layer]. color32_render_transparent(current_layer, start,
                              end, screen_buffer);
                  }
               }
               else
               {
                  while (!((current_layer & 0x04) || ((1 << current_layer) & enable_flags)))
                  {
                     layer_order_pos++;
                     current_layer = layer_order[layer_order_pos];
                     if (layer_order_pos == layer_count)
                     {
                        fill_line_color32(0, screen_buffer, start, end);
                        goto skip;
                     }
                  }
                  if (current_layer & 0x04)
                  {
                     fill_line_color32(0, screen_buffer, start, end);
                     current_layer &= ~0x04;
                     if (dispcnt & 0x40) render_scanline_obj_partial_alpha_1D(current_layer, start,
                              end, screen_buffer);
                     else render_scanline_obj_partial_alpha_2D(current_layer, start, end,
                              screen_buffer);
                  }
                  else
                     layer_renderers[current_layer]. color32_render_base(current_layer, start, end,
                           screen_buffer);
                  layer_order_pos++;
                  for (; layer_order_pos < layer_count; layer_order_pos++)
                  {
                     current_layer = layer_order[layer_order_pos];
                     if (current_layer & 0x04)
                     {
                        current_layer &= ~0x04;
                        if (dispcnt & 0x40) render_scanline_obj_partial_alpha_1D(current_layer, start,
                                 end, screen_buffer);
                        else render_scanline_obj_partial_alpha_2D(current_layer, start, end,
                                 screen_buffer);
                     }
                     else
                     {
                        if (enable_flags & (1 << current_layer))
                           layer_renderers[current_layer]. color32_render_transparent(current_layer, start,
                                 end, screen_buffer);
                     }
                  }
               }
skip:
               ;
            };
            expand_blend(screen_buffer, scanline, start, end);
         }
         else
         {
            switch ((bldcnt >> 6) & 0x03)
            {
            case 0x01:
            {
               if (((enable_flags & 0x20)
                     && (((io_registers[REG_BLDALPHA] & 0x1F1F) != 0x001F)
                         && ((io_registers[REG_BLDCNT] & 0x3F) != 0)
                         && ((io_registers[REG_BLDCNT] & 0x3F00) != 0))))
               {
                  u32 screen_buffer[240];
                  {
                     __label__ skip;
                     current_layer = layer_order[layer_order_pos];
                     if (!(enable_flags & 0x10))
                     {
                        while ((current_layer & 0x04) || !((1 << current_layer) & enable_flags))
                        {
                           layer_order_pos++;
                           current_layer = layer_order[layer_order_pos];
                           if (layer_order_pos == layer_count)
                           {
                              fill_line_alpha(0, screen_buffer, start, end);
                              goto skip;
                           }
                        }
                        layer_renderers[current_layer].alpha_render_base(current_layer, start, end,
                              screen_buffer);
                        layer_order_pos++;
                        for (; layer_order_pos < layer_count; layer_order_pos++)
                        {
                           current_layer = layer_order[layer_order_pos];
                           if (!(current_layer & 0x04) && ((1 << current_layer) & enable_flags))
                              layer_renderers[current_layer]. alpha_render_transparent(current_layer, start,
                                    end, screen_buffer);
                        }
                     }
                     else
                     {
                        while (!((current_layer & 0x04) || ((1 << current_layer) & enable_flags)))
                        {
                           layer_order_pos++;
                           current_layer = layer_order[layer_order_pos];
                           if (layer_order_pos == layer_count)
                           {
                              fill_line_alpha(0, screen_buffer, start, end);
                              goto skip;
                           }
                        }
                        if (current_layer & 0x04)
                        {
                           fill_line_alpha(0, screen_buffer, start, end);
                           current_layer &= ~0x04;
                           if (dispcnt & 0x40) render_scanline_obj_alpha_obj_1D(current_layer, start, end,
                                    screen_buffer);
                           else render_scanline_obj_alpha_obj_2D(current_layer, start, end,
                                                                    screen_buffer);
                        }
                        else
                           layer_renderers[current_layer]. alpha_render_base(current_layer, start, end,
                                 screen_buffer);
                        layer_order_pos++;
                        for (; layer_order_pos < layer_count; layer_order_pos++)
                        {
                           current_layer = layer_order[layer_order_pos];
                           if (current_layer & 0x04)
                           {
                              current_layer &= ~0x04;
                              if (dispcnt & 0x40) render_scanline_obj_alpha_obj_1D(current_layer, start, end,
                                       screen_buffer);
                              else render_scanline_obj_alpha_obj_2D(current_layer, start, end,
                                                                       screen_buffer);
                           }
                           else
                           {
                              if (enable_flags & (1 << current_layer))
                                 layer_renderers[current_layer]. alpha_render_transparent(current_layer, start,
                                       end, screen_buffer);
                           }
                        }
                     }
skip:
                     ;
                  };
                  expand_blend(screen_buffer, scanline, start, end);
                  return;
               }
               break;
            }
            case 0x02:
            {
               if (((enable_flags & 0x20) && (((io_registers[REG_BLDY] & 0x1F) != 0)
                                              && ((io_registers[REG_BLDCNT] & 0x3F) != 0))))
               {
                  {
                     __label__ skip;
                     current_layer = layer_order[layer_order_pos];
                     if (!(enable_flags & 0x10))
                     {
                        while ((current_layer & 0x04) || !((1 << current_layer) & enable_flags))
                        {
                           layer_order_pos++;
                           current_layer = layer_order[layer_order_pos];
                           if (layer_order_pos == layer_count)
                           {
                              fill_line_color16(0, scanline, start, end);
                              goto skip;
                           }
                        }
                        layer_renderers[current_layer].color16_render_base(current_layer, start, end,
                              scanline);
                        layer_order_pos++;
                        for (; layer_order_pos < layer_count; layer_order_pos++)
                        {
                           current_layer = layer_order[layer_order_pos];
                           if (!(current_layer & 0x04) && ((1 << current_layer) & enable_flags))
                              layer_renderers[current_layer]. color16_render_transparent(current_layer, start,
                                    end, scanline);
                        }
                     }
                     else
                     {
                        while (!((current_layer & 0x04) || ((1 << current_layer) & enable_flags)))
                        {
                           layer_order_pos++;
                           current_layer = layer_order[layer_order_pos];
                           if (layer_order_pos == layer_count)
                           {
                              fill_line_color16(0, scanline, start, end);
                              goto skip;
                           }
                        }
                        if (current_layer & 0x04)
                        {
                           fill_line_color16(0, scanline, start, end);
                           current_layer &= ~0x04;
                           if (dispcnt & 0x40) render_scanline_obj_color16_1D(current_layer, start, end,
                                    scanline);
                           else render_scanline_obj_color16_2D(current_layer, start, end, scanline);
                        }
                        else
                           layer_renderers[current_layer]. color16_render_base(current_layer, start, end,
                                 scanline);
                        layer_order_pos++;
                        for (; layer_order_pos < layer_count; layer_order_pos++)
                        {
                           current_layer = layer_order[layer_order_pos];
                           if (current_layer & 0x04)
                           {
                              current_layer &= ~0x04;
                              if (dispcnt & 0x40) render_scanline_obj_color16_1D(current_layer, start, end,
                                       scanline);
                              else render_scanline_obj_color16_2D(current_layer, start, end, scanline);
                           }
                           else
                           {
                              if (enable_flags & (1 << current_layer))
                                 layer_renderers[current_layer]. color16_render_transparent(current_layer, start,
                                       end, scanline);
                           }
                        }
                     }
skip:
                     ;
                  };
                  expand_brighten(scanline, scanline, start, end);
                  return;
               }
               break;
            }
            case 0x03:
            {
               if (((enable_flags & 0x20) && (((io_registers[REG_BLDY] & 0x1F) != 0)
                                              && ((io_registers[REG_BLDCNT] & 0x3F) != 0))))
               {
                  {
                     __label__ skip;
                     current_layer = layer_order[layer_order_pos];
                     if (!(enable_flags & 0x10))
                     {
                        while ((current_layer & 0x04) || !((1 << current_layer) & enable_flags))
                        {
                           layer_order_pos++;
                           current_layer = layer_order[layer_order_pos];
                           if (layer_order_pos == layer_count)
                           {
                              fill_line_color16(0, scanline, start, end);
                              goto skip;
                           }
                        }
                        layer_renderers[current_layer].color16_render_base(current_layer, start, end,
                              scanline);
                        layer_order_pos++;
                        for (; layer_order_pos < layer_count; layer_order_pos++)
                        {
                           current_layer = layer_order[layer_order_pos];
                           if (!(current_layer & 0x04) && ((1 << current_layer) & enable_flags))
                              layer_renderers[current_layer]. color16_render_transparent(current_layer, start,
                                    end, scanline);
                        }
                     }
                     else
                     {
                        while (!((current_layer & 0x04) || ((1 << current_layer) & enable_flags)))
                        {
                           layer_order_pos++;
                           current_layer = layer_order[layer_order_pos];
                           if (layer_order_pos == layer_count)
                           {
                              fill_line_color16(0, scanline, start, end);
                              goto skip;
                           }
                        }
                        if (current_layer & 0x04)
                        {
                           fill_line_color16(0, scanline, start, end);
                           current_layer &= ~0x04;
                           if (dispcnt & 0x40) render_scanline_obj_color16_1D(current_layer, start, end,
                                    scanline);
                           else render_scanline_obj_color16_2D(current_layer, start, end, scanline);
                        }
                        else
                           layer_renderers[current_layer]. color16_render_base(current_layer, start, end,
                                 scanline);
                        layer_order_pos++;
                        for (; layer_order_pos < layer_count; layer_order_pos++)
                        {
                           current_layer = layer_order[layer_order_pos];
                           if (current_layer & 0x04)
                           {
                              current_layer &= ~0x04;
                              if (dispcnt & 0x40) render_scanline_obj_color16_1D(current_layer, start, end,
                                       scanline);
                              else render_scanline_obj_color16_2D(current_layer, start, end, scanline);
                           }
                           else
                           {
                              if (enable_flags & (1 << current_layer))
                                 layer_renderers[current_layer]. color16_render_transparent(current_layer, start,
                                       end, scanline);
                           }
                        }
                     }
skip:
                     ;
                  };
                  expand_darken(scanline, scanline, start, end);
                  return;
               }
               break;
            }
            }
            {
               __label__ skip;
               current_layer = layer_order[layer_order_pos];
               if (!(enable_flags & 0x10))
               {
                  while ((current_layer & 0x04) || !((1 << current_layer) & enable_flags))
                  {
                     layer_order_pos++;
                     current_layer = layer_order[layer_order_pos];
                     if (layer_order_pos == layer_count)
                     {
                        fill_line_normal(0, scanline, start, end);
                        goto skip;
                     }
                  }
                  layer_renderers[current_layer].normal_render_base(current_layer, start, end,
                        scanline);
                  layer_order_pos++;
                  for (; layer_order_pos < layer_count; layer_order_pos++)
                  {
                     current_layer = layer_order[layer_order_pos];
                     if (!(current_layer & 0x04) && ((1 << current_layer) & enable_flags))
                        layer_renderers[current_layer]. normal_render_transparent(current_layer, start,
                              end, scanline);
                  }
               }
               else
               {
                  while (!((current_layer & 0x04) || ((1 << current_layer) & enable_flags)))
                  {
                     layer_order_pos++;
                     current_layer = layer_order[layer_order_pos];
                     if (layer_order_pos == layer_count)
                     {
                        fill_line_normal(0, scanline, start, end);
                        goto skip;
                     }
                  }
                  if (current_layer & 0x04)
                  {
                     fill_line_normal(0, scanline, start, end);
                     current_layer &= ~0x04;
                     if (dispcnt & 0x40) render_scanline_obj_normal_1D(current_layer, start, end,
                              scanline);
                     else render_scanline_obj_normal_2D(current_layer, start, end, scanline);
                  }
                  else
                     layer_renderers[current_layer]. normal_render_base(current_layer, start, end,
                           scanline);
                  layer_order_pos++;
                  for (; layer_order_pos < layer_count; layer_order_pos++)
                  {
                     current_layer = layer_order[layer_order_pos];
                     if (current_layer & 0x04)
                     {
                        current_layer &= ~0x04;
                        if (dispcnt & 0x40) render_scanline_obj_normal_1D(current_layer, start, end,
                                 scanline);
                        else render_scanline_obj_normal_2D(current_layer, start, end, scanline);
                     }
                     else
                     {
                        if (enable_flags & (1 << current_layer))
                           layer_renderers[current_layer]. normal_render_transparent(current_layer, start,
                                 end, scanline);
                     }
                  }
               }
skip:
               ;
            }; ;
         }
      }
      else
      {
         u32 pixel_top = palette_ram_converted[0];
         switch ((bldcnt >> 6) & 0x03)
         {
         case 0x02:
         {
            if (((io_registers[REG_BLDCNT] >> 5) & 0x01))
            {
               u32 blend = io_registers[REG_BLDY] & 0x1F;
               u32 upper;
               if (blend > 16) blend = 16;
               upper = ((0x07E0F81F * blend) >> 4) & 0x07E0F81F;
               blend = 16 - blend;
               pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
               pixel_top = upper + ((pixel_top * blend) >> 4);;
               pixel_top &= 0x07E0F81F;
               pixel_top = (pixel_top >> 16) | pixel_top;
            }
            break;
         }
         case 0x03:
         {
            if (((io_registers[REG_BLDCNT] >> 5) & 0x01))
            {
               s32 blend = 16 - (io_registers[REG_BLDY] & 0x1F);
               if (blend < 0) blend = 0;
               pixel_top = (pixel_top | (pixel_top << 16)) & 0x07E0F81F;
               pixel_top = (pixel_top * blend) >> 4;;
               pixel_top &= 0x07E0F81F;
               pixel_top = (pixel_top >> 16) | pixel_top;
            }
            break;
         }
         }
         fill_line_color16(pixel_top, scanline, start, end);
      }
   }
   
   
   ;
}





static void render_scanline_conditional_bitmap(u32 start, u32 end,
      u16* scanline,
      u32 enable_flags, u32 dispcnt, u32 bldcnt, const bitmap_layer_render_struct
      *layer_renderers)
{
   u32 current_layer;
   u32 layer_order_pos;
   
   fill_line_normal(0, scanline, start, end);
   
   for (layer_order_pos = 0; layer_order_pos < layer_count; layer_order_pos++)
   {
      current_layer = layer_order[layer_order_pos];
      if (current_layer & 0x04)
      {
         if (enable_flags & 0x10)
         {
            current_layer &= ~0x04;
            if (dispcnt & 0x40) render_scanline_obj_normal_1D(current_layer, start, end,
                     scanline);
            else render_scanline_obj_normal_2D(current_layer, start, end, scanline);
         }
      }
      else
      {
         if (enable_flags & 0x04)
            layer_renderers->normal_render(start, end, scanline);
      }
   }
}

static void render_scanline_window_tile(u16* scanline, u32 dispcnt)
{
   u32 vcount = io_registers[REG_VCOUNT];
   u32 winout = io_registers[REG_WINOUT];
   u32 bldcnt = io_registers[REG_BLDCNT];
   u32 window_out_enable = winout & 0x3F;
   const tile_layer_render_struct* layer_renderers = tile_mode_renderers[dispcnt &
         0x07];
   switch (dispcnt >> 13)
   {
   case 0x01:
   {
      u32 winin = io_registers[REG_WININ];
      u32 window_0_x1, window_0_x2;
      u32 window_0_y1, window_0_y2;
      u32 window_0_enable = 0;
      window_0_y1 = io_registers[REG_WIN0V] >> 8;
      window_0_y2 = io_registers[REG_WIN0V] & 0xFF;
      if (window_0_y1 > window_0_y2)
      {
         if ((((vcount <= window_0_y2) || (vcount > window_0_y1))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_0_y1) && (vcount < window_0_y2))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      };
      if (window_0_x1 > window_0_x2)
      {
         if (0 != window_0_x2)
            render_scanline_conditional_tile(0, window_0_x2, scanline, window_0_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
         if (window_0_x2 != window_0_x1)
            render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                             window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (window_0_x1 != 240)
            render_scanline_conditional_tile(window_0_x1, 240, scanline, window_0_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
      }
      else
      {
         if (0 != window_0_x1)
            render_scanline_conditional_tile(0, window_0_x1, scanline, window_out_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
         if (window_0_x1 != window_0_x2)
            render_scanline_conditional_tile(window_0_x1, window_0_x2, scanline,
                                             window_0_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (window_0_x2 != 240)
            render_scanline_conditional_tile(window_0_x2, 240, scanline, window_out_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
      };
      break;
   }
   case 0x02:
   {
      u32 winin = io_registers[REG_WININ];
      u32 window_1_x1, window_1_x2;
      u32 window_1_y1, window_1_y2;
      u32 window_1_enable = 0;
      window_1_y1 = io_registers[REG_WIN1V] >> 8;
      window_1_y2 = io_registers[REG_WIN1V] & 0xFF;
      if (window_1_y1 > window_1_y2)
      {
         if ((((vcount <= window_1_y2) || (vcount > window_1_y1))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_1_y1) && (vcount < window_1_y2))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      };
      if (window_1_x1 > window_1_x2)
      {
         if (0 != window_1_x2)
            render_scanline_conditional_tile(0, window_1_x2, scanline, window_1_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x2 != window_1_x1)
            render_scanline_conditional_tile(window_1_x2, window_1_x1, scanline,
                                             window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x1 != 240)
            render_scanline_conditional_tile(window_1_x1, 240, scanline, window_1_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
      }
      else
      {
         if (0 != window_1_x1)
            render_scanline_conditional_tile(0, window_1_x1, scanline, window_out_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x1 != window_1_x2)
            render_scanline_conditional_tile(window_1_x1, window_1_x2, scanline,
                                             window_1_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x2 != 240)
            render_scanline_conditional_tile(window_1_x2, 240, scanline, window_out_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
      };
      break;
   }
   case 0x03:
   {
      u32 winin = io_registers[REG_WININ];
      u32 window_0_x1, window_0_x2;
      u32 window_0_y1, window_0_y2;
      u32 window_0_enable = 0;
      window_0_y1 = io_registers[REG_WIN0V] >> 8;
      window_0_y2 = io_registers[REG_WIN0V] & 0xFF;
      if (window_0_y1 > window_0_y2)
      {
         if ((((vcount <= window_0_y2) || (vcount > window_0_y1))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_0_y1) && (vcount < window_0_y2))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      };
      u32 window_1_x1, window_1_x2;
      u32 window_1_y1, window_1_y2;
      u32 window_1_enable = 0;
      window_1_y1 = io_registers[REG_WIN1V] >> 8;
      window_1_y2 = io_registers[REG_WIN1V] & 0xFF;
      if (window_1_y1 > window_1_y2)
      {
         if ((((vcount <= window_1_y2) || (vcount > window_1_y1))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_1_y1) && (vcount < window_1_y2))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      };
      if (window_0_x1 > window_0_x2)
      {
         if (0 != window_0_x2)
            render_scanline_conditional_tile(0, window_0_x2, scanline, window_0_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x1 != 240)
         {
            if (window_1_x1 > window_1_x2)
            {
               {
                  if (0 != window_1_x2)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                                               window_1_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, window_1_x2, scanline,
                                                               window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (0 < window_0_x1) render_scanline_conditional_tile(0, window_0_x1, scanline,
                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(0, window_1_x2, scanline, window_1_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != window_1_x1)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > window_0_x1)
                              render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                                               window_out_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, window_1_x1, scanline,
                                                               window_out_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1) render_scanline_conditional_tile(window_1_x2,
                                 window_0_x1, scanline, window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x2, window_1_x1, scanline,
                                                         window_out_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x1 != 240)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > window_0_x1)
                              render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                                               window_1_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, 240, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_tile(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x1, 240, scanline, window_1_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
            else
            {
               {
                  if (0 != window_1_x1)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > window_0_x1)
                              render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                                               window_out_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, window_1_x1, scanline,
                                                               window_out_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (0 < window_0_x1) render_scanline_conditional_tile(0, window_0_x1, scanline,
                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(0, window_1_x1, scanline, window_out_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x1 != window_1_x2)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                                               window_1_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, window_1_x2, scanline,
                                                               window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_tile(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x1, window_1_x2, scanline,
                                                         window_1_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != 240)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > window_0_x1)
                              render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                                               window_out_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, 240, scanline, window_out_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1) render_scanline_conditional_tile(window_1_x2,
                                 window_0_x1, scanline, window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x2, 240, scanline, window_out_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
         }
         else
         {
            if (window_0_x2 != window_0_x1)
               render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                                window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
         };
         if (window_0_x1 != 240)
            render_scanline_conditional_tile(window_0_x1, 240, scanline, window_0_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
      }
      else
      {
         if (window_1_x1 != 240)
         {
            if (window_1_x1 > window_1_x2)
            {
               {
                  if (0 != window_1_x2)
                  {
                     if (0 < 0)
                     {
                        if (window_1_x2 > 0)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_tile(0, window_0_x1, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(0, window_1_x2, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (0 < window_0_x1) render_scanline_conditional_tile(0, window_0_x1, scanline,
                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(0, window_1_x2, scanline, window_1_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != window_1_x1)
                  {
                     if (window_1_x2 < 0)
                     {
                        if (window_1_x1 > 0)
                        {
                           if (window_1_x1 > window_0_x1)
                              render_scanline_conditional_tile(0, window_0_x1, scanline, window_out_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(0, window_1_x1, scanline, window_out_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1) render_scanline_conditional_tile(window_1_x2,
                                 window_0_x1, scanline, window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x2, window_1_x1, scanline,
                                                         window_out_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x1 != 240)
                  {
                     if (window_1_x1 < 0)
                     {
                        if (240 > 0)
                        {
                           if (240 > window_0_x1)
                              render_scanline_conditional_tile(0, window_0_x1, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(0, 240, scanline, window_1_enable, dispcnt,
                                                               bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_tile(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x1, 240, scanline, window_1_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
            else
            {
               {
                  if (0 != window_1_x1)
                  {
                     if (0 < 0)
                     {
                        if (window_1_x1 > 0)
                        {
                           if (window_1_x1 > window_0_x1)
                              render_scanline_conditional_tile(0, window_0_x1, scanline, window_out_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(0, window_1_x1, scanline, window_out_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (0 < window_0_x1) render_scanline_conditional_tile(0, window_0_x1, scanline,
                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(0, window_1_x1, scanline, window_out_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x1 != window_1_x2)
                  {
                     if (window_1_x1 < 0)
                     {
                        if (window_1_x2 > 0)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_tile(0, window_0_x1, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(0, window_1_x2, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_tile(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x1, window_1_x2, scanline,
                                                         window_1_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != 240)
                  {
                     if (window_1_x2 < 0)
                     {
                        if (240 > 0)
                        {
                           if (240 > window_0_x1)
                              render_scanline_conditional_tile(0, window_0_x1, scanline, window_out_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(0, 240, scanline, window_out_enable, dispcnt,
                                                               bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1) render_scanline_conditional_tile(window_1_x2,
                                 window_0_x1, scanline, window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x2, 240, scanline, window_out_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
         }
         else
         {
            if (0 != window_0_x1)
               render_scanline_conditional_tile(0, window_0_x1, scanline, window_out_enable,
                                                dispcnt, bldcnt, layer_renderers);  ;
         };
         if (window_0_x1 != window_0_x2)
            render_scanline_conditional_tile(window_0_x1, window_0_x2, scanline,
                                             window_0_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x1 != 240)
         {
            if (window_1_x1 > window_1_x2)
            {
               {
                  if (0 != window_1_x2)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > 240)
                              render_scanline_conditional_tile(window_0_x2, 240, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, window_1_x2, scanline,
                                                               window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > 240)
                     {
                        if (0 < 240) render_scanline_conditional_tile(0, 240, scanline, window_1_enable,
                                 dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(0, window_1_x2, scanline, window_1_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != window_1_x1)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > 240)
                              render_scanline_conditional_tile(window_0_x2, 240, scanline, window_out_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, window_1_x1, scanline,
                                                               window_out_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x1 > 240)
                     {
                        if (window_1_x2 < 240) render_scanline_conditional_tile(window_1_x2, 240,
                                 scanline, window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x2, window_1_x1, scanline,
                                                         window_out_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x1 != 240)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > 240)
                              render_scanline_conditional_tile(window_0_x2, 240, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, 240, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > 240)
                     {
                        if (window_1_x1 < 240) render_scanline_conditional_tile(window_1_x1, 240,
                                 scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x1, 240, scanline, window_1_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
            else
            {
               {
                  if (0 != window_1_x1)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > 240)
                              render_scanline_conditional_tile(window_0_x2, 240, scanline, window_out_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, window_1_x1, scanline,
                                                               window_out_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x1 > 240)
                     {
                        if (0 < 240) render_scanline_conditional_tile(0, 240, scanline,
                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(0, window_1_x1, scanline, window_out_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x1 != window_1_x2)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > 240)
                              render_scanline_conditional_tile(window_0_x2, 240, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, window_1_x2, scanline,
                                                               window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > 240)
                     {
                        if (window_1_x1 < 240) render_scanline_conditional_tile(window_1_x1, 240,
                                 scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x1, window_1_x2, scanline,
                                                         window_1_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != 240)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > 240)
                              render_scanline_conditional_tile(window_0_x2, 240, scanline, window_out_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, 240, scanline, window_out_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > 240)
                     {
                        if (window_1_x2 < 240) render_scanline_conditional_tile(window_1_x2, 240,
                                 scanline, window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x2, 240, scanline, window_out_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
         }
         else
         {
            if (window_0_x2 != 240)
               render_scanline_conditional_tile(window_0_x2, 240, scanline, window_out_enable,
                                                dispcnt, bldcnt, layer_renderers);  ;
         };
      };
      break;
   }
   case 0x04:
   {
      ;
      if (0 != 240)
         render_scanline_conditional_tile(0, 240, scanline, window_out_enable, dispcnt,
                                          bldcnt, layer_renderers);  ;
      if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, 240, scanline);
      else render_scanline_obj_copy_tile_2D(4, 0, 240, scanline);
      break;
   }
   case 0x05:
   {
      u32 winin = io_registers[REG_WININ];
      u32 window_0_x1, window_0_x2;
      u32 window_0_y1, window_0_y2;
      u32 window_0_enable = 0;
      window_0_y1 = io_registers[REG_WIN0V] >> 8;
      window_0_y2 = io_registers[REG_WIN0V] & 0xFF;
      if (window_0_y1 > window_0_y2)
      {
         if ((((vcount <= window_0_y2) || (vcount > window_0_y1))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_0_y1) && (vcount < window_0_y2))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      };
      if (window_0_x1 > window_0_x2)
      {
         if (0 != window_0_x2)
            render_scanline_conditional_tile(0, window_0_x2, scanline, window_0_enable,
                                             dispcnt, bldcnt, layer_renderers);  ; ;
         if (window_0_x2 != window_0_x1)
            render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                             window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2,
                  window_0_x1, scanline);
         else render_scanline_obj_copy_tile_2D(4, window_0_x2, window_0_x1, scanline);
         if (window_0_x1 != 240)
            render_scanline_conditional_tile(window_0_x1, 240, scanline, window_0_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
      }
      else
      {
         ;
         if (0 != window_0_x1)
            render_scanline_conditional_tile(0, window_0_x1, scanline, window_out_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
         if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, window_0_x1,
                  scanline);
         else render_scanline_obj_copy_tile_2D(4, 0, window_0_x1, scanline);
         if (window_0_x1 != window_0_x2)
            render_scanline_conditional_tile(window_0_x1, window_0_x2, scanline,
                                             window_0_enable, dispcnt, bldcnt, layer_renderers);  ; ;
         if (window_0_x2 != 240)
            render_scanline_conditional_tile(window_0_x2, 240, scanline, window_out_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
         if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2, 240,
                  scanline);
         else render_scanline_obj_copy_tile_2D(4, window_0_x2, 240, scanline);
      };
      break;
   }
   case 0x06:
   {
      u32 winin = io_registers[REG_WININ];
      u32 window_1_x1, window_1_x2;
      u32 window_1_y1, window_1_y2;
      u32 window_1_enable = 0;
      window_1_y1 = io_registers[REG_WIN1V] >> 8;
      window_1_y2 = io_registers[REG_WIN1V] & 0xFF;
      if (window_1_y1 > window_1_y2)
      {
         if ((((vcount <= window_1_y2) || (vcount > window_1_y1))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_1_y1) && (vcount < window_1_y2))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      };
      if (window_1_x1 > window_1_x2)
      {
         if (0 != window_1_x2)
            render_scanline_conditional_tile(0, window_1_x2, scanline, window_1_enable,
                                             dispcnt, bldcnt, layer_renderers);  ; ;
         if (window_1_x2 != window_1_x1)
            render_scanline_conditional_tile(window_1_x2, window_1_x1, scanline,
                                             window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_1_x2,
                  window_1_x1, scanline);
         else render_scanline_obj_copy_tile_2D(4, window_1_x2, window_1_x1, scanline);
         if (window_1_x1 != 240)
            render_scanline_conditional_tile(window_1_x1, 240, scanline, window_1_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
      }
      else
      {
         ;
         if (0 != window_1_x1)
            render_scanline_conditional_tile(0, window_1_x1, scanline, window_out_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
         if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, window_1_x1,
                  scanline);
         else render_scanline_obj_copy_tile_2D(4, 0, window_1_x1, scanline);
         if (window_1_x1 != window_1_x2)
            render_scanline_conditional_tile(window_1_x1, window_1_x2, scanline,
                                             window_1_enable, dispcnt, bldcnt, layer_renderers);  ; ;
         if (window_1_x2 != 240)
            render_scanline_conditional_tile(window_1_x2, 240, scanline, window_out_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
         if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_1_x2, 240,
                  scanline);
         else render_scanline_obj_copy_tile_2D(4, window_1_x2, 240, scanline);
      };
      break;
   }
   case 0x07:
   {
      u32 winin = io_registers[REG_WININ];
      u32 window_0_x1, window_0_x2;
      u32 window_0_y1, window_0_y2;
      u32 window_0_enable = 0;
      window_0_y1 = io_registers[REG_WIN0V] >> 8;
      window_0_y2 = io_registers[REG_WIN0V] & 0xFF;
      if (window_0_y1 > window_0_y2)
      {
         if ((((vcount <= window_0_y2) || (vcount > window_0_y1))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_0_y1) && (vcount < window_0_y2))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      };
      u32 window_1_x1, window_1_x2;
      u32 window_1_y1, window_1_y2;
      u32 window_1_enable = 0;
      window_1_y1 = io_registers[REG_WIN1V] >> 8;
      window_1_y2 = io_registers[REG_WIN1V] & 0xFF;
      if (window_1_y1 > window_1_y2)
      {
         if ((((vcount <= window_1_y2) || (vcount > window_1_y1))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_1_y1) && (vcount < window_1_y2))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      };
      if (window_0_x1 > window_0_x2)
      {
         if (0 != window_0_x2)
            render_scanline_conditional_tile(0, window_0_x2, scanline, window_0_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x1 != 240)
         {
            if (window_1_x1 > window_1_x2)
            {
               {
                  if (0 != window_1_x2)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                                               window_1_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, window_1_x2, scanline,
                                                               window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (0 < window_0_x1) render_scanline_conditional_tile(0, window_0_x1, scanline,
                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(0, window_1_x2, scanline, window_1_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != window_1_x1)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > window_0_x1)
                           {
                              ;
                              if (window_0_x2 != window_0_x1)
                                 render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                                                  window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2,
                                       window_0_x1, scanline);
                              else render_scanline_obj_copy_tile_2D(4, window_0_x2, window_0_x1, scanline);
                           }
                           else
                           {
                              ;
                              if (window_0_x2 != window_1_x1)
                                 render_scanline_conditional_tile(window_0_x2, window_1_x1, scanline,
                                                                  window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2,
                                       window_1_x1, scanline);
                              else render_scanline_obj_copy_tile_2D(4, window_0_x2, window_1_x1, scanline);
                           }
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1)
                        {
                           ;
                           if (window_1_x2 != window_0_x1)
                              render_scanline_conditional_tile(window_1_x2, window_0_x1, scanline,
                                                               window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_1_x2,
                                    window_0_x1, scanline);
                           else render_scanline_obj_copy_tile_2D(4, window_1_x2, window_0_x1, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (window_1_x2 != window_1_x1)
                           render_scanline_conditional_tile(window_1_x2, window_1_x1, scanline,
                                                            window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_1_x2,
                                 window_1_x1, scanline);
                        else render_scanline_obj_copy_tile_2D(4, window_1_x2, window_1_x1, scanline);
                     }
                  }
               };
               {
                  if (window_1_x1 != 240)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > window_0_x1)
                              render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                                               window_1_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, 240, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_tile(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x1, 240, scanline, window_1_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
            else
            {
               {
                  if (0 != window_1_x1)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > window_0_x1)
                           {
                              ;
                              if (window_0_x2 != window_0_x1)
                                 render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                                                  window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2,
                                       window_0_x1, scanline);
                              else render_scanline_obj_copy_tile_2D(4, window_0_x2, window_0_x1, scanline);
                           }
                           else
                           {
                              ;
                              if (window_0_x2 != window_1_x1)
                                 render_scanline_conditional_tile(window_0_x2, window_1_x1, scanline,
                                                                  window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2,
                                       window_1_x1, scanline);
                              else render_scanline_obj_copy_tile_2D(4, window_0_x2, window_1_x1, scanline);
                           }
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (0 < window_0_x1)
                        {
                           ;
                           if (0 != window_0_x1)
                              render_scanline_conditional_tile(0, window_0_x1, scanline, window_out_enable,
                                                               dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, window_0_x1,
                                    scanline);
                           else render_scanline_obj_copy_tile_2D(4, 0, window_0_x1, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (0 != window_1_x1)
                           render_scanline_conditional_tile(0, window_1_x1, scanline, window_out_enable,
                                                            dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, window_1_x1,
                                 scanline);
                        else render_scanline_obj_copy_tile_2D(4, 0, window_1_x1, scanline);
                     }
                  }
               };
               {
                  if (window_1_x1 != window_1_x2)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                                               window_1_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, window_1_x2, scanline,
                                                               window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_tile(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x1, window_1_x2, scanline,
                                                         window_1_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != 240)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > window_0_x1)
                           {
                              ;
                              if (window_0_x2 != window_0_x1)
                                 render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                                                  window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2,
                                       window_0_x1, scanline);
                              else render_scanline_obj_copy_tile_2D(4, window_0_x2, window_0_x1, scanline);
                           }
                           else
                           {
                              ;
                              if (window_0_x2 != 240)
                                 render_scanline_conditional_tile(window_0_x2, 240, scanline, window_out_enable,
                                                                  dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2, 240,
                                       scanline);
                              else render_scanline_obj_copy_tile_2D(4, window_0_x2, 240, scanline);
                           }
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1)
                        {
                           ;
                           if (window_1_x2 != window_0_x1)
                              render_scanline_conditional_tile(window_1_x2, window_0_x1, scanline,
                                                               window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_1_x2,
                                    window_0_x1, scanline);
                           else render_scanline_obj_copy_tile_2D(4, window_1_x2, window_0_x1, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (window_1_x2 != 240)
                           render_scanline_conditional_tile(window_1_x2, 240, scanline, window_out_enable,
                                                            dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_1_x2, 240,
                                 scanline);
                        else render_scanline_obj_copy_tile_2D(4, window_1_x2, 240, scanline);
                     }
                  }
               };
            }
         }
         else
         {
            ;
            if (window_0_x2 != window_0_x1)
               render_scanline_conditional_tile(window_0_x2, window_0_x1, scanline,
                                                window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
            if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2,
                     window_0_x1, scanline);
            else render_scanline_obj_copy_tile_2D(4, window_0_x2, window_0_x1, scanline);
         };
         if (window_0_x1 != 240)
            render_scanline_conditional_tile(window_0_x1, 240, scanline, window_0_enable,
                                             dispcnt, bldcnt, layer_renderers);  ;
      }
      else
      {
         if (window_1_x1 != 240)
         {
            if (window_1_x1 > window_1_x2)
            {
               {
                  if (0 != window_1_x2)
                  {
                     if (0 < 0)
                     {
                        if (window_1_x2 > 0)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_tile(0, window_0_x1, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(0, window_1_x2, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (0 < window_0_x1) render_scanline_conditional_tile(0, window_0_x1, scanline,
                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(0, window_1_x2, scanline, window_1_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != window_1_x1)
                  {
                     if (window_1_x2 < 0)
                     {
                        if (window_1_x1 > 0)
                        {
                           if (window_1_x1 > window_0_x1)
                           {
                              ;
                              if (0 != window_0_x1)
                                 render_scanline_conditional_tile(0, window_0_x1, scanline, window_out_enable,
                                                                  dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, window_0_x1,
                                       scanline);
                              else render_scanline_obj_copy_tile_2D(4, 0, window_0_x1, scanline);
                           }
                           else
                           {
                              ;
                              if (0 != window_1_x1)
                                 render_scanline_conditional_tile(0, window_1_x1, scanline, window_out_enable,
                                                                  dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, window_1_x1,
                                       scanline);
                              else render_scanline_obj_copy_tile_2D(4, 0, window_1_x1, scanline);
                           }
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1)
                        {
                           ;
                           if (window_1_x2 != window_0_x1)
                              render_scanline_conditional_tile(window_1_x2, window_0_x1, scanline,
                                                               window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_1_x2,
                                    window_0_x1, scanline);
                           else render_scanline_obj_copy_tile_2D(4, window_1_x2, window_0_x1, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (window_1_x2 != window_1_x1)
                           render_scanline_conditional_tile(window_1_x2, window_1_x1, scanline,
                                                            window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_1_x2,
                                 window_1_x1, scanline);
                        else render_scanline_obj_copy_tile_2D(4, window_1_x2, window_1_x1, scanline);
                     }
                  }
               };
               {
                  if (window_1_x1 != 240)
                  {
                     if (window_1_x1 < 0)
                     {
                        if (240 > 0)
                        {
                           if (240 > window_0_x1)
                              render_scanline_conditional_tile(0, window_0_x1, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(0, 240, scanline, window_1_enable, dispcnt,
                                                               bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_tile(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x1, 240, scanline, window_1_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
            else
            {
               {
                  if (0 != window_1_x1)
                  {
                     if (0 < 0)
                     {
                        if (window_1_x1 > 0)
                        {
                           if (window_1_x1 > window_0_x1)
                           {
                              ;
                              if (0 != window_0_x1)
                                 render_scanline_conditional_tile(0, window_0_x1, scanline, window_out_enable,
                                                                  dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, window_0_x1,
                                       scanline);
                              else render_scanline_obj_copy_tile_2D(4, 0, window_0_x1, scanline);
                           }
                           else
                           {
                              ;
                              if (0 != window_1_x1)
                                 render_scanline_conditional_tile(0, window_1_x1, scanline, window_out_enable,
                                                                  dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, window_1_x1,
                                       scanline);
                              else render_scanline_obj_copy_tile_2D(4, 0, window_1_x1, scanline);
                           }
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (0 < window_0_x1)
                        {
                           ;
                           if (0 != window_0_x1)
                              render_scanline_conditional_tile(0, window_0_x1, scanline, window_out_enable,
                                                               dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, window_0_x1,
                                    scanline);
                           else render_scanline_obj_copy_tile_2D(4, 0, window_0_x1, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (0 != window_1_x1)
                           render_scanline_conditional_tile(0, window_1_x1, scanline, window_out_enable,
                                                            dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, window_1_x1,
                                 scanline);
                        else render_scanline_obj_copy_tile_2D(4, 0, window_1_x1, scanline);
                     }
                  }
               };
               {
                  if (window_1_x1 != window_1_x2)
                  {
                     if (window_1_x1 < 0)
                     {
                        if (window_1_x2 > 0)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_tile(0, window_0_x1, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(0, window_1_x2, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_tile(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x1, window_1_x2, scanline,
                                                         window_1_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != 240)
                  {
                     if (window_1_x2 < 0)
                     {
                        if (240 > 0)
                        {
                           if (240 > window_0_x1)
                           {
                              ;
                              if (0 != window_0_x1)
                                 render_scanline_conditional_tile(0, window_0_x1, scanline, window_out_enable,
                                                                  dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, window_0_x1,
                                       scanline);
                              else render_scanline_obj_copy_tile_2D(4, 0, window_0_x1, scanline);
                           }
                           else
                           {
                              ;
                              if (0 != 240)
                                 render_scanline_conditional_tile(0, 240, scanline, window_out_enable, dispcnt,
                                                                  bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, 240, scanline);
                              else render_scanline_obj_copy_tile_2D(4, 0, 240, scanline);
                           }
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1)
                        {
                           ;
                           if (window_1_x2 != window_0_x1)
                              render_scanline_conditional_tile(window_1_x2, window_0_x1, scanline,
                                                               window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_1_x2,
                                    window_0_x1, scanline);
                           else render_scanline_obj_copy_tile_2D(4, window_1_x2, window_0_x1, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (window_1_x2 != 240)
                           render_scanline_conditional_tile(window_1_x2, 240, scanline, window_out_enable,
                                                            dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_1_x2, 240,
                                 scanline);
                        else render_scanline_obj_copy_tile_2D(4, window_1_x2, 240, scanline);
                     }
                  }
               };
            }
         }
         else
         {
            ;
            if (0 != window_0_x1)
               render_scanline_conditional_tile(0, window_0_x1, scanline, window_out_enable,
                                                dispcnt, bldcnt, layer_renderers);  ;
            if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, window_0_x1,
                     scanline);
            else render_scanline_obj_copy_tile_2D(4, 0, window_0_x1, scanline);
         };
         if (window_0_x1 != window_0_x2)
            render_scanline_conditional_tile(window_0_x1, window_0_x2, scanline,
                                             window_0_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x1 != 240)
         {
            if (window_1_x1 > window_1_x2)
            {
               {
                  if (0 != window_1_x2)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > 240)
                              render_scanline_conditional_tile(window_0_x2, 240, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, window_1_x2, scanline,
                                                               window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > 240)
                     {
                        if (0 < 240) render_scanline_conditional_tile(0, 240, scanline, window_1_enable,
                                 dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(0, window_1_x2, scanline, window_1_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != window_1_x1)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > 240)
                           {
                              ;
                              if (window_0_x2 != 240)
                                 render_scanline_conditional_tile(window_0_x2, 240, scanline, window_out_enable,
                                                                  dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2, 240,
                                       scanline);
                              else render_scanline_obj_copy_tile_2D(4, window_0_x2, 240, scanline);
                           }
                           else
                           {
                              ;
                              if (window_0_x2 != window_1_x1)
                                 render_scanline_conditional_tile(window_0_x2, window_1_x1, scanline,
                                                                  window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2,
                                       window_1_x1, scanline);
                              else render_scanline_obj_copy_tile_2D(4, window_0_x2, window_1_x1, scanline);
                           }
                        }
                     }
                     else if (window_1_x1 > 240)
                     {
                        if (window_1_x2 < 240)
                        {
                           ;
                           if (window_1_x2 != 240)
                              render_scanline_conditional_tile(window_1_x2, 240, scanline, window_out_enable,
                                                               dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_1_x2, 240,
                                    scanline);
                           else render_scanline_obj_copy_tile_2D(4, window_1_x2, 240, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (window_1_x2 != window_1_x1)
                           render_scanline_conditional_tile(window_1_x2, window_1_x1, scanline,
                                                            window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_1_x2,
                                 window_1_x1, scanline);
                        else render_scanline_obj_copy_tile_2D(4, window_1_x2, window_1_x1, scanline);
                     }
                  }
               };
               {
                  if (window_1_x1 != 240)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > 240)
                              render_scanline_conditional_tile(window_0_x2, 240, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, 240, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > 240)
                     {
                        if (window_1_x1 < 240) render_scanline_conditional_tile(window_1_x1, 240,
                                 scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x1, 240, scanline, window_1_enable,
                                                         dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
            else
            {
               {
                  if (0 != window_1_x1)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > 240)
                           {
                              ;
                              if (window_0_x2 != 240)
                                 render_scanline_conditional_tile(window_0_x2, 240, scanline, window_out_enable,
                                                                  dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2, 240,
                                       scanline);
                              else render_scanline_obj_copy_tile_2D(4, window_0_x2, 240, scanline);
                           }
                           else
                           {
                              ;
                              if (window_0_x2 != window_1_x1)
                                 render_scanline_conditional_tile(window_0_x2, window_1_x1, scanline,
                                                                  window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2,
                                       window_1_x1, scanline);
                              else render_scanline_obj_copy_tile_2D(4, window_0_x2, window_1_x1, scanline);
                           }
                        }
                     }
                     else if (window_1_x1 > 240)
                     {
                        if (0 < 240)
                        {
                           ;
                           if (0 != 240)
                              render_scanline_conditional_tile(0, 240, scanline, window_out_enable, dispcnt,
                                                               bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, 240, scanline);
                           else render_scanline_obj_copy_tile_2D(4, 0, 240, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (0 != window_1_x1)
                           render_scanline_conditional_tile(0, window_1_x1, scanline, window_out_enable,
                                                            dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, 0, window_1_x1,
                                 scanline);
                        else render_scanline_obj_copy_tile_2D(4, 0, window_1_x1, scanline);
                     }
                  }
               };
               {
                  if (window_1_x1 != window_1_x2)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > 240)
                              render_scanline_conditional_tile(window_0_x2, 240, scanline, window_1_enable,
                                                               dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_tile(window_0_x2, window_1_x2, scanline,
                                                               window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > 240)
                     {
                        if (window_1_x1 < 240) render_scanline_conditional_tile(window_1_x1, 240,
                                 scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_tile(window_1_x1, window_1_x2, scanline,
                                                         window_1_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != 240)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > 240)
                           {
                              ;
                              if (window_0_x2 != 240)
                                 render_scanline_conditional_tile(window_0_x2, 240, scanline, window_out_enable,
                                                                  dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2, 240,
                                       scanline);
                              else render_scanline_obj_copy_tile_2D(4, window_0_x2, 240, scanline);
                           }
                           else
                           {
                              ;
                              if (window_0_x2 != 240)
                                 render_scanline_conditional_tile(window_0_x2, 240, scanline, window_out_enable,
                                                                  dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2, 240,
                                       scanline);
                              else render_scanline_obj_copy_tile_2D(4, window_0_x2, 240, scanline);
                           }
                        }
                     }
                     else if (240 > 240)
                     {
                        if (window_1_x2 < 240)
                        {
                           ;
                           if (window_1_x2 != 240)
                              render_scanline_conditional_tile(window_1_x2, 240, scanline, window_out_enable,
                                                               dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_1_x2, 240,
                                    scanline);
                           else render_scanline_obj_copy_tile_2D(4, window_1_x2, 240, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (window_1_x2 != 240)
                           render_scanline_conditional_tile(window_1_x2, 240, scanline, window_out_enable,
                                                            dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_1_x2, 240,
                                 scanline);
                        else render_scanline_obj_copy_tile_2D(4, window_1_x2, 240, scanline);
                     }
                  }
               };
            }
         }
         else
         {
            ;
            if (window_0_x2 != 240)
               render_scanline_conditional_tile(window_0_x2, 240, scanline, window_out_enable,
                                                dispcnt, bldcnt, layer_renderers);  ;
            if (dispcnt & 0x40) render_scanline_obj_copy_tile_1D(4, window_0_x2, 240,
                     scanline);
            else render_scanline_obj_copy_tile_2D(4, window_0_x2, 240, scanline);
         };
      };
      break;
   }
   }
};
static void render_scanline_window_bitmap(u16* scanline, u32 dispcnt)
{
   u32 vcount = io_registers[REG_VCOUNT];
   u32 winout = io_registers[REG_WINOUT];
   u32 bldcnt = io_registers[REG_BLDCNT];
   u32 window_out_enable = winout & 0x3F;
   const bitmap_layer_render_struct* layer_renderers = bitmap_mode_renderers + ((
            dispcnt & 0x07) - 3);
   switch (dispcnt >> 13)
   {
   case 0x01:
   {
      u32 winin = io_registers[REG_WININ];
      u32 window_0_x1, window_0_x2;
      u32 window_0_y1, window_0_y2;
      u32 window_0_enable = 0;
      window_0_y1 = io_registers[REG_WIN0V] >> 8;
      window_0_y2 = io_registers[REG_WIN0V] & 0xFF;
      if (window_0_y1 > window_0_y2)
      {
         if ((((vcount <= window_0_y2) || (vcount > window_0_y1))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_0_y1) && (vcount < window_0_y2))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      };
      if (window_0_x1 > window_0_x2)
      {
         if (0 != window_0_x2)
            render_scanline_conditional_bitmap(0, window_0_x2, scanline, window_0_enable,
                                               dispcnt, bldcnt, layer_renderers);  ;
         if (window_0_x2 != window_0_x1)
            render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                               window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (window_0_x1 != 240)
            render_scanline_conditional_bitmap(window_0_x1, 240, scanline, window_0_enable,
                                               dispcnt, bldcnt, layer_renderers);  ;
      }
      else
      {
         if (0 != window_0_x1)
            render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_out_enable,
                                               dispcnt, bldcnt, layer_renderers);  ;
         if (window_0_x1 != window_0_x2)
            render_scanline_conditional_bitmap(window_0_x1, window_0_x2, scanline,
                                               window_0_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (window_0_x2 != 240)
            render_scanline_conditional_bitmap(window_0_x2, 240, scanline,
                                               window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
      };
      break;
   }
   case 0x02:
   {
      u32 winin = io_registers[REG_WININ];
      u32 window_1_x1, window_1_x2;
      u32 window_1_y1, window_1_y2;
      u32 window_1_enable = 0;
      window_1_y1 = io_registers[REG_WIN1V] >> 8;
      window_1_y2 = io_registers[REG_WIN1V] & 0xFF;
      if (window_1_y1 > window_1_y2)
      {
         if ((((vcount <= window_1_y2) || (vcount > window_1_y1))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_1_y1) && (vcount < window_1_y2))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      };
      if (window_1_x1 > window_1_x2)
      {
         if (0 != window_1_x2)
            render_scanline_conditional_bitmap(0, window_1_x2, scanline, window_1_enable,
                                               dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x2 != window_1_x1)
            render_scanline_conditional_bitmap(window_1_x2, window_1_x1, scanline,
                                               window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x1 != 240)
            render_scanline_conditional_bitmap(window_1_x1, 240, scanline, window_1_enable,
                                               dispcnt, bldcnt, layer_renderers);  ;
      }
      else
      {
         if (0 != window_1_x1)
            render_scanline_conditional_bitmap(0, window_1_x1, scanline, window_out_enable,
                                               dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x1 != window_1_x2)
            render_scanline_conditional_bitmap(window_1_x1, window_1_x2, scanline,
                                               window_1_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x2 != 240)
            render_scanline_conditional_bitmap(window_1_x2, 240, scanline,
                                               window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
      };
      break;
   }
   case 0x03:
   {
      u32 winin = io_registers[REG_WININ];
      u32 window_0_x1, window_0_x2;
      u32 window_0_y1, window_0_y2;
      u32 window_0_enable = 0;
      window_0_y1 = io_registers[REG_WIN0V] >> 8;
      window_0_y2 = io_registers[REG_WIN0V] & 0xFF;
      if (window_0_y1 > window_0_y2)
      {
         if ((((vcount <= window_0_y2) || (vcount > window_0_y1))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_0_y1) && (vcount < window_0_y2))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      };
      u32 window_1_x1, window_1_x2;
      u32 window_1_y1, window_1_y2;
      u32 window_1_enable = 0;
      window_1_y1 = io_registers[REG_WIN1V] >> 8;
      window_1_y2 = io_registers[REG_WIN1V] & 0xFF;
      if (window_1_y1 > window_1_y2)
      {
         if ((((vcount <= window_1_y2) || (vcount > window_1_y1))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_1_y1) && (vcount < window_1_y2))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      };
      if (window_0_x1 > window_0_x2)
      {
         if (0 != window_0_x2)
            render_scanline_conditional_bitmap(0, window_0_x2, scanline, window_0_enable,
                                               dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x1 != 240)
         {
            if (window_1_x1 > window_1_x2)
            {
               {
                  if (0 != window_1_x2)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, window_1_x2, scanline,
                                                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (0 < window_0_x1) render_scanline_conditional_bitmap(0, window_0_x1,
                                 scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(0, window_1_x2, scanline, window_1_enable,
                                                           dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != window_1_x1)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > window_0_x1)
                              render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, window_1_x1, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1) render_scanline_conditional_bitmap(window_1_x2,
                                 window_0_x1, scanline, window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x2, window_1_x1, scanline,
                                                           window_out_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x1 != 240)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > window_0_x1)
                              render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, 240, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_bitmap(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x1, 240, scanline, window_1_enable,
                                                           dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
            else
            {
               {
                  if (0 != window_1_x1)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > window_0_x1)
                              render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, window_1_x1, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (0 < window_0_x1) render_scanline_conditional_bitmap(0, window_0_x1,
                                 scanline, window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(0, window_1_x1, scanline, window_out_enable,
                                                           dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x1 != window_1_x2)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, window_1_x2, scanline,
                                                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_bitmap(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x1, window_1_x2, scanline,
                                                           window_1_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != 240)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > window_0_x1)
                              render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, 240, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1) render_scanline_conditional_bitmap(window_1_x2,
                                 window_0_x1, scanline, window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x2, 240, scanline,
                                                           window_out_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
         }
         else
         {
            if (window_0_x2 != window_0_x1)
               render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                                  window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
         };
         if (window_0_x1 != 240)
            render_scanline_conditional_bitmap(window_0_x1, 240, scanline, window_0_enable,
                                               dispcnt, bldcnt, layer_renderers);  ;
      }
      else
      {
         if (window_1_x1 != 240)
         {
            if (window_1_x1 > window_1_x2)
            {
               {
                  if (0 != window_1_x2)
                  {
                     if (0 < 0)
                     {
                        if (window_1_x2 > 0)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(0, window_1_x2, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (0 < window_0_x1) render_scanline_conditional_bitmap(0, window_0_x1,
                                 scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(0, window_1_x2, scanline, window_1_enable,
                                                           dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != window_1_x1)
                  {
                     if (window_1_x2 < 0)
                     {
                        if (window_1_x1 > 0)
                        {
                           if (window_1_x1 > window_0_x1)
                              render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_out_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(0, window_1_x1, scanline, window_out_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1) render_scanline_conditional_bitmap(window_1_x2,
                                 window_0_x1, scanline, window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x2, window_1_x1, scanline,
                                                           window_out_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x1 != 240)
                  {
                     if (window_1_x1 < 0)
                     {
                        if (240 > 0)
                        {
                           if (240 > window_0_x1)
                              render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(0, 240, scanline, window_1_enable, dispcnt,
                                                                 bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_bitmap(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x1, 240, scanline, window_1_enable,
                                                           dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
            else
            {
               {
                  if (0 != window_1_x1)
                  {
                     if (0 < 0)
                     {
                        if (window_1_x1 > 0)
                        {
                           if (window_1_x1 > window_0_x1)
                              render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_out_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(0, window_1_x1, scanline, window_out_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (0 < window_0_x1) render_scanline_conditional_bitmap(0, window_0_x1,
                                 scanline, window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(0, window_1_x1, scanline, window_out_enable,
                                                           dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x1 != window_1_x2)
                  {
                     if (window_1_x1 < 0)
                     {
                        if (window_1_x2 > 0)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(0, window_1_x2, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_bitmap(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x1, window_1_x2, scanline,
                                                           window_1_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != 240)
                  {
                     if (window_1_x2 < 0)
                     {
                        if (240 > 0)
                        {
                           if (240 > window_0_x1)
                              render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_out_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(0, 240, scanline, window_out_enable, dispcnt,
                                                                 bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1) render_scanline_conditional_bitmap(window_1_x2,
                                 window_0_x1, scanline, window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x2, 240, scanline,
                                                           window_out_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
         }
         else
         {
            if (0 != window_0_x1)
               render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_out_enable,
                                                  dispcnt, bldcnt, layer_renderers);  ;
         };
         if (window_0_x1 != window_0_x2)
            render_scanline_conditional_bitmap(window_0_x1, window_0_x2, scanline,
                                               window_0_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x1 != 240)
         {
            if (window_1_x1 > window_1_x2)
            {
               {
                  if (0 != window_1_x2)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > 240)
                              render_scanline_conditional_bitmap(window_0_x2, 240, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, window_1_x2, scanline,
                                                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > 240)
                     {
                        if (0 < 240) render_scanline_conditional_bitmap(0, 240, scanline,
                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(0, window_1_x2, scanline, window_1_enable,
                                                           dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != window_1_x1)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > 240)
                              render_scanline_conditional_bitmap(window_0_x2, 240, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, window_1_x1, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x1 > 240)
                     {
                        if (window_1_x2 < 240) render_scanline_conditional_bitmap(window_1_x2, 240,
                                 scanline, window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x2, window_1_x1, scanline,
                                                           window_out_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x1 != 240)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > 240)
                              render_scanline_conditional_bitmap(window_0_x2, 240, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, 240, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > 240)
                     {
                        if (window_1_x1 < 240) render_scanline_conditional_bitmap(window_1_x1, 240,
                                 scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x1, 240, scanline, window_1_enable,
                                                           dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
            else
            {
               {
                  if (0 != window_1_x1)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > 240)
                              render_scanline_conditional_bitmap(window_0_x2, 240, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, window_1_x1, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x1 > 240)
                     {
                        if (0 < 240) render_scanline_conditional_bitmap(0, 240, scanline,
                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(0, window_1_x1, scanline, window_out_enable,
                                                           dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x1 != window_1_x2)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > 240)
                              render_scanline_conditional_bitmap(window_0_x2, 240, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, window_1_x2, scanline,
                                                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > 240)
                     {
                        if (window_1_x1 < 240) render_scanline_conditional_bitmap(window_1_x1, 240,
                                 scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x1, window_1_x2, scanline,
                                                           window_1_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != 240)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > 240)
                              render_scanline_conditional_bitmap(window_0_x2, 240, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, 240, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > 240)
                     {
                        if (window_1_x2 < 240) render_scanline_conditional_bitmap(window_1_x2, 240,
                                 scanline, window_out_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x2, 240, scanline,
                                                           window_out_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
         }
         else
         {
            if (window_0_x2 != 240)
               render_scanline_conditional_bitmap(window_0_x2, 240, scanline,
                                                  window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
         };
      };
      break;
   }
   case 0x04:
   {
      ;
      if (0 != 240)
         render_scanline_conditional_bitmap(0, 240, scanline, window_out_enable, dispcnt,
                                            bldcnt, layer_renderers);  ;
      if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, 240, scanline);
      else render_scanline_obj_copy_bitmap_2D(4, 0, 240, scanline);
      break;
   }
   case 0x05:
   {
      u32 winin = io_registers[REG_WININ];
      u32 window_0_x1, window_0_x2;
      u32 window_0_y1, window_0_y2;
      u32 window_0_enable = 0;
      window_0_y1 = io_registers[REG_WIN0V] >> 8;
      window_0_y2 = io_registers[REG_WIN0V] & 0xFF;
      if (window_0_y1 > window_0_y2)
      {
         if ((((vcount <= window_0_y2) || (vcount > window_0_y1))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_0_y1) && (vcount < window_0_y2))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      };
      if (window_0_x1 > window_0_x2)
      {
         if (0 != window_0_x2)
            render_scanline_conditional_bitmap(0, window_0_x2, scanline, window_0_enable,
                                               dispcnt, bldcnt, layer_renderers);  ; ;
         if (window_0_x2 != window_0_x1)
            render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                               window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2,
                  window_0_x1, scanline);
         else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, window_0_x1, scanline);
         if (window_0_x1 != 240)
            render_scanline_conditional_bitmap(window_0_x1, 240, scanline, window_0_enable,
                                               dispcnt, bldcnt, layer_renderers);  ;
      }
      else
      {
         ;
         if (0 != window_0_x1)
            render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_out_enable,
                                               dispcnt, bldcnt, layer_renderers);  ;
         if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, window_0_x1,
                  scanline);
         else render_scanline_obj_copy_bitmap_2D(4, 0, window_0_x1, scanline);
         if (window_0_x1 != window_0_x2)
            render_scanline_conditional_bitmap(window_0_x1, window_0_x2, scanline,
                                               window_0_enable, dispcnt, bldcnt, layer_renderers);  ; ;
         if (window_0_x2 != 240)
            render_scanline_conditional_bitmap(window_0_x2, 240, scanline,
                                               window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2, 240,
                  scanline);
         else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, 240, scanline);
      };
      break;
   }
   case 0x06:
   {
      u32 winin = io_registers[REG_WININ];
      u32 window_1_x1, window_1_x2;
      u32 window_1_y1, window_1_y2;
      u32 window_1_enable = 0;
      window_1_y1 = io_registers[REG_WIN1V] >> 8;
      window_1_y2 = io_registers[REG_WIN1V] & 0xFF;
      if (window_1_y1 > window_1_y2)
      {
         if ((((vcount <= window_1_y2) || (vcount > window_1_y1))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_1_y1) && (vcount < window_1_y2))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      };
      if (window_1_x1 > window_1_x2)
      {
         if (0 != window_1_x2)
            render_scanline_conditional_bitmap(0, window_1_x2, scanline, window_1_enable,
                                               dispcnt, bldcnt, layer_renderers);  ; ;
         if (window_1_x2 != window_1_x1)
            render_scanline_conditional_bitmap(window_1_x2, window_1_x1, scanline,
                                               window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_1_x2,
                  window_1_x1, scanline);
         else render_scanline_obj_copy_bitmap_2D(4, window_1_x2, window_1_x1, scanline);
         if (window_1_x1 != 240)
            render_scanline_conditional_bitmap(window_1_x1, 240, scanline, window_1_enable,
                                               dispcnt, bldcnt, layer_renderers);  ;
      }
      else
      {
         ;
         if (0 != window_1_x1)
            render_scanline_conditional_bitmap(0, window_1_x1, scanline, window_out_enable,
                                               dispcnt, bldcnt, layer_renderers);  ;
         if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, window_1_x1,
                  scanline);
         else render_scanline_obj_copy_bitmap_2D(4, 0, window_1_x1, scanline);
         if (window_1_x1 != window_1_x2)
            render_scanline_conditional_bitmap(window_1_x1, window_1_x2, scanline,
                                               window_1_enable, dispcnt, bldcnt, layer_renderers);  ; ;
         if (window_1_x2 != 240)
            render_scanline_conditional_bitmap(window_1_x2, 240, scanline,
                                               window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_1_x2, 240,
                  scanline);
         else render_scanline_obj_copy_bitmap_2D(4, window_1_x2, 240, scanline);
      };
      break;
   }
   case 0x07:
   {
      u32 winin = io_registers[REG_WININ];
      u32 window_0_x1, window_0_x2;
      u32 window_0_y1, window_0_y2;
      u32 window_0_enable = 0;
      window_0_y1 = io_registers[REG_WIN0V] >> 8;
      window_0_y2 = io_registers[REG_WIN0V] & 0xFF;
      if (window_0_y1 > window_0_y2)
      {
         if ((((vcount <= window_0_y2) || (vcount > window_0_y1))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_0_y1) && (vcount < window_0_y2))
               || (window_0_y2 > 227)) && (window_0_y1 <= 227))
         {
            window_0_x1 = io_registers[REG_WIN0H] >> 8;
            window_0_x2 = io_registers[REG_WIN0H] & 0xFF;
            window_0_enable = (winin >> (0 * 8)) & 0x3F;
            if (window_0_x1 > 240) window_0_x1 = 240;
            if (window_0_x2 > 240) window_0_x2 = 240;
         }
         else
         {
            window_0_x1 = 240;
            window_0_x2 = 240;
         }
      };
      u32 window_1_x1, window_1_x2;
      u32 window_1_y1, window_1_y2;
      u32 window_1_enable = 0;
      window_1_y1 = io_registers[REG_WIN1V] >> 8;
      window_1_y2 = io_registers[REG_WIN1V] & 0xFF;
      if (window_1_y1 > window_1_y2)
      {
         if ((((vcount <= window_1_y2) || (vcount > window_1_y1))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      }
      else
      {
         if ((((vcount >= window_1_y1) && (vcount < window_1_y2))
               || (window_1_y2 > 227)) && (window_1_y1 <= 227))
         {
            window_1_x1 = io_registers[REG_WIN1H] >> 8;
            window_1_x2 = io_registers[REG_WIN1H] & 0xFF;
            window_1_enable = (winin >> (1 * 8)) & 0x3F;
            if (window_1_x1 > 240) window_1_x1 = 240;
            if (window_1_x2 > 240) window_1_x2 = 240;
         }
         else
         {
            window_1_x1 = 240;
            window_1_x2 = 240;
         }
      };
      if (window_0_x1 > window_0_x2)
      {
         if (0 != window_0_x2)
            render_scanline_conditional_bitmap(0, window_0_x2, scanline, window_0_enable,
                                               dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x1 != 240)
         {
            if (window_1_x1 > window_1_x2)
            {
               {
                  if (0 != window_1_x2)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, window_1_x2, scanline,
                                                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (0 < window_0_x1) render_scanline_conditional_bitmap(0, window_0_x1,
                                 scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(0, window_1_x2, scanline, window_1_enable,
                                                           dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != window_1_x1)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > window_0_x1)
                           {
                              ;
                              if (window_0_x2 != window_0_x1)
                                 render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                                                    window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2,
                                       window_0_x1, scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, window_0_x1, scanline);
                           }
                           else
                           {
                              ;
                              if (window_0_x2 != window_1_x1)
                                 render_scanline_conditional_bitmap(window_0_x2, window_1_x1, scanline,
                                                                    window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2,
                                       window_1_x1, scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, window_1_x1, scanline);
                           }
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1)
                        {
                           ;
                           if (window_1_x2 != window_0_x1)
                              render_scanline_conditional_bitmap(window_1_x2, window_0_x1, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_1_x2,
                                    window_0_x1, scanline);
                           else render_scanline_obj_copy_bitmap_2D(4, window_1_x2, window_0_x1, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (window_1_x2 != window_1_x1)
                           render_scanline_conditional_bitmap(window_1_x2, window_1_x1, scanline,
                                                              window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_1_x2,
                                 window_1_x1, scanline);
                        else render_scanline_obj_copy_bitmap_2D(4, window_1_x2, window_1_x1, scanline);
                     }
                  }
               };
               {
                  if (window_1_x1 != 240)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > window_0_x1)
                              render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, 240, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_bitmap(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x1, 240, scanline, window_1_enable,
                                                           dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
            else
            {
               {
                  if (0 != window_1_x1)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > window_0_x1)
                           {
                              ;
                              if (window_0_x2 != window_0_x1)
                                 render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                                                    window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2,
                                       window_0_x1, scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, window_0_x1, scanline);
                           }
                           else
                           {
                              ;
                              if (window_0_x2 != window_1_x1)
                                 render_scanline_conditional_bitmap(window_0_x2, window_1_x1, scanline,
                                                                    window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2,
                                       window_1_x1, scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, window_1_x1, scanline);
                           }
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (0 < window_0_x1)
                        {
                           ;
                           if (0 != window_0_x1)
                              render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_out_enable,
                                                                 dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, window_0_x1,
                                    scanline);
                           else render_scanline_obj_copy_bitmap_2D(4, 0, window_0_x1, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (0 != window_1_x1)
                           render_scanline_conditional_bitmap(0, window_1_x1, scanline, window_out_enable,
                                                              dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, window_1_x1,
                                 scanline);
                        else render_scanline_obj_copy_bitmap_2D(4, 0, window_1_x1, scanline);
                     }
                  }
               };
               {
                  if (window_1_x1 != window_1_x2)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, window_1_x2, scanline,
                                                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_bitmap(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x1, window_1_x2, scanline,
                                                           window_1_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != 240)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > window_0_x1)
                           {
                              ;
                              if (window_0_x2 != window_0_x1)
                                 render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                                                    window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2,
                                       window_0_x1, scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, window_0_x1, scanline);
                           }
                           else
                           {
                              ;
                              if (window_0_x2 != 240)
                                 render_scanline_conditional_bitmap(window_0_x2, 240, scanline,
                                                                    window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2, 240,
                                       scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, 240, scanline);
                           }
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1)
                        {
                           ;
                           if (window_1_x2 != window_0_x1)
                              render_scanline_conditional_bitmap(window_1_x2, window_0_x1, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_1_x2,
                                    window_0_x1, scanline);
                           else render_scanline_obj_copy_bitmap_2D(4, window_1_x2, window_0_x1, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (window_1_x2 != 240)
                           render_scanline_conditional_bitmap(window_1_x2, 240, scanline,
                                                              window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_1_x2, 240,
                                 scanline);
                        else render_scanline_obj_copy_bitmap_2D(4, window_1_x2, 240, scanline);
                     }
                  }
               };
            }
         }
         else
         {
            ;
            if (window_0_x2 != window_0_x1)
               render_scanline_conditional_bitmap(window_0_x2, window_0_x1, scanline,
                                                  window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
            if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2,
                     window_0_x1, scanline);
            else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, window_0_x1, scanline);
         };
         if (window_0_x1 != 240)
            render_scanline_conditional_bitmap(window_0_x1, 240, scanline, window_0_enable,
                                               dispcnt, bldcnt, layer_renderers);  ;
      }
      else
      {
         if (window_1_x1 != 240)
         {
            if (window_1_x1 > window_1_x2)
            {
               {
                  if (0 != window_1_x2)
                  {
                     if (0 < 0)
                     {
                        if (window_1_x2 > 0)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(0, window_1_x2, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (0 < window_0_x1) render_scanline_conditional_bitmap(0, window_0_x1,
                                 scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(0, window_1_x2, scanline, window_1_enable,
                                                           dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != window_1_x1)
                  {
                     if (window_1_x2 < 0)
                     {
                        if (window_1_x1 > 0)
                        {
                           if (window_1_x1 > window_0_x1)
                           {
                              ;
                              if (0 != window_0_x1)
                                 render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_out_enable,
                                                                    dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, window_0_x1,
                                       scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, 0, window_0_x1, scanline);
                           }
                           else
                           {
                              ;
                              if (0 != window_1_x1)
                                 render_scanline_conditional_bitmap(0, window_1_x1, scanline, window_out_enable,
                                                                    dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, window_1_x1,
                                       scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, 0, window_1_x1, scanline);
                           }
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1)
                        {
                           ;
                           if (window_1_x2 != window_0_x1)
                              render_scanline_conditional_bitmap(window_1_x2, window_0_x1, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_1_x2,
                                    window_0_x1, scanline);
                           else render_scanline_obj_copy_bitmap_2D(4, window_1_x2, window_0_x1, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (window_1_x2 != window_1_x1)
                           render_scanline_conditional_bitmap(window_1_x2, window_1_x1, scanline,
                                                              window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_1_x2,
                                 window_1_x1, scanline);
                        else render_scanline_obj_copy_bitmap_2D(4, window_1_x2, window_1_x1, scanline);
                     }
                  }
               };
               {
                  if (window_1_x1 != 240)
                  {
                     if (window_1_x1 < 0)
                     {
                        if (240 > 0)
                        {
                           if (240 > window_0_x1)
                              render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(0, 240, scanline, window_1_enable, dispcnt,
                                                                 bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_bitmap(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x1, 240, scanline, window_1_enable,
                                                           dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
            else
            {
               {
                  if (0 != window_1_x1)
                  {
                     if (0 < 0)
                     {
                        if (window_1_x1 > 0)
                        {
                           if (window_1_x1 > window_0_x1)
                           {
                              ;
                              if (0 != window_0_x1)
                                 render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_out_enable,
                                                                    dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, window_0_x1,
                                       scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, 0, window_0_x1, scanline);
                           }
                           else
                           {
                              ;
                              if (0 != window_1_x1)
                                 render_scanline_conditional_bitmap(0, window_1_x1, scanline, window_out_enable,
                                                                    dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, window_1_x1,
                                       scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, 0, window_1_x1, scanline);
                           }
                        }
                     }
                     else if (window_1_x1 > window_0_x1)
                     {
                        if (0 < window_0_x1)
                        {
                           ;
                           if (0 != window_0_x1)
                              render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_out_enable,
                                                                 dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, window_0_x1,
                                    scanline);
                           else render_scanline_obj_copy_bitmap_2D(4, 0, window_0_x1, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (0 != window_1_x1)
                           render_scanline_conditional_bitmap(0, window_1_x1, scanline, window_out_enable,
                                                              dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, window_1_x1,
                                 scanline);
                        else render_scanline_obj_copy_bitmap_2D(4, 0, window_1_x1, scanline);
                     }
                  }
               };
               {
                  if (window_1_x1 != window_1_x2)
                  {
                     if (window_1_x1 < 0)
                     {
                        if (window_1_x2 > 0)
                        {
                           if (window_1_x2 > window_0_x1)
                              render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(0, window_1_x2, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > window_0_x1)
                     {
                        if (window_1_x1 < window_0_x1) render_scanline_conditional_bitmap(window_1_x1,
                                 window_0_x1, scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x1, window_1_x2, scanline,
                                                           window_1_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != 240)
                  {
                     if (window_1_x2 < 0)
                     {
                        if (240 > 0)
                        {
                           if (240 > window_0_x1)
                           {
                              ;
                              if (0 != window_0_x1)
                                 render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_out_enable,
                                                                    dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, window_0_x1,
                                       scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, 0, window_0_x1, scanline);
                           }
                           else
                           {
                              ;
                              if (0 != 240)
                                 render_scanline_conditional_bitmap(0, 240, scanline, window_out_enable, dispcnt,
                                                                    bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, 240, scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, 0, 240, scanline);
                           }
                        }
                     }
                     else if (240 > window_0_x1)
                     {
                        if (window_1_x2 < window_0_x1)
                        {
                           ;
                           if (window_1_x2 != window_0_x1)
                              render_scanline_conditional_bitmap(window_1_x2, window_0_x1, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_1_x2,
                                    window_0_x1, scanline);
                           else render_scanline_obj_copy_bitmap_2D(4, window_1_x2, window_0_x1, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (window_1_x2 != 240)
                           render_scanline_conditional_bitmap(window_1_x2, 240, scanline,
                                                              window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_1_x2, 240,
                                 scanline);
                        else render_scanline_obj_copy_bitmap_2D(4, window_1_x2, 240, scanline);
                     }
                  }
               };
            }
         }
         else
         {
            ;
            if (0 != window_0_x1)
               render_scanline_conditional_bitmap(0, window_0_x1, scanline, window_out_enable,
                                                  dispcnt, bldcnt, layer_renderers);  ;
            if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, window_0_x1,
                     scanline);
            else render_scanline_obj_copy_bitmap_2D(4, 0, window_0_x1, scanline);
         };
         if (window_0_x1 != window_0_x2)
            render_scanline_conditional_bitmap(window_0_x1, window_0_x2, scanline,
                                               window_0_enable, dispcnt, bldcnt, layer_renderers);  ;
         if (window_1_x1 != 240)
         {
            if (window_1_x1 > window_1_x2)
            {
               {
                  if (0 != window_1_x2)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > 240)
                              render_scanline_conditional_bitmap(window_0_x2, 240, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, window_1_x2, scanline,
                                                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > 240)
                     {
                        if (0 < 240) render_scanline_conditional_bitmap(0, 240, scanline,
                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(0, window_1_x2, scanline, window_1_enable,
                                                           dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != window_1_x1)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > 240)
                           {
                              ;
                              if (window_0_x2 != 240)
                                 render_scanline_conditional_bitmap(window_0_x2, 240, scanline,
                                                                    window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2, 240,
                                       scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, 240, scanline);
                           }
                           else
                           {
                              ;
                              if (window_0_x2 != window_1_x1)
                                 render_scanline_conditional_bitmap(window_0_x2, window_1_x1, scanline,
                                                                    window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2,
                                       window_1_x1, scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, window_1_x1, scanline);
                           }
                        }
                     }
                     else if (window_1_x1 > 240)
                     {
                        if (window_1_x2 < 240)
                        {
                           ;
                           if (window_1_x2 != 240)
                              render_scanline_conditional_bitmap(window_1_x2, 240, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_1_x2, 240,
                                    scanline);
                           else render_scanline_obj_copy_bitmap_2D(4, window_1_x2, 240, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (window_1_x2 != window_1_x1)
                           render_scanline_conditional_bitmap(window_1_x2, window_1_x1, scanline,
                                                              window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_1_x2,
                                 window_1_x1, scanline);
                        else render_scanline_obj_copy_bitmap_2D(4, window_1_x2, window_1_x1, scanline);
                     }
                  }
               };
               {
                  if (window_1_x1 != 240)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > 240)
                              render_scanline_conditional_bitmap(window_0_x2, 240, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, 240, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (240 > 240)
                     {
                        if (window_1_x1 < 240) render_scanline_conditional_bitmap(window_1_x1, 240,
                                 scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x1, 240, scanline, window_1_enable,
                                                           dispcnt, bldcnt, layer_renderers);
                  }
               };
            }
            else
            {
               {
                  if (0 != window_1_x1)
                  {
                     if (0 < window_0_x2)
                     {
                        if (window_1_x1 > window_0_x2)
                        {
                           if (window_1_x1 > 240)
                           {
                              ;
                              if (window_0_x2 != 240)
                                 render_scanline_conditional_bitmap(window_0_x2, 240, scanline,
                                                                    window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2, 240,
                                       scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, 240, scanline);
                           }
                           else
                           {
                              ;
                              if (window_0_x2 != window_1_x1)
                                 render_scanline_conditional_bitmap(window_0_x2, window_1_x1, scanline,
                                                                    window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2,
                                       window_1_x1, scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, window_1_x1, scanline);
                           }
                        }
                     }
                     else if (window_1_x1 > 240)
                     {
                        if (0 < 240)
                        {
                           ;
                           if (0 != 240)
                              render_scanline_conditional_bitmap(0, 240, scanline, window_out_enable, dispcnt,
                                                                 bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, 240, scanline);
                           else render_scanline_obj_copy_bitmap_2D(4, 0, 240, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (0 != window_1_x1)
                           render_scanline_conditional_bitmap(0, window_1_x1, scanline, window_out_enable,
                                                              dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, 0, window_1_x1,
                                 scanline);
                        else render_scanline_obj_copy_bitmap_2D(4, 0, window_1_x1, scanline);
                     }
                  }
               };
               {
                  if (window_1_x1 != window_1_x2)
                  {
                     if (window_1_x1 < window_0_x2)
                     {
                        if (window_1_x2 > window_0_x2)
                        {
                           if (window_1_x2 > 240)
                              render_scanline_conditional_bitmap(window_0_x2, 240, scanline, window_1_enable,
                                                                 dispcnt, bldcnt, layer_renderers);
                           else
                              render_scanline_conditional_bitmap(window_0_x2, window_1_x2, scanline,
                                                                 window_1_enable, dispcnt, bldcnt, layer_renderers);
                        }
                     }
                     else if (window_1_x2 > 240)
                     {
                        if (window_1_x1 < 240) render_scanline_conditional_bitmap(window_1_x1, 240,
                                 scanline, window_1_enable, dispcnt, bldcnt, layer_renderers);
                     }
                     else
                        render_scanline_conditional_bitmap(window_1_x1, window_1_x2, scanline,
                                                           window_1_enable, dispcnt, bldcnt, layer_renderers);
                  }
               };
               {
                  if (window_1_x2 != 240)
                  {
                     if (window_1_x2 < window_0_x2)
                     {
                        if (240 > window_0_x2)
                        {
                           if (240 > 240)
                           {
                              ;
                              if (window_0_x2 != 240)
                                 render_scanline_conditional_bitmap(window_0_x2, 240, scanline,
                                                                    window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2, 240,
                                       scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, 240, scanline);
                           }
                           else
                           {
                              ;
                              if (window_0_x2 != 240)
                                 render_scanline_conditional_bitmap(window_0_x2, 240, scanline,
                                                                    window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                              if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2, 240,
                                       scanline);
                              else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, 240, scanline);
                           }
                        }
                     }
                     else if (240 > 240)
                     {
                        if (window_1_x2 < 240)
                        {
                           ;
                           if (window_1_x2 != 240)
                              render_scanline_conditional_bitmap(window_1_x2, 240, scanline,
                                                                 window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                           if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_1_x2, 240,
                                    scanline);
                           else render_scanline_obj_copy_bitmap_2D(4, window_1_x2, 240, scanline);
                        }
                     }
                     else
                     {
                        ;
                        if (window_1_x2 != 240)
                           render_scanline_conditional_bitmap(window_1_x2, 240, scanline,
                                                              window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
                        if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_1_x2, 240,
                                 scanline);
                        else render_scanline_obj_copy_bitmap_2D(4, window_1_x2, 240, scanline);
                     }
                  }
               };
            }
         }
         else
         {
            ;
            if (window_0_x2 != 240)
               render_scanline_conditional_bitmap(window_0_x2, 240, scanline,
                                                  window_out_enable, dispcnt, bldcnt, layer_renderers);  ;
            if (dispcnt & 0x40) render_scanline_obj_copy_bitmap_1D(4, window_0_x2, 240,
                     scanline);
            else render_scanline_obj_copy_bitmap_2D(4, window_0_x2, 240, scanline);
         };
      };
      break;
   }
   }
};

static const u32 active_layers[6] = { 0x1F, 0x17, 0x1C, 0x14, 0x14, 0x14 };

void update_scanline(void)
{
   u32 pitch = GBA_SCREEN_PITCH;
   u32 dispcnt = io_registers[REG_DISPCNT];
   u32 vcount = io_registers[REG_VCOUNT];
   u16* screen_offset = gba_screen_pixels + (vcount * pitch);
   u32 video_mode = dispcnt & 0x07;
   
   
   
   if (oam_update)
   {
      order_obj(video_mode);
      oam_update = 0;
   }
   
   order_layers((dispcnt >> 8) & active_layers[video_mode]);
   
   
   if (dispcnt & 0x80)
      fill_line_color16(0xFFFF, screen_offset, 0, 240);
   else
   {
      if (video_mode < 3)
      {
         if (dispcnt >> 13)
            render_scanline_window_tile(screen_offset, dispcnt);
         else
            render_scanline_tile(screen_offset, dispcnt);
      }
      else
      {
         if (dispcnt >> 13)
            render_scanline_window_bitmap(screen_offset, dispcnt);
         else
            render_scanline_bitmap(screen_offset, dispcnt);
      }
   }
   
   affine_reference_x[0] += (s16)io_registers[REG_BG2PB];
   affine_reference_y[0] += (s16)io_registers[REG_BG2PD];
   affine_reference_x[1] += (s16)io_registers[REG_BG3PB];
   affine_reference_y[1] += (s16)io_registers[REG_BG3PD];
}

void video_read_savestate(void)
{
   state_mem_read_array(affine_reference_x);
   state_mem_read_array(affine_reference_y);
}
void video_write_savestate(void)
{
   state_mem_write_array(affine_reference_x);
   state_mem_write_array(affine_reference_y);
}
